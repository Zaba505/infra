<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/infra/pr-preview/pr-626/favicons/favicon.ico><link rel=apple-touch-icon href=/infra/pr-preview/pr-626/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-192x192.png sizes=192x192><title>[0005] Network Boot Infrastructure Implementation on Google Cloud | Zaba505's Home Lab</title><meta name=description content="Evaluate implementation approaches for deploying network boot infrastructure on Google Cloud Platform using UEFI HTTP boot, comparing custom server implementation versus Matchbox-based solution."><meta property="og:url" content="https://zaba505.github.io/infra/pr-preview/pr-626/rd/adrs/0005-network-boot-infrastructure-gcp/"><meta property="og:site_name" content="Zaba505's Home Lab"><meta property="og:title" content="[0005] Network Boot Infrastructure Implementation on Google Cloud"><meta property="og:description" content="Evaluate implementation approaches for deploying network boot infrastructure on Google Cloud Platform using UEFI HTTP boot, comparing custom server implementation versus Matchbox-based solution."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="r&amp;d"><meta property="article:published_time" content="2025-11-17T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-24T02:15:08+00:00"><meta itemprop=name content="[0005] Network Boot Infrastructure Implementation on Google Cloud"><meta itemprop=description content="Evaluate implementation approaches for deploying network boot infrastructure on Google Cloud Platform using UEFI HTTP boot, comparing custom server implementation versus Matchbox-based solution."><meta itemprop=datePublished content="2025-11-17T00:00:00+00:00"><meta itemprop=dateModified content="2025-11-24T02:15:08+00:00"><meta itemprop=wordCount content="4815"><meta name=twitter:card content="summary"><meta name=twitter:title content="[0005] Network Boot Infrastructure Implementation on Google Cloud"><meta name=twitter:description content="Evaluate implementation approaches for deploying network boot infrastructure on Google Cloud Platform using UEFI HTTP boot, comparing custom server implementation versus Matchbox-based solution."><link rel=preload href=/infra/pr-preview/pr-626/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css as=style integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><link href=/infra/pr-preview/pr-626/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css rel=stylesheet integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/infra/pr-preview/pr-626/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Zaba505's Home Lab</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/infra/pr-preview/pr-626/offline-search-index.9f518cff5cf7e2fccf7e51830a38b99d.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/infra/pr-preview/pr-626/offline-search-index.9f518cff5cf7e2fccf7e51830a38b99d.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-infrapr-previewpr-626-li><a href=/infra/pr-preview/pr-626/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-infrapr-previewpr-626><span>Zaba505's Home Lab</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626physical_infrastructure-li><a href=/infra/pr-preview/pr-626/physical_infrastructure/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626physical_infrastructure><span>Physical Infrastructure</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-infrapr-previewpr-626rd-li><a href=/infra/pr-preview/pr-626/rd/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rd><span>Research and Development</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdanalysis-li><a href=/infra/pr-preview/pr-626/rd/analysis/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysis><span>Technology Analysis</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdanalysisresource_identification-li><a href=/infra/pr-preview/pr-626/rd/analysis/resource_identification/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisresource_identification><span>Resource Identifiers Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisresource_identificationuuid-li><a href=/infra/pr-preview/pr-626/rd/analysis/resource_identification/uuid/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisresource_identificationuuid><span>Universally Unique Identifier (UUID) Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisresource_identificationulid-li><a href=/infra/pr-preview/pr-626/rd/analysis/resource_identification/ulid/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisresource_identificationulid><span>Universally Unique Lexicographically Sortable Identifier (ULID) Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisresource_identificationsnowflake-li><a href=/infra/pr-preview/pr-626/rd/analysis/resource_identification/snowflake/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisresource_identificationsnowflake><span>Snowflake ID Analysis</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdanalysisserver-os-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisserver-os><span>Server Operating System Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisserver-osubuntu-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/ubuntu/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisserver-osubuntu><span>Ubuntu Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisserver-osfedora-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/fedora/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisserver-osfedora><span>Fedora Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisserver-ostalos-linux-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/talos-linux/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisserver-ostalos-linux><span>Talos Linux Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisserver-osharvester-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/harvester/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisserver-osharvester><span>Harvester Analysis</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdanalysisaws-li><a href=/infra/pr-preview/pr-626/rd/analysis/aws/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisaws><span>Amazon Web Services Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisawsnetwork-boot-li><a href=/infra/pr-preview/pr-626/rd/analysis/aws/network-boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisawsnetwork-boot><span>AWS Network Boot Protocol Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisawswireguard-li><a href=/infra/pr-preview/pr-626/rd/analysis/aws/wireguard/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisawswireguard><span>AWS WireGuard VPN Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdanalysisgoogle-cloud-li><a href=/infra/pr-preview/pr-626/rd/analysis/google-cloud/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisgoogle-cloud><span>Google Cloud Platform Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudgcsfuse-li><a href=/infra/pr-preview/pr-626/rd/analysis/google-cloud/gcsfuse/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudgcsfuse><span>Cloud Storage FUSE (gcsfuse)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudnetwork-boot-li><a href=/infra/pr-preview/pr-626/rd/analysis/google-cloud/network-boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudnetwork-boot><span>GCP Network Boot Protocol Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudwireguard-li><a href=/infra/pr-preview/pr-626/rd/analysis/google-cloud/wireguard/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudwireguard><span>GCP WireGuard VPN Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9-li><a href=/infra/pr-preview/pr-626/rd/analysis/hp_dl360_gen9/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9><span>HP ProLiant DL360 Gen9 Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9configuration-li><a href=/infra/pr-preview/pr-626/rd/analysis/hp_dl360_gen9/configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9configuration><span>Configuration Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9specifications-li><a href=/infra/pr-preview/pr-626/rd/analysis/hp_dl360_gen9/specifications/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9specifications><span>Hardware Specifications</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9network-boot-li><a href=/infra/pr-preview/pr-626/rd/analysis/hp_dl360_gen9/network-boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9network-boot><span>Network Boot Capabilities</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdanalysismatchbox-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysismatchbox><span>Matchbox Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysismatchboxconfiguration-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysismatchboxconfiguration><span>Configuration Model</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysismatchboxdeployment-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/deployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysismatchboxdeployment><span>Deployment Patterns</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysismatchboxnetwork-boot-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/network-boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysismatchboxnetwork-boot><span>Network Boot Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysismatchboxevaluation-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/evaluation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysismatchboxevaluation><span>Use Case Evaluation</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdanalysisudm_pro-li><a href=/infra/pr-preview/pr-626/rd/analysis/udm_pro/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisudm_pro><span>Ubiquiti Dream Machine Pro Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisudm_provlans-li><a href=/infra/pr-preview/pr-626/rd/analysis/udm_pro/vlans/ title="UDM Pro VLAN Configuration & Capabilities" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisudm_provlans><span>VLANs</span></a></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-infrapr-previewpr-626rdadrs-li><a href=/infra/pr-preview/pr-626/rd/adrs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdadrs><span>Architecture Decision Records</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626rdadrs0001-use-madr-for-architecture-decision-records-li><a href=/infra/pr-preview/pr-626/rd/adrs/0001-use-madr-for-architecture-decision-records/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0001-use-madr-for-architecture-decision-records><span>[0001] Use MADR for Architecture Decision Records</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626rdadrs0002-network-boot-architecture-li><a href=/infra/pr-preview/pr-626/rd/adrs/0002-network-boot-architecture/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0002-network-boot-architecture><span>[0002] Network Boot Architecture for Home Lab</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626rdadrs0003-cloud-provider-selection-li><a href=/infra/pr-preview/pr-626/rd/adrs/0003-cloud-provider-selection/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0003-cloud-provider-selection><span>[0003] Cloud Provider Selection for Network Boot Infrastructure</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626rdadrs0004-server-operating-system-li><a href=/infra/pr-preview/pr-626/rd/adrs/0004-server-operating-system/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0004-server-operating-system><span>[0004] Server Operating System Selection</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-infrapr-previewpr-626rdadrs0005-network-boot-infrastructure-gcp-li><a href=/infra/pr-preview/pr-626/rd/adrs/0005-network-boot-infrastructure-gcp/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0005-network-boot-infrastructure-gcp><span class=td-sidebar-nav-active-item>[0005] Network Boot Infrastructure Implementation on Google Cloud</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626rdadrs0006-resource-identifier-standard-li><a href=/infra/pr-preview/pr-626/rd/adrs/0006-resource-identifier-standard/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0006-resource-identifier-standard><span>[0006] Universal Resource Identifier Standard</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626rdadrs0007-standard-api-error-response-li><a href=/infra/pr-preview/pr-626/rd/adrs/0007-standard-api-error-response/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0007-standard-api-error-response><span>[0007] Standard API Error Response Format</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdservices-li><a href=/infra/pr-preview/pr-626/rd/services/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdservices><span>Services</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdservicesboot-li><a href=/infra/pr-preview/pr-626/rd/services/boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdservicesboot><span>Boot Service</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesbootboot-ipxe-li><a href=/infra/pr-preview/pr-626/rd/services/boot/boot-ipxe/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesbootboot-ipxe><span>GET /boot.ipxe</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesbootasset-kernel-li><a href=/infra/pr-preview/pr-626/rd/services/boot/asset-kernel/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesbootasset-kernel><span>GET /asset/{boot_profile_id}/kernel</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesbootasset-initrd-li><a href=/infra/pr-preview/pr-626/rd/services/boot/asset-initrd/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesbootasset-initrd><span>GET /asset/{boot_profile_id}/initrd</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesbootpost-profiles-li><a href=/infra/pr-preview/pr-626/rd/services/boot/post-profiles/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesbootpost-profiles><span>POST /api/v1/profiles</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesbootget-profile-li><a href=/infra/pr-preview/pr-626/rd/services/boot/get-profile/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesbootget-profile><span>GET /api/v1/boot/{machine_id}/profile</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesbootput-profile-li><a href=/infra/pr-preview/pr-626/rd/services/boot/put-profile/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesbootput-profile><span>PUT /api/v1/boot/{machine_id}/profile</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesbootdelete-profile-li><a href=/infra/pr-preview/pr-626/rd/services/boot/delete-profile/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesbootdelete-profile><span>DELETE /api/v1/boot/{machine_id}/profile</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesboothealth-startup-li><a href=/infra/pr-preview/pr-626/rd/services/boot/health-startup/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesboothealth-startup><span>GET /health/startup</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesboothealth-liveness-li><a href=/infra/pr-preview/pr-626/rd/services/boot/health-liveness/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesboothealth-liveness><span>GET /health/liveness</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdservicesmachine-mgmt-li><a href=/infra/pr-preview/pr-626/rd/services/machine-mgmt/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdservicesmachine-mgmt><span>Machine Service</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesmachine-mgmtpost-machines-li><a href=/infra/pr-preview/pr-626/rd/services/machine-mgmt/post-machines/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesmachine-mgmtpost-machines><span>POST /api/v1/machines</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesmachine-mgmtget-machines-li><a href=/infra/pr-preview/pr-626/rd/services/machine-mgmt/get-machines/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesmachine-mgmtget-machines><span>GET /api/v1/machines</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesmachine-mgmtget-machine-li><a href=/infra/pr-preview/pr-626/rd/services/machine-mgmt/get-machine/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesmachine-mgmtget-machine><span>GET /api/v1/machines/{id}</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesmachine-mgmtput-machine-li><a href=/infra/pr-preview/pr-626/rd/services/machine-mgmt/put-machine/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesmachine-mgmtput-machine><span>PUT /api/v1/machines/{id}</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesmachine-mgmtdelete-machine-li><a href=/infra/pr-preview/pr-626/rd/services/machine-mgmt/delete-machine/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesmachine-mgmtdelete-machine><span>DELETE /api/v1/machines/{id}</span></a></li></ul></li></ul></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/Zaba505/infra/tree/main/content/r&amp;d/adrs/0005-network-boot-infrastructure-gcp.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/Zaba505/infra/edit/main/content/r&amp;d/adrs/0005-network-boot-infrastructure-gcp.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/Zaba505/infra/new/main/content/r&amp;d/adrs?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/Zaba505/infra/issues/new?title=[0005]%20Network%20Boot%20Infrastructure%20Implementation%20on%20Google%20Cloud" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/Zaba505/infra/issues/new class="td-page-meta--project td-page-meta__project-issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
<a id=print href=/infra/pr-preview/pr-626/_print/rd/adrs/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#context-and-problem-statement>Context and Problem Statement</a><ul><li><a href=#hardware-specific-context>Hardware-Specific Context</a></li></ul></li><li><a href=#decision-drivers>Decision Drivers</a></li><li><a href=#considered-options>Considered Options</a></li><li><a href=#decision-outcome>Decision Outcome</a><ul><li><a href=#architecture>Architecture</a></li><li><a href=#consequences>Consequences</a></li><li><a href=#confirmation>Confirmation</a></li></ul></li><li><a href=#pros-and-cons-of-the-options>Pros and Cons of the Options</a><ul><li><a href=#option-1-custom-server-implementation-go-based>Option 1: Custom Server Implementation (Go-based)</a></li><li><a href=#option-2-matchbox-based-solution>Option 2: Matchbox-Based Solution</a></li></ul></li><li><a href=#uefi-http-boot-architecture>UEFI HTTP Boot Architecture</a><ul><li><a href=#boot-process-overview>Boot Process Overview</a></li><li><a href=#key-differences>Key Differences</a></li><li><a href=#security-architecture>Security Architecture</a></li><li><a href=#firmware-configuration>Firmware Configuration</a></li><li><a href=#architectural-implications>Architectural Implications</a></li></ul></li><li><a href=#detailed-comparison>Detailed Comparison</a><ul><li><a href=#feature-comparison>Feature Comparison</a></li><li><a href=#development-effort-comparison>Development Effort Comparison</a></li><li><a href=#operational-complexity>Operational Complexity</a></li><li><a href=#cost-comparison-summary>Cost Comparison Summary</a></li><li><a href=#risk-analysis>Risk Analysis</a></li></ul></li><li><a href=#implementation-plan>Implementation Plan</a><ul><li><a href=#phase-1-machine-management-service-week-1>Phase 1: Machine Management Service (Week 1)</a></li><li><a href=#phase-2-boot-service-week-2>Phase 2: Boot Service (Week 2)</a></li><li><a href=#phase-3-integration--observability-week-2-3>Phase 3: Integration & Observability (Week 2-3)</a></li><li><a href=#success-criteria>Success Criteria</a></li></ul></li><li><a href=#more-information>More Information</a><ul><li><a href=#related-resources>Related Resources</a></li><li><a href=#related-adrs>Related ADRs</a></li><li><a href=#future-considerations>Future Considerations</a></li><li><a href=#related-issues>Related Issues</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/infra/pr-preview/pr-626/rd/>Research and Development</a></li><li class=breadcrumb-item><a href=/infra/pr-preview/pr-626/rd/adrs/>Architecture Decision Records</a></li><li class="breadcrumb-item active" aria-current=page>[0005] Network Boot Infrastructure Implementation on Google Cloud</li></ol></nav><div class=td-content><h1>[0005] Network Boot Infrastructure Implementation on Google Cloud</h1><div class=lead>Evaluate implementation approaches for deploying network boot infrastructure on Google Cloud Platform using UEFI HTTP boot, comparing custom server implementation versus Matchbox-based solution.</div><header class=article-meta></header><h2 id=context-and-problem-statement>Context and Problem Statement</h2><p><a href=./0002-network-boot-architecture/>ADR-0002</a> established that network boot infrastructure will be hosted on a cloud provider accessed via WireGuard VPN. <a href=./0003-cloud-provider-selection/>ADR-0003</a> selected Google Cloud Platform as the hosting provider to consolidate infrastructure and leverage existing expertise.</p><p>The remaining question is: <strong>How should the network boot server itself be implemented?</strong></p><p>This decision affects:</p><ul><li><strong>Development Effort</strong>: Time required to build, test, and maintain the solution</li><li><strong>Feature Completeness</strong>: Capabilities for boot image management, machine mapping, and provisioning workflows</li><li><strong>Operational Complexity</strong>: Deployment, monitoring, and troubleshooting burden</li><li><strong>Security</strong>: Boot image integrity, access control, and audit capabilities</li><li><strong>Scalability</strong>: Ability to grow from single home lab to multiple environments</li></ul><p>The boot server must handle:</p><ol><li><strong>HTTP/HTTPS requests</strong> for UEFI boot scripts, kernels, initrd images, and cloud-init configurations</li><li><strong>Machine-to-image mapping</strong> to serve appropriate boot files based on MAC address, hardware profile, or tags</li><li><strong>Boot image lifecycle management</strong> including upload, versioning, and rollback capabilities</li></ol><h3 id=hardware-specific-context>Hardware-Specific Context</h3><p>The target bare metal servers (HP DL360 Gen 9) have the following network boot capabilities:</p><ul><li><strong>UEFI HTTP Boot</strong>: Supported in iLO 4 firmware v2.40+ (released 2016)</li><li><strong>TLS Support</strong>: Server-side TLS only (no client certificate authentication)</li><li><strong>Boot Process</strong>: Firmware handles initial HTTP requests directly (no PXE/TFTP chain loading required)</li><li><strong>Configuration</strong>: Boot URL configured via iLO RBSU or UEFI System Utilities</li></ul><p><strong>Security Implications</strong>: Since the servers cannot present client certificates for mTLS authentication with Cloudflare, the WireGuard VPN serves as the secure transport layer for boot traffic. The HTTP boot server is only accessible through the VPN tunnel.</p><p><strong>Reference</strong>: <a href=../../analysis/hp_dl360_gen9/network-boot.md>HP DL360 Gen 9 Network Boot Analysis</a></p><h2 id=decision-drivers>Decision Drivers</h2><ul><li><strong>Time to Production</strong>: Minimize time to get a working network boot infrastructure</li><li><strong>Feature Requirements</strong>: Must support machine-specific boot configurations, image versioning, and cloud-init integration</li><li><strong>Maintenance Burden</strong>: Prefer solutions that minimize ongoing maintenance and updates</li><li><strong>GCP Integration</strong>: Should leverage GCP services (Cloud Storage, Secret Manager, IAM)</li><li><strong>Security</strong>: Boot images must be served securely with access control and integrity verification</li><li><strong>Observability</strong>: Comprehensive logging and monitoring for troubleshooting boot failures</li><li><strong>Cost</strong>: Minimize infrastructure costs while meeting functional requirements</li><li><strong>Future Flexibility</strong>: Ability to extend or customize as needs evolve</li></ul><h2 id=considered-options>Considered Options</h2><ul><li><strong>Option 1</strong>: Custom server implementation (Go-based)</li><li><strong>Option 2</strong>: Matchbox-based solution</li></ul><h2 id=decision-outcome>Decision Outcome</h2><p><strong>Chosen option</strong>: &ldquo;<strong>Option 1: Custom implementation</strong>&rdquo;, because:</p><ol><li><strong>UEFI HTTP Boot Simplification</strong>: Elimination of TFTP/PXE dramatically reduces implementation complexity</li><li><strong>Cloud Run Deployment</strong>: HTTP-only boot enables serverless deployment (~$5/month vs $8-17/month)</li><li><strong>Development Time Manageable</strong>: UEFI HTTP boot reduces custom development to 2-3 weeks</li><li><strong>Full Control</strong>: Custom implementation maintains flexibility for future home lab requirements</li><li><strong>GCP Native Integration</strong>: Direct Cloud Storage, Firestore, Secret Manager, and IAM integration</li><li><strong>Existing Framework</strong>: Leverages <code>z5labs/humus</code> patterns already in use across services</li><li><strong>HTTP REST API</strong>: Native HTTP REST admin API via <code>z5labs/humus</code> framework provides better integration with existing tooling</li><li><strong>Microservices Architecture</strong>: Separation into Boot Service and Machine Management Service provides better separation of concerns</li><li><strong>Standardized Error Handling</strong>: Implementation follows RFC 7807 Problem Details standard (<a href=./0007-standard-api-error-response/>ADR-0007</a>) for consistent API error responses</li></ol><h3 id=architecture>Architecture</h3><p>The implementation consists of two services:</p><ol><li><p><strong>Boot Service</strong>: Serves UEFI HTTP boot endpoints and admin API</p><ul><li><strong>UEFI Boot Endpoints</strong>: <code>/boot.ipxe</code>, <code>/asset/{boot_profile_id}/kernel</code>, <code>/asset/{boot_profile_id}/initrd</code> (accessed by bare metal servers)</li><li><strong>Admin API</strong>: <code>POST /api/v1/profiles</code> (create/update boot profile for a machine_id)</li><li>Queries Machine Management Service API to resolve machine specifications by MAC address</li><li>Stores boot profile metadata in Firestore and boot assets (kernel/initrd) in Cloud Storage</li><li>Each machine can have one active boot profile; creating a new profile for the same machine_id replaces the previous one</li></ul></li><li><p><strong>Machine Management Service</strong>: Manages machine hardware profiles</p><ul><li><strong>API Endpoints</strong>: <code>/api/v1/machines</code> (CRUD operations for machine hardware specifications)</li><li>Stores machine profiles in Firestore (CPU, memory, NICs, drives, accelerators)</li><li>Provides machine lookup by ID or NIC MAC address</li><li>Accessed by Boot Service during boot operations to retrieve machine specifications</li><li>Does not manage boot profiles or boot assets (handled by Boot Service)</li></ul></li></ol><h3 id=consequences>Consequences</h3><ul><li>Good, because UEFI HTTP boot eliminates TFTP complexity entirely</li><li>Good, because Cloud Run deployment reduces operational overhead and cost</li><li>Good, because leverages existing <code>z5labs/humus</code> framework and Go expertise</li><li>Good, because GCP native integration (Cloud Storage, Firestore, Secret Manager, IAM)</li><li>Good, because full control over implementation enables future customization</li><li>Good, because microservices architecture separates boot operations from management operations</li><li>Good, because Boot Service can scale independently from Machine Management Service</li><li>Good, because simplified testing (HTTP-only, no TFTP/PXE edge cases)</li><li>Good, because OpenTelemetry observability built-in from existing patterns</li><li>Neutral, because requires 2-3 weeks development time vs 1 week for Matchbox setup</li><li>Neutral, because ongoing maintenance responsibility (no upstream project support)</li><li>Neutral, because two services require coordination but provide clearer boundaries</li><li>Bad, because custom implementation may miss edge cases that Matchbox handles</li><li>Bad, because reinvents machine matching and boot configuration patterns</li><li>Bad, because Cloud Run cold start latency needs monitoring (mitigated with min instances = 1)</li><li>Bad, because service-to-service communication adds latency (mitigated by GCP regional networking)</li></ul><h3 id=confirmation>Confirmation</h3><p>The implementation success will be validated by:</p><ul><li>Successfully deploying custom boot server on GCP Cloud Run</li><li>Successfully network booting HP DL360 Gen 9 via UEFI HTTP boot through WireGuard VPN</li><li>Confirming iLO 4 firmware v2.40+ compatibility with HTTP boot workflow</li><li>Validating boot image upload and versioning workflows via HTTP REST API</li><li>Measuring Cloud Run cold start latency for boot requests (target: &lt; 100ms)</li><li>Measuring boot file request latency for kernel/initrd downloads (target: &lt; 100ms)</li><li>Confirming Cloud Storage integration for boot asset storage</li><li>Testing machine-to-image mapping based on MAC address using Firestore</li><li>Validating WireGuard VPN security for boot traffic (compensating for lack of client cert support)</li><li>Verifying OpenTelemetry observability integration with Cloud Monitoring</li></ul><h2 id=pros-and-cons-of-the-options>Pros and Cons of the Options</h2><h3 id=option-1-custom-server-implementation-go-based>Option 1: Custom Server Implementation (Go-based)</h3><p>Build a custom network boot server in Go, leveraging the existing <code>z5labs/humus</code> framework for HTTP services.</p><h4 id=architecture-overview>Architecture Overview</h4><pre class=mermaid>architecture-beta
    group gcp(cloud)[GCP VPC]

    service wg_nlb(internet)[Network LB] in gcp
    service wireguard(server)[WireGuard Gateway] in gcp
    service https_lb(internet)[HTTPS LB] in gcp
    service compute(server)[Compute Engine] in gcp
    service storage(database)[Cloud Storage] in gcp
    service firestore(database)[Firestore] in gcp
    service secrets(disk)[Secret Manager] in gcp
    service monitoring(internet)[Cloud Monitoring] in gcp

    group homelab(cloud)[Home Lab]
    service udm(server)[UDM Pro] in homelab
    service servers(server)[Bare Metal Servers] in homelab

    servers:L -- R:udm
    udm:R -- L:wg_nlb
    wg_nlb:R -- L:wireguard
    wireguard:R -- L:https_lb
    https_lb:R -- L:compute
    compute:B --&gt; T:storage
    compute:B --&gt; T:firestore
    compute:R --&gt; L:secrets
    compute:T --&gt; B:monitoring</pre><p><strong>Components</strong>:</p><ul><li><strong>Boot Server</strong>: Go service deployed to Cloud Run (or Compute Engine VM as fallback)<ul><li>HTTP/HTTPS server (using <code>z5labs/humus</code> framework with OpenAPI)</li><li>UEFI HTTP boot endpoint serving boot scripts and assets</li><li>HTTP REST admin API for boot configuration management</li></ul></li><li><strong>Cloud Storage</strong>: Buckets for boot images, boot scripts, kernels, initrd files</li><li><strong>Firestore/Datastore</strong>: Machine-to-image mapping database (MAC → boot profile)</li><li><strong>Secret Manager</strong>: WireGuard keys, TLS certificates (optional for HTTPS boot)</li><li><strong>Cloud Monitoring</strong>: Metrics for boot requests, success/failure rates, latency</li></ul><h4 id=boot-image-lifecycle>Boot Image Lifecycle</h4><p>The boot image lifecycle consists of two main workflows: initial configuration and boot requests. Boot profile updates are handled by creating a new profile with the same machine_id.</p><h5 id=admin-configuration-workflow>Admin Configuration Workflow</h5><pre class=mermaid>sequenceDiagram
    participant Admin
    participant MachineAPI as Machine Mgmt API
    participant BootAPI as Boot Service API
    participant Storage as Cloud Storage
    participant DB as Firestore
    participant Monitor as Cloud Monitoring

    Note over Admin,Monitor: 1. Register Machine Hardware Profile
    Admin-&gt;&gt;MachineAPI: POST /api/v1/machines (CPUs, memory, NICs, drives)
    MachineAPI-&gt;&gt;DB: Store machine hardware profile
    MachineAPI-&gt;&gt;Monitor: Log registration event
    MachineAPI-&gt;&gt;Admin: 201 Created (machine ID)

    Note over Admin,Monitor: 2. Create Boot Profile for Machine
    Admin-&gt;&gt;BootAPI: POST /api/v1/profiles (machine_id, kernel, initrd, metadata)
    BootAPI-&gt;&gt;BootAPI: Validate image integrity (checksum)
    BootAPI-&gt;&gt;Storage: Upload kernel to gs://boot-images/kernels/
    BootAPI-&gt;&gt;Storage: Upload initrd to gs://boot-images/initrd/
    BootAPI-&gt;&gt;DB: Store boot profile metadata (boot_profile_id, machine_id)
    BootAPI-&gt;&gt;Monitor: Log upload event
    BootAPI-&gt;&gt;Admin: 201 Created (boot_profile_id)</pre><h5 id=uefi-http-boot-request-workflow>UEFI HTTP Boot Request Workflow</h5><pre class=mermaid>sequenceDiagram
    participant Server as Home Lab Server
    participant BootAPI as Boot Service API
    participant MachineAPI as Machine Mgmt API
    participant Storage as Cloud Storage
    participant DB as Firestore
    participant Monitor as Cloud Monitoring

    Note right of Server: iLO 4 firmware v2.40&#43; initiates HTTP request
    Server-&gt;&gt;BootAPI: HTTP GET /boot.ipxe?mac=aa:bb:cc:dd:ee:ff&lt;br/&gt;(via WireGuard VPN)
    
    BootAPI-&gt;&gt;MachineAPI: GET /api/v1/machines?mac=aa:bb:cc:dd:ee:ff
    MachineAPI-&gt;&gt;DB: Query machine by MAC address
    MachineAPI-&gt;&gt;BootAPI: Return machine profile (machine_id)
    
    BootAPI-&gt;&gt;DB: Query boot profile by machine_id
    BootAPI-&gt;&gt;BootAPI: Generate iPXE script (kernel, initrd URLs)
    BootAPI-&gt;&gt;Monitor: Log boot script request
    BootAPI-&gt;&gt;Server: Send iPXE script (200 OK)
    
    Server-&gt;&gt;BootAPI: HTTP GET /asset/{boot_profile_id}/kernel
    BootAPI-&gt;&gt;DB: Query boot profile metadata (get kernel_object_id)
    BootAPI-&gt;&gt;Storage: Stream kernel using kernel_object_id
    BootAPI-&gt;&gt;Monitor: Log kernel download (size, duration)
    BootAPI-&gt;&gt;Server: Stream kernel file
    
    Server-&gt;&gt;BootAPI: HTTP GET /asset/{boot_profile_id}/initrd
    BootAPI-&gt;&gt;DB: Query boot profile metadata (get initrd_object_id)
    BootAPI-&gt;&gt;Storage: Stream initrd using initrd_object_id
    BootAPI-&gt;&gt;Monitor: Log initrd download
    BootAPI-&gt;&gt;Server: Stream initrd file
    
    Server-&gt;&gt;Server: Boot into OS</pre><h5 id=boot-profile-update-workflow>Boot Profile Update Workflow</h5><pre class=mermaid>sequenceDiagram
    participant Admin
    participant BootAPI as Boot Service API
    participant Storage as Cloud Storage
    participant DB as Firestore
    participant Monitor as Cloud Monitoring

    Note over Admin,Monitor: Update Boot Profile for Machine
    Admin-&gt;&gt;BootAPI: POST /api/v1/profiles (machine_id, new_kernel, new_initrd, metadata)
    BootAPI-&gt;&gt;BootAPI: Validate image integrity (checksum)
    BootAPI-&gt;&gt;Storage: Upload kernel to gs://boot-images/kernels/
    BootAPI-&gt;&gt;Storage: Upload initrd to gs://boot-images/initrd/
    BootAPI-&gt;&gt;DB: Store new boot profile (replaces previous profile for machine_id)
    BootAPI-&gt;&gt;Monitor: Log profile update event
    BootAPI-&gt;&gt;Admin: 201 Created (new_boot_profile_id)</pre><h4 id=implementation-details>Implementation Details</h4><p><strong>Development Stack</strong>:</p><ul><li><strong>Language</strong>: Go 1.24 (leverage existing Go expertise)</li><li><strong>HTTP Framework</strong>: <code>z5labs/humus</code> (consistent with existing services)</li><li><strong>UEFI Boot</strong>: Standard HTTP handlers (no special libraries needed)</li><li><strong>Storage Client</strong>: <code>cloud.google.com/go/storage</code></li><li><strong>Database</strong>: Firestore for machine mappings (or simple JSON config in Cloud Storage)</li><li><strong>Observability</strong>: OpenTelemetry (metrics, traces, logs to Cloud Monitoring/Trace)</li></ul><p><strong>Deployment</strong>:</p><ul><li><strong>Cloud Run</strong> (preferred - HTTP-only boot enables serverless deployment):<ul><li>Min instances: 1 (ensures fast boot response, avoids cold start delays)</li><li>Max instances: 2 (home lab scale)</li><li>Memory: 512MB</li><li>CPU: 1 vCPU</li><li>Health checks: <code>/health/startup</code>, <code>/health/liveness</code></li><li>Concurrency: 10 requests per instance</li></ul></li><li><strong>Alternative - Compute Engine VM</strong> (if Cloud Run latency unacceptable):<ul><li>e2-micro instance ($6.50/month)</li><li>Container-Optimized OS with Docker</li><li>systemd service for boot server</li><li>Health checks: <code>/health/startup</code>, <code>/health/liveness</code></li></ul></li><li><strong>Networking</strong>:<ul><li>VPC firewall: Allow TCP/80, TCP/443 from WireGuard subnet (no UDP/69 needed)</li><li>Static internal IP for boot server (Compute Engine) or HTTPS Load Balancer (Cloud Run)</li><li>Cloud NAT for outbound connectivity (Cloud Storage access)</li></ul></li></ul><p><strong>Configuration Management</strong>:</p><ul><li>Machine mappings stored in Firestore or Cloud Storage JSON files</li><li>Boot profiles defined in YAML (similar to Matchbox groups):<div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>profiles</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-22.04-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kernel</span><span class=p>:</span><span class=w> </span><span class=l>gs://boot-images/kernels/ubuntu-22.04.img</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>initrd</span><span class=p>:</span><span class=w> </span><span class=l>gs://boot-images/initrd/ubuntu-22.04.img</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cmdline</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;console=tty0 console=ttyS0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cloud_init</span><span class=p>:</span><span class=w> </span><span class=l>gs://boot-images/cloud-init/ubuntu-base.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>machines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>mac</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;aa:bb:cc:dd:ee:ff&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>profile</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-22.04-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>node-01</span><span class=w>
</span></span></span></code></pre></div></li></ul><p><strong>Cost Breakdown</strong>:</p><p><strong>Option A: Cloud Run Deployment</strong> (Preferred):</p><table><thead><tr><th>Component</th><th>Monthly Cost</th></tr></thead><tbody><tr><td>Cloud Run (1 min instance, 512MB, always-on)</td><td>$3.50</td></tr><tr><td>Cloud Storage (50GB boot images)</td><td>$1.00</td></tr><tr><td>Firestore (minimal reads/writes)</td><td>$0.50</td></tr><tr><td>Egress (10 boots × 150MB)</td><td>$0.18</td></tr><tr><td><strong>Total</strong></td><td><strong>~$5.18</strong></td></tr></tbody></table><p><strong>Option B: Compute Engine Deployment</strong> (If Cloud Run latency unacceptable):</p><table><thead><tr><th>Component</th><th>Monthly Cost</th></tr></thead><tbody><tr><td>e2-micro VM (boot server)</td><td>$6.50</td></tr><tr><td>Cloud Storage (50GB boot images)</td><td>$1.00</td></tr><tr><td>Firestore (minimal reads/writes)</td><td>$0.50</td></tr><tr><td>Egress (10 boots × 150MB)</td><td>$0.18</td></tr><tr><td><strong>Total</strong></td><td><strong>~$8.18</strong></td></tr></tbody></table><h4 id=pros-and-cons>Pros and Cons</h4><ul><li>Good, because UEFI HTTP boot eliminates TFTP complexity entirely</li><li>Good, because Cloud Run deployment option reduces operational overhead and infrastructure cost</li><li>Good, because full control over boot server implementation and features</li><li>Good, because leverages existing Go expertise and <code>z5labs/humus</code> framework patterns</li><li>Good, because seamless GCP integration (Cloud Storage, Firestore, Secret Manager, IAM)</li><li>Good, because minimal dependencies (no external projects to track)</li><li>Good, because customizable to specific home lab requirements</li><li>Good, because OpenTelemetry observability built-in from existing patterns</li><li>Good, because can optimize for home lab scale (&lt; 20 machines)</li><li>Good, because lightweight implementation (no unnecessary features)</li><li>Good, because simplified testing (HTTP-only, no TFTP/PXE edge cases)</li><li>Good, because standard HTTP serving is well-understood (lower risk than TFTP)</li><li>Neutral, because development effort required (2-3 weeks for MVP, reduced from 3-4 weeks)</li><li>Neutral, because requires ongoing maintenance and security updates</li><li>Neutral, because Cloud Run cold start latency needs validation (POC required)</li><li>Bad, because reinvents machine matching and boot configuration patterns</li><li>Bad, because testing network boot scenarios still requires hardware</li><li>Bad, because potential for bugs in custom implementation</li><li>Bad, because no community support or established best practices</li><li>Bad, because development time still longer than Matchbox (2-3 weeks vs 1 week)</li></ul><h3 id=option-2-matchbox-based-solution>Option 2: Matchbox-Based Solution</h3><p>Deploy <a href=https://matchbox.psdn.io/>Matchbox</a>, an open-source network boot server developed by CoreOS (now part of Red Hat), to handle UEFI HTTP boot workflows.</p><h4 id=architecture-overview-1>Architecture Overview</h4><pre class=mermaid>architecture-beta
    group gcp(cloud)[GCP VPC]
    
    service wg_nlb(internet)[Network LB] in gcp
    service wireguard(server)[WireGuard Gateway] in gcp
    service https_lb(internet)[HTTPS LB] in gcp
    service compute(server)[Compute Engine] in gcp
    service storage(database)[Cloud Storage] in gcp
    service secrets(disk)[Secret Manager] in gcp
    service monitoring(internet)[Cloud Monitoring] in gcp
    
    group homelab(cloud)[Home Lab]
    service udm(server)[UDM Pro] in homelab
    service servers(server)[Bare Metal Servers] in homelab
    
    servers:L -- R:udm
    udm:R -- L:wg_nlb
    wg_nlb:R -- L:wireguard
    wireguard:R -- L:https_lb
    https_lb:R -- L:compute
    compute:B --&gt; T:storage
    compute:R --&gt; L:secrets
    compute:T --&gt; B:monitoring</pre><p><strong>Components</strong>:</p><ul><li><strong>Matchbox Server</strong>: Container deployed to Cloud Run or Compute Engine VM<ul><li>HTTP/gRPC APIs for boot workflows and configuration</li><li>UEFI HTTP boot support (TFTP disabled)</li><li>Machine grouping and profile templating</li><li>Ignition, Cloud-Init, and generic boot support</li></ul></li><li><strong>Cloud Storage</strong>: Backend for boot assets (mounted via gcsfuse or synced periodically)</li><li><strong>Local Storage</strong> (Compute Engine only): <code>/var/lib/matchbox</code> for assets and configuration (synced from Cloud Storage)</li><li><strong>Secret Manager</strong>: WireGuard keys, Matchbox TLS certificates</li><li><strong>Cloud Monitoring</strong>: Logs from Matchbox container, custom metrics via log parsing</li></ul><h4 id=boot-image-lifecycle-1>Boot Image Lifecycle</h4><p>The Matchbox boot image lifecycle consists of three main workflows: configuration, boot request, and rollback.</p><h5 id=matchbox-configuration-workflow>Matchbox Configuration Workflow</h5><pre class=mermaid>sequenceDiagram
    participant Admin
    participant CLI as matchbox CLI / API
    participant Matchbox as Matchbox Server
    participant Storage as Cloud Storage
    participant Monitor as Cloud Monitoring

    Note over Admin,Monitor: 1. Upload Boot Assets
    Admin-&gt;&gt;CLI: Upload kernel/initrd via gRPC API
    CLI-&gt;&gt;Matchbox: gRPC CreateAsset(kernel, initrd)
    Matchbox-&gt;&gt;Matchbox: Validate asset integrity
    Matchbox-&gt;&gt;Matchbox: Store to /var/lib/matchbox/assets/
    Matchbox-&gt;&gt;Storage: Sync to gs://boot-assets/ (via sidecar script)
    Matchbox-&gt;&gt;Monitor: Log asset upload event
    Matchbox-&gt;&gt;CLI: Asset ID, checksum

    Note over Admin,Monitor: 2. Create Boot Profile
    Admin-&gt;&gt;CLI: Create profile YAML (kernel, initrd, cmdline)
    CLI-&gt;&gt;Matchbox: gRPC CreateProfile(profile.yaml)
    Matchbox-&gt;&gt;Matchbox: Store to /var/lib/matchbox/profiles/
    Matchbox-&gt;&gt;Storage: Sync profiles to gs://boot-config/
    Matchbox-&gt;&gt;CLI: Profile ID

    Note over Admin,Monitor: 3. Create Machine Group
    Admin-&gt;&gt;CLI: Create group YAML (MAC selector, profile mapping)
    CLI-&gt;&gt;Matchbox: gRPC CreateGroup(group.yaml)
    Matchbox-&gt;&gt;Matchbox: Store to /var/lib/matchbox/groups/
    Matchbox-&gt;&gt;Storage: Sync groups to gs://boot-config/
    Matchbox-&gt;&gt;CLI: Group ID</pre><h5 id=matchbox-uefi-http-boot-request-workflow>Matchbox UEFI HTTP Boot Request Workflow</h5><pre class=mermaid>sequenceDiagram
    participant Server as Home Lab Server
    participant Matchbox as Matchbox Server
    participant Monitor as Cloud Monitoring

    Note right of Server: iLO 4 firmware v2.40&#43; initiates HTTP request
    Server-&gt;&gt;Matchbox: HTTP GET /boot.ipxe?mac=aa:bb:cc:dd:ee:ff&lt;br/&gt;(via WireGuard VPN)
    Matchbox-&gt;&gt;Matchbox: Match MAC to group
    Matchbox-&gt;&gt;Matchbox: Render iPXE template with profile
    Matchbox-&gt;&gt;Monitor: Log boot request (MAC, group, profile)
    Matchbox-&gt;&gt;Server: Send iPXE script
    
    Server-&gt;&gt;Matchbox: HTTP GET /assets/ubuntu-22.04-kernel.img
    Matchbox-&gt;&gt;Matchbox: Serve from /var/lib/matchbox/assets/
    Matchbox-&gt;&gt;Monitor: Log asset download (size, duration)
    Matchbox-&gt;&gt;Server: Stream kernel file
    
    Server-&gt;&gt;Matchbox: HTTP GET /assets/ubuntu-22.04-initrd.img
    Matchbox-&gt;&gt;Matchbox: Serve from /var/lib/matchbox/assets/
    Matchbox-&gt;&gt;Monitor: Log asset download
    Matchbox-&gt;&gt;Server: Stream initrd file
    
    Server-&gt;&gt;Server: Boot into OS</pre><h5 id=matchbox-group-rollback-workflow>Matchbox Group Rollback Workflow</h5><pre class=mermaid>sequenceDiagram
    participant Admin
    participant CLI as matchbox CLI / API
    participant Matchbox as Matchbox Server
    participant Storage as Cloud Storage
    participant Monitor as Cloud Monitoring

    Note over Admin,Monitor: Rollback Machine Group to Previous Profile
    Admin-&gt;&gt;CLI: Update group YAML (change profile reference)
    CLI-&gt;&gt;Matchbox: gRPC UpdateGroup(group.yaml)
    Matchbox-&gt;&gt;Matchbox: Update /var/lib/matchbox/groups/
    Matchbox-&gt;&gt;Storage: Sync updated group config
    Matchbox-&gt;&gt;Monitor: Log group update
    Matchbox-&gt;&gt;CLI: Success</pre><h4 id=implementation-details-1>Implementation Details</h4><p><strong>Matchbox Deployment</strong>:</p><ul><li><strong>Container</strong>: <code>quay.io/poseidon/matchbox:latest</code> (official image)</li><li><strong>Deployment Options</strong>:<ul><li><strong>Cloud Run</strong> (preferred - HTTP-only boot enables serverless deployment):<ul><li>Min instances: 1 (ensures fast boot response)</li><li>Memory: 1GB RAM (Matchbox recommendation)</li><li>CPU: 1 vCPU</li><li>Storage: Cloud Storage for assets/profiles/groups (via HTTP API)</li></ul></li><li><strong>Compute Engine VM</strong> (if persistent local storage preferred):<ul><li>e2-small instance ($14/month, 2GB RAM recommended for Matchbox)</li><li><code>/var/lib/matchbox</code>: Persistent disk (10GB SSD, $1.70/month)</li><li>Cloud Storage sync: Periodic backup of assets/profiles/groups to <code>gs://matchbox-config/</code></li><li>Option: Use <code>gcsfuse</code> to mount Cloud Storage directly (adds latency but simplifies backups)</li></ul></li></ul></li></ul><p><strong>Configuration Structure</strong>:</p><pre tabindex=0><code>/var/lib/matchbox/
├── assets/           # Boot images (kernels, initrds, ISOs)
│   ├── ubuntu-22.04-kernel.img
│   ├── ubuntu-22.04-initrd.img
│   └── flatcar-stable.img.gz
├── profiles/         # Boot profiles (YAML)
│   ├── ubuntu-server.yaml
│   └── flatcar-container.yaml
└── groups/           # Machine groups (YAML)
    ├── default.yaml
    ├── node-01.yaml
    └── storage-nodes.yaml
</code></pre><p><strong>Example Profile</strong> (<code>profiles/ubuntu-server.yaml</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-22.04-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Ubuntu 22.04 LTS Server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>boot</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kernel</span><span class=p>:</span><span class=w> </span><span class=l>/assets/ubuntu-22.04-kernel.img</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>initrd</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>/assets/ubuntu-22.04-initrd.img</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>console=tty0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>console=ttyS0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ip=dhcp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ignition_id</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-base.yaml</span><span class=w>
</span></span></span></code></pre></div><p><strong>Example Group</strong> (<code>groups/node-01.yaml</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>node-01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Node 01 - Ubuntu Server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>profile</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-22.04-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mac</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;aa:bb:cc:dd:ee:ff&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>node-01.homelab.local</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ssh_authorized_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s2>&#34;ssh-ed25519 AAAA...&#34;</span><span class=w>
</span></span></span></code></pre></div><p><strong>GCP Integration</strong>:</p><ul><li><strong>Cloud Storage Sync</strong>: Cron job or sidecar container to sync <code>/var/lib/matchbox</code> to Cloud Storage<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Sync every 5 minutes</span>
</span></span><span class=line><span class=cl>*/5 * * * * gsutil -m rsync -r /var/lib/matchbox gs://matchbox-config/
</span></span></code></pre></div></li><li><strong>Secret Manager</strong>: Store Matchbox TLS certificates for gRPC API authentication</li><li><strong>Cloud Monitoring</strong>: Ship Matchbox logs to Cloud Logging, parse for metrics:<ul><li>Boot request count by MAC/group</li><li>Asset download success/failure rates</li><li>TFTP vs HTTP request distribution</li></ul></li></ul><p><strong>Networking</strong>:</p><ul><li>VPC firewall: Allow TCP/8080 (HTTP), TCP/8081 (gRPC) from WireGuard subnet (no UDP/69 needed)</li><li>Optional: Internal load balancer if high availability required (adds ~$18/month)</li><li>Note: Cloud Run deployment includes integrated HTTPS load balancing</li></ul><p><strong>Cost Breakdown</strong>:</p><p><strong>Option A: Cloud Run Deployment</strong> (Preferred):</p><table><thead><tr><th>Component</th><th>Monthly Cost</th></tr></thead><tbody><tr><td>Cloud Run (1 min instance, 1GB RAM, always-on)</td><td>$7.00</td></tr><tr><td>Cloud Storage (50GB boot images)</td><td>$1.00</td></tr><tr><td>Egress (10 boots × 150MB)</td><td>$0.18</td></tr><tr><td><strong>Total</strong></td><td><strong>~$8.18</strong></td></tr></tbody></table><p><strong>Option B: Compute Engine Deployment</strong> (If persistent local storage preferred):</p><table><thead><tr><th>Component</th><th>Monthly Cost</th></tr></thead><tbody><tr><td>e2-small VM (Matchbox server)</td><td>$14.00</td></tr><tr><td>Persistent SSD (10GB)</td><td>$1.70</td></tr><tr><td>Cloud Storage (50GB backups)</td><td>$1.00</td></tr><tr><td>Egress (10 boots × 150MB)</td><td>$0.18</td></tr><tr><td><strong>Total</strong></td><td><strong>~$16.88</strong></td></tr></tbody></table><h4 id=pros-and-cons-1>Pros and Cons</h4><ul><li>Good, because HTTP-only boot enables Cloud Run deployment (reduces cost significantly)</li><li>Good, because UEFI HTTP boot eliminates TFTP complexity and potential failure points</li><li>Good, because production-ready boot server with extensive real-world usage</li><li>Good, because feature-complete with machine grouping, templating, and multi-OS support</li><li>Good, because gRPC API for programmatic boot configuration management</li><li>Good, because supports Ignition (Flatcar, CoreOS), Cloud-Init, and generic boot workflows</li><li>Good, because well-documented with established best practices</li><li>Good, because active community and upstream maintenance (Red Hat/CoreOS)</li><li>Good, because reduces development time to days (deploy + configure vs weeks of coding)</li><li>Good, because avoids reinventing network boot patterns (machine matching, boot configuration)</li><li>Good, because proven security model (TLS for gRPC, asset integrity checks)</li><li>Neutral, because requires learning Matchbox configuration patterns (YAML profiles/groups)</li><li>Neutral, because containerized deployment (Docker on Compute Engine or Cloud Run)</li><li>Neutral, because Cloud Run deployment option competitive with custom implementation cost</li><li>Bad, because introduces external dependency (Matchbox project maintenance)</li><li>Bad, because some features unnecessary for home lab scale (large-scale provisioning, etcd backend)</li><li>Bad, because less control over implementation details (limited customization)</li><li>Bad, because Cloud Storage integration requires custom sync scripts (Matchbox doesn&rsquo;t natively support GCS backend)</li><li>Bad, because dependency on upstream for security patches and bug fixes</li></ul><h2 id=uefi-http-boot-architecture>UEFI HTTP Boot Architecture</h2><p>This section documents the UEFI HTTP boot capability that fundamentally changes the network boot infrastructure design.</p><h3 id=boot-process-overview>Boot Process Overview</h3><p><strong>Traditional PXE Boot</strong> (NOT USED - shown for comparison):</p><pre class=mermaid>sequenceDiagram
    participant Server as Bare Metal Server
    participant DHCP as DHCP Server
    participant TFTP as TFTP Server
    participant HTTP as HTTP Server

    Note over Server,HTTP: Traditional PXE Boot Chain (NOT USED)
    Server-&gt;&gt;DHCP: DHCP Discover
    DHCP-&gt;&gt;Server: DHCP Offer (TFTP server, boot filename)
    Server-&gt;&gt;TFTP: TFTP GET /pxelinux.0
    TFTP-&gt;&gt;Server: Send PXE bootloader
    Server-&gt;&gt;TFTP: TFTP GET /ipxe.efi
    TFTP-&gt;&gt;Server: Send iPXE binary
    Server-&gt;&gt;HTTP: HTTP GET /boot.ipxe
    HTTP-&gt;&gt;Server: Send boot script
    Server-&gt;&gt;HTTP: HTTP GET /kernel, /initrd
    HTTP-&gt;&gt;Server: Stream boot files</pre><p><strong>UEFI HTTP Boot</strong> (ACTUAL IMPLEMENTATION):</p><pre class=mermaid>sequenceDiagram
    participant Server as HP DL360 Gen 9&lt;br/&gt;(iLO 4 v2.40&#43;)
    participant DHCP as DHCP Server&lt;br/&gt;(UDM Pro)
    participant VPN as WireGuard VPN
    participant HTTP as HTTP Boot Server&lt;br/&gt;(GCP Cloud Run)

    Note over Server,HTTP: UEFI HTTP Boot (ACTUAL IMPLEMENTATION)
    Server-&gt;&gt;DHCP: DHCP Discover
    DHCP-&gt;&gt;Server: DHCP Offer (boot URL: http://boot.internal/boot.ipxe?mac=...)
    Note right of Server: Firmware initiates HTTP request directly&lt;br/&gt;(no TFTP/PXE chain loading)
    Server-&gt;&gt;VPN: WireGuard tunnel established
    Server-&gt;&gt;HTTP: HTTP GET /boot.ipxe?mac=aa:bb:cc:dd:ee:ff
    HTTP-&gt;&gt;Server: Send boot script with kernel/initrd URLs
    Server-&gt;&gt;HTTP: HTTP GET /assets/talos-kernel.img
    HTTP-&gt;&gt;Server: Stream kernel (via WireGuard)
    Server-&gt;&gt;HTTP: HTTP GET /assets/talos-initrd.img
    HTTP-&gt;&gt;Server: Stream initrd (via WireGuard)
    Server-&gt;&gt;Server: Boot into OS</pre><h3 id=key-differences>Key Differences</h3><table><thead><tr><th>Aspect</th><th>Traditional PXE</th><th>UEFI HTTP Boot</th></tr></thead><tbody><tr><td><strong>Initial Protocol</strong></td><td>TFTP (UDP/69)</td><td>HTTP (TCP/80) or HTTPS (TCP/443)</td></tr><tr><td><strong>Boot Loader</strong></td><td>Requires TFTP transfer of iPXE binary</td><td>Firmware has HTTP client built-in</td></tr><tr><td><strong>Chain Loading</strong></td><td>PXE → TFTP → iPXE → HTTP</td><td>Direct HTTP boot (no chain)</td></tr><tr><td><strong>Firewall Rules</strong></td><td>UDP/69, TCP/80, TCP/443</td><td>TCP/80, TCP/443 only</td></tr><tr><td><strong>Cloud Run Support</strong></td><td>❌ (UDP not supported)</td><td>✅ (HTTP-only)</td></tr><tr><td><strong>Transfer Speed</strong></td><td>~1-5 Mbps (TFTP)</td><td>10-100 Mbps (HTTP)</td></tr><tr><td><strong>Complexity</strong></td><td>High (multiple protocols)</td><td>Low (HTTP-only)</td></tr></tbody></table><h3 id=security-architecture>Security Architecture</h3><p><strong>Challenge</strong>: HP DL360 Gen 9 UEFI HTTP boot does not support client-side TLS certificates (mTLS).</p><p><strong>Solution</strong>: WireGuard VPN provides transport-layer security:</p><pre class=mermaid>flowchart LR
    subgraph homelab[Home Lab]
        server[HP DL360 Gen 9&lt;br/&gt;UEFI HTTP Boot&lt;br/&gt;iLO 4 v2.40&#43;]
        udm[UDM Pro&lt;br/&gt;WireGuard Client]
    end

    subgraph gcp[Google Cloud Platform]
        wg_gw[WireGuard Gateway&lt;br/&gt;Compute Engine]
        cr[Boot Server&lt;br/&gt;Cloud Run]
    end

    server --&gt;|HTTP| udm
    udm --&gt;|Encrypted WireGuard Tunnel| wg_gw
    wg_gw --&gt;|HTTP| cr

    style server fill:#f9f,stroke:#333
    style udm fill:#bbf,stroke:#333
    style wg_gw fill:#bfb,stroke:#333
    style cr fill:#fbb,stroke:#333</pre><p><strong>Why WireGuard instead of Cloudflare mTLS?</strong></p><ul><li><strong>Cloudflare mTLS Limitation</strong>: Requires client certificates at TLS layer</li><li><strong>UEFI Firmware Limitation</strong>: Cannot present client certificates during TLS handshake</li><li><strong>WireGuard Solution</strong>: Provides mutual authentication at network layer (pre-shared keys)</li><li><strong>Security Equivalent</strong>: WireGuard offers same security properties as mTLS:<ul><li>Mutual authentication (both endpoints authenticated)</li><li>Confidentiality (all traffic encrypted)</li><li>Integrity (authenticated encryption via ChaCha20-Poly1305)</li><li>No Internet exposure (boot server only accessible via VPN)</li></ul></li></ul><h3 id=firmware-configuration>Firmware Configuration</h3><p><strong>HP iLO 4 UEFI HTTP Boot Setup</strong>:</p><ol><li><p><strong>Access Configuration</strong>:</p><ul><li>iLO web interface → Remote Console → Power On → Press F9 (RBSU)</li><li>Or: Direct RBSU access during POST (Press F9)</li></ul></li><li><p><strong>Enable UEFI HTTP Boot</strong>:</p><ul><li>Navigate: <code>System Configuration → BIOS/Platform Configuration (RBSU) → Network Options</code></li><li>Set <code>Network Boot</code> to <code>Enabled</code></li><li>Set <code>Boot Mode</code> to <code>UEFI</code> (not Legacy BIOS)</li><li>Enable <code>UEFI HTTP Boot Support</code></li></ul></li><li><p><strong>Configure NIC</strong>:</p><ul><li>Navigate: <code>RBSU → Network Options → [FlexibleLOM/PCIe NIC]</code></li><li>Set <code>Option ROM</code> to <code>Enabled</code> (required for UEFI boot option to appear)</li><li>Set <code>Network Boot</code> to <code>Enabled</code></li><li>Configure IPv4/IPv6 settings (DHCP or static)</li></ul></li><li><p><strong>Set Boot Order</strong>:</p><ul><li>Navigate: <code>RBSU → Boot Options → UEFI Boot Order</code></li><li>Move network device to top priority</li></ul></li><li><p><strong>Configure Boot URL</strong> (via DHCP or static):</p><ul><li>DHCP option 67: <code>http://10.x.x.x/boot.ipxe?mac=${net0/mac}</code></li><li>Or: Static configuration in UEFI System Utilities</li></ul></li></ol><p><strong>Required Firmware Versions</strong>:</p><ul><li><strong>iLO 4</strong>: v2.40 or later (for UEFI HTTP boot support)</li><li><strong>System ROM</strong>: P89 v2.60 or later (recommended)</li></ul><p><strong>Verification</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Check iLO firmware version via REST API</span>
</span></span><span class=line><span class=cl>curl -k -u admin:password https://ilo-address/redfish/v1/Managers/1/ <span class=p>|</span> jq <span class=s1>&#39;.FirmwareVersion&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Expected output: &#34;2.40&#34; or higher</span>
</span></span></code></pre></div><h3 id=architectural-implications>Architectural Implications</h3><p><strong>TFTP Elimination Impact</strong>:</p><ol><li><strong>Deployment</strong>: Cloud Run becomes viable (no UDP/TFTP requirement)</li><li><strong>Cost</strong>: Reduced infrastructure costs (~$5-8/month vs $8-17/month)</li><li><strong>Complexity</strong>: Simplified networking (TCP-only firewall rules)</li><li><strong>Development</strong>: Reduced effort (no TFTP library, testing, edge cases)</li><li><strong>Scalability</strong>: Cloud Run autoscaling vs fixed VM capacity</li><li><strong>Maintenance</strong>: Serverless reduces operational overhead</li></ol><p><strong>Decision Impact</strong>:</p><p>The removal of TFTP complexity fundamentally shifts the cost/benefit analysis:</p><ul><li><strong>Custom Implementation</strong>: More attractive (Cloud Run, reduced development time)</li><li><strong>Matchbox</strong>: Still valid but cost/complexity advantage reduced</li><li><strong>TCO Gap</strong>: Narrowed from ~$8,000-12,000 to ~$4,000-8,000 (Year 1)</li><li><strong>Development Gap</strong>: Reduced from 2-3 weeks to 1-2 weeks</li></ul><h2 id=detailed-comparison>Detailed Comparison</h2><h3 id=feature-comparison>Feature Comparison</h3><table><thead><tr><th>Feature</th><th>Custom Implementation</th><th>Matchbox</th></tr></thead><tbody><tr><td><strong>UEFI HTTP Boot</strong></td><td>✅ Native (standard HTTP)</td><td>✅ Built-in</td></tr><tr><td><strong>HTTP/HTTPS Boot</strong></td><td>✅ Via z5labs/humus</td><td>✅ Built-in</td></tr><tr><td><strong>Cloud Run Deployment</strong></td><td>✅ Preferred option</td><td>✅ Enabled by HTTP-only</td></tr><tr><td><strong>Boot Scripting</strong></td><td>✅ Custom templates</td><td>✅ Go templates</td></tr><tr><td><strong>Machine-to-Image Mapping</strong></td><td>✅ Firestore/JSON</td><td>✅ YAML groups with selectors</td></tr><tr><td><strong>Boot Profile Management</strong></td><td>✅ Custom API</td><td>✅ gRPC API + YAML</td></tr><tr><td><strong>Cloud-Init Support</strong></td><td>⚠️ Requires implementation</td><td>✅ Native support</td></tr><tr><td><strong>Ignition Support</strong></td><td>❌ Not planned</td><td>✅ Native support (Flatcar, CoreOS)</td></tr><tr><td><strong>Asset Versioning</strong></td><td>⚠️ Requires implementation</td><td>⚠️ Manual (via Cloud Storage versioning)</td></tr><tr><td><strong>Rollback Capability</strong></td><td>⚠️ Requires implementation</td><td>✅ Update group to previous profile</td></tr><tr><td><strong>OpenTelemetry Observability</strong></td><td>✅ Built-in</td><td>⚠️ Logs only (requires parsing)</td></tr><tr><td><strong>GCP Cloud Storage Integration</strong></td><td>✅ Native SDK</td><td>⚠️ Requires sync scripts</td></tr><tr><td><strong>HTTP REST Admin API</strong></td><td>✅ Native (z5labs/humus)</td><td>⚠️ gRPC only</td></tr><tr><td><strong>Multi-Environment Support</strong></td><td>⚠️ Requires implementation</td><td>✅ Groups + metadata</td></tr></tbody></table><h3 id=development-effort-comparison>Development Effort Comparison</h3><table><thead><tr><th>Task</th><th>Custom Implementation</th><th>Matchbox</th></tr></thead><tbody><tr><td><strong>Initial Setup</strong></td><td>1-2 days (project scaffolding)</td><td>4-8 hours (deployment + config)</td></tr><tr><td><strong>UEFI HTTP Boot</strong></td><td>1-2 days (standard HTTP endpoints)</td><td>✅ Included</td></tr><tr><td><strong>HTTP Boot API</strong></td><td>2-3 days (z5labs/humus endpoints)</td><td>✅ Included</td></tr><tr><td><strong>Machine Matching Logic</strong></td><td>2-3 days (database queries, selectors)</td><td>✅ Included</td></tr><tr><td><strong>Boot Script Templates</strong></td><td>2-3 days (boot script templating)</td><td>✅ Included</td></tr><tr><td><strong>Cloud-Init Support</strong></td><td>3-5 days (parsing, injection)</td><td>✅ Included</td></tr><tr><td><strong>Asset Management</strong></td><td>2-3 days (upload, storage)</td><td>✅ Included</td></tr><tr><td><strong>HTTP REST Admin API</strong></td><td>2-3 days (OpenAPI endpoints)</td><td>✅ Included (gRPC)</td></tr><tr><td><strong>Cloud Run Deployment</strong></td><td>1 day (Cloud Run config)</td><td>1 day (Cloud Run config)</td></tr><tr><td><strong>Testing</strong></td><td>3-5 days (unit, integration, E2E - simplified)</td><td>2-3 days (integration only)</td></tr><tr><td><strong>Documentation</strong></td><td>2-3 days</td><td>1 day (reference existing docs)</td></tr><tr><td><strong>Total Effort</strong></td><td><strong>2-3 weeks</strong></td><td><strong>1 week</strong></td></tr></tbody></table><h3 id=operational-complexity>Operational Complexity</h3><table><thead><tr><th>Aspect</th><th>Custom Implementation</th><th>Matchbox</th></tr></thead><tbody><tr><td><strong>Deployment</strong></td><td>Docker container on Compute Engine</td><td>Docker container on Compute Engine</td></tr><tr><td><strong>Configuration Updates</strong></td><td>API calls or Terraform updates</td><td>YAML file updates + API/filesystem sync</td></tr><tr><td><strong>Monitoring</strong></td><td>OpenTelemetry metrics to Cloud Monitoring</td><td>Log parsing + custom metrics</td></tr><tr><td><strong>Troubleshooting</strong></td><td>Full access to code, custom logging</td><td>Matchbox logs + gRPC API inspection</td></tr><tr><td><strong>Security Patches</strong></td><td>Manual code updates</td><td>Upstream container image updates</td></tr><tr><td><strong>Dependency Updates</strong></td><td>Manual Go module updates</td><td>Upstream Matchbox updates</td></tr><tr><td><strong>Backup/Restore</strong></td><td>Cloud Storage + Firestore backups</td><td>Sync <code>/var/lib/matchbox</code> to Cloud Storage</td></tr></tbody></table><h3 id=cost-comparison-summary>Cost Comparison Summary</h3><p><strong>Comparing Cloud Run Deployments</strong> (Preferred for both options):</p><table><thead><tr><th>Item</th><th>Custom (Cloud Run)</th><th>Matchbox (Cloud Run)</th><th>Difference</th></tr></thead><tbody><tr><td><strong>Compute</strong></td><td>Cloud Run ($3.50/month)</td><td>Cloud Run ($7/month)</td><td>+$3.50/month</td></tr><tr><td><strong>Storage</strong></td><td>Cloud Storage ($1/month)</td><td>Cloud Storage ($1/month)</td><td>$0</td></tr><tr><td><strong>Development</strong></td><td>2-3 weeks @ $100/hour = $8,000-12,000</td><td>1 week @ $100/hour = $4,000</td><td>-$4,000-8,000</td></tr><tr><td><strong>Annual Infrastructure</strong></td><td>~$54</td><td>~$96</td><td>+$42/year</td></tr><tr><td><strong>TCO (Year 1)</strong></td><td>~$8,054-12,054</td><td>~$4,096</td><td><strong>-$3,958-7,958</strong></td></tr><tr><td><strong>TCO (Year 3)</strong></td><td>~$8,162-12,162</td><td>~$4,288</td><td><strong>-$3,874-7,874</strong></td></tr></tbody></table><p><strong>Key Insights</strong>:</p><ul><li>UEFI HTTP boot enables Cloud Run deployment for both options, dramatically reducing infrastructure costs</li><li>Custom implementation TCO gap narrowed from $7,895-11,895 to $3,958-7,958 (Year 1)</li><li>Both options now cost ~$5-8/month for infrastructure (vs $8-17/month with TFTP)</li><li>Development time difference reduced from 2-3 weeks to 1-2 weeks</li><li>Decision is much closer than originally assessed</li></ul><h3 id=risk-analysis>Risk Analysis</h3><table><thead><tr><th>Risk</th><th>Custom Implementation</th><th>Matchbox</th><th>Mitigation</th></tr></thead><tbody><tr><td><strong>Security Vulnerabilities</strong></td><td>Medium (standard HTTP code, well-understood)</td><td>Medium (upstream dependency)</td><td>Both: Monitor for security updates, automated deployments</td></tr><tr><td><strong>Boot Failures</strong></td><td>Medium (HTTP-only reduces complexity)</td><td>Low (battle-tested)</td><td>Custom: Comprehensive E2E testing with real hardware</td></tr><tr><td><strong>Cloud Run Cold Starts</strong></td><td>Medium (needs validation)</td><td>Medium (needs validation)</td><td>Both: Min instances = 1 (always-on)</td></tr><tr><td><strong>Maintenance Burden</strong></td><td>Medium (ongoing code maintenance)</td><td>Low (upstream handles updates)</td><td>Both: Automated deployment pipelines</td></tr><tr><td><strong>GCP Integration Issues</strong></td><td>Low (native SDK)</td><td>Medium (sync scripts)</td><td>Matchbox: Robust sync with error handling</td></tr><tr><td><strong>Scalability Limits</strong></td><td>Low (Cloud Run autoscaling)</td><td>Low (handles thousands of nodes)</td><td>Both: Monitor boot request latency</td></tr><tr><td><strong>Dependency Abandonment</strong></td><td>N/A (no external deps)</td><td>Low (Red Hat backing)</td><td>Matchbox: Can fork if necessary</td></tr></tbody></table><h2 id=implementation-plan>Implementation Plan</h2><h3 id=phase-1-machine-management-service-week-1>Phase 1: Machine Management Service (Week 1)</h3><ol><li><p><strong>Project Setup</strong> (1-2 days)</p><ul><li>Create Go project with <code>z5labs/humus</code> framework</li><li>Set up OpenAPI specification for HTTP REST admin API</li><li>Configure Cloud Storage and Firestore clients</li><li>Implement basic health check endpoints</li></ul></li><li><p><strong>Machine Data Model</strong> (2-3 days)</p><ul><li>Define machine hardware specification schema (CPUs, memory, NICs, drives, accelerators)</li><li>Firestore schema design for machine profiles</li><li>MAC address indexing for efficient lookups</li></ul></li><li><p><strong>Machine Management API</strong> (2-3 days)</p><ul><li>Machine registration endpoints</li><li>MAC address to profile mapping</li><li>Machine listing and updates</li><li>Firestore integration for machine mappings</li></ul></li></ol><h3 id=phase-2-boot-service-week-2>Phase 2: Boot Service (Week 2)</h3><ol><li><p><strong>Boot Profile Management</strong> (2-3 days)</p><ul><li>Boot profile creation endpoint (<code>POST /api/v1/profiles</code>) with machine_id, kernel/initrd upload</li><li>Business logic: one active boot profile per machine_id (creating new profile replaces previous)</li><li>Cloud Storage integration for boot asset storage</li><li>Firestore integration for boot profile metadata with machine_id indexing</li></ul></li><li><p><strong>UEFI HTTP Boot Endpoints</strong> (2-3 days)</p><ul><li>HTTP endpoint serving boot scripts (<code>GET /boot.ipxe</code> in iPXE format)</li><li>Kernel and initrd streaming endpoints (<code>GET /asset/{boot_profile_id}/kernel</code>, <code>GET /asset/{boot_profile_id}/initrd</code>)</li><li>MAC-based machine lookup via Machine Management Service API</li><li>Boot script templating with machine-specific parameters</li><li>Direct Cloud Storage streaming for boot assets</li></ul></li><li><p><strong>Testing & Deployment</strong> (2-3 days)</p><ul><li>Deploy both services to Cloud Run with min instances = 1</li><li>Configure WireGuard VPN connectivity</li><li>Test UEFI HTTP boot from HP DL360 Gen 9 (iLO 4 v2.40+)</li><li>Validate boot latency and service-to-service communication</li></ul></li></ol><h3 id=phase-3-integration--observability-week-2-3>Phase 3: Integration & Observability (Week 2-3)</h3><ol><li><p><strong>Service Integration</strong> (1-2 days)</p><ul><li>Configure service-to-service authentication (if needed)</li><li>Optimize streaming performance between services</li><li>Handle error scenarios and fallbacks</li></ul></li><li><p><strong>Observability & Documentation</strong> (2-3 days)</p><ul><li>OpenTelemetry metrics integration (both services)</li><li>Distributed tracing across services</li><li>Cloud Monitoring dashboards</li><li>API documentation with RFC 7807 error response examples</li><li>Operational runbooks</li></ul></li></ol><h3 id=success-criteria>Success Criteria</h3><ul><li>✅ Successfully boot HP DL360 Gen 9 via UEFI HTTP boot through WireGuard VPN</li><li>✅ Boot latency &lt; 100ms for HTTP requests to Boot Service</li><li>✅ Service-to-service latency &lt; 50ms (Boot Service → Machine Management Service)</li><li>✅ Cloud Run cold start latency &lt; 100ms (with min instances = 1 for both services)</li><li>✅ Machine-to-profile mapping works correctly based on MAC address lookup</li><li>✅ Cloud Storage integration functional (upload boot assets, stream to servers)</li><li>✅ HTTP REST API fully functional for machine and boot profile management</li><li>✅ Firestore stores machine hardware profiles and boot profile metadata correctly</li><li>✅ RFC 7807 error responses implemented consistently across all API endpoints</li><li>✅ OpenTelemetry distributed tracing works across both services</li><li>✅ Configuration update workflow clear and documented</li><li>✅ Firmware compatibility confirmed (no TFTP fallback needed)</li></ul><h2 id=more-information>More Information</h2><h3 id=related-resources>Related Resources</h3><ul><li><a href=https://matchbox.psdn.io/>Matchbox Documentation</a></li><li><a href=https://github.com/poseidon/matchbox>Matchbox GitHub Repository</a></li><li><a href=https://ipxe.org/howto/chainloading>iPXE Boot Process</a></li><li><a href=https://en.wikipedia.org/wiki/Preboot_Execution_Environment>PXE Boot Specification</a></li><li><a href=https://www.flatcar.org/docs/latest/provisioning/network-boot/>Flatcar Linux Provisioning with Matchbox</a></li><li><a href=https://coreos.github.io/ignition/>CoreOS Ignition Specification</a></li><li><a href=https://cloudinit.readthedocs.io/>Cloud-Init Documentation</a></li></ul><h3 id=related-adrs>Related ADRs</h3><ul><li><a href=./0002-network-boot-architecture/>ADR-0002: Network Boot Architecture</a> - Established cloud-hosted boot server with VPN</li><li><a href=./0003-cloud-provider-selection/>ADR-0003: Cloud Provider Selection</a> - Selected GCP as hosting provider</li><li><a href=./0007-standard-api-error-response/>ADR-0007: Standard API Error Response Format</a> - RFC 7807 Problem Details for error handling</li><li><a href=./0001-use-madr-for-architecture-decision-records/>ADR-0001: Use MADR for Architecture Decision Records</a> - MADR format</li></ul><h3 id=future-considerations>Future Considerations</h3><ol><li><strong>High Availability</strong>: If boot server uptime becomes critical, evaluate multi-region deployment or failover strategies</li><li><strong>Multi-Cloud</strong>: If multi-cloud strategy emerges, custom implementation provides better portability</li><li><strong>Enterprise Features</strong>: If advanced provisioning workflows required (bare metal Kubernetes, Ignition support, etc.), evaluate adding features to custom implementation</li><li><strong>Asset Versioning</strong>: Implement comprehensive boot image versioning and rollback capabilities beyond basic Cloud Storage versioning</li><li><strong>Multi-Environment Support</strong>: Add support for multiple environments (dev, staging, prod) with environment-specific boot profiles</li></ol><h3 id=related-issues>Related Issues</h3><ul><li><a href=https://github.com/Zaba505/infra/issues/601>Issue #601</a> - story(docs): create adr for network boot infrastructure on google cloud</li><li><a href=https://github.com/Zaba505/infra/issues/595>Issue #595</a> - story(docs): create adr for network boot architecture</li><li><a href=https://github.com/Zaba505/infra/issues/597>Issue #597</a> - story(docs): create adr for cloud provider selection</li></ul><div class=td-page-meta__lastmod>Last modified November 24, 2025: <a data-proofer-ignore href=https://github.com/Zaba505/infra/commit/64cbcde5b60d7f17703cca35b8a9b15d4419e1d0>Merge 21609e5f93ee0ada123aa386d6bc94dc4297489c into 0365091529941d020b104dd5b7694d85078e5b00 (64cbcde)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/Zaba505/infra aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024&ndash;2025
<span class=td-footer__authors>Zaba505 | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script type=module async>
  import mermaid from "https:\/\/cdn.jsdelivr.net\/npm\/mermaid@latest\/dist\/mermaid.esm.min.mjs";

  (function ($) {
    if ($('.mermaid').length == 0) {
      mermaid.initialize({ startOnLoad: false });
      return;
    }

    var params = {};

    
    
    var norm = function (defaultConfig, params) {
      var result = {};
      for (const key in defaultConfig) {
        const keyLower = key.toLowerCase();
        if (defaultConfig.hasOwnProperty(key) && params.hasOwnProperty(keyLower)) {
          if (typeof defaultConfig[key] === "object") {
            result[key] = norm(defaultConfig[key], params[keyLower]);
          } else {
            result[key] = params[keyLower];
          }
        }
      }
      return result;
    };

    var settings = norm(mermaid.mermaidAPI.defaultConfig, params);
    settings.startOnLoad = true;
    if ($('html[data-bs-theme="dark"]').length) {
      settings.theme = 'dark';
    }
    mermaid.initialize(settings);

    
    const lightDarkModeThemeChangeHandler = function (mutationsList, observer) {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {
          
          
          
          location.reload();
        }
      }
    };

    const observer = new MutationObserver(lightDarkModeThemeChangeHandler);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-bs-theme']
    });
    

  })(jQuery);
</script><script src=/infra/pr-preview/pr-626/js/main.min.eb40505784d893e4b5c8dbd67b59c353e735d847f4ffbfe9d6921dec08dbacba.js integrity="sha256-60BQV4TYk+S1yNvWe1nDU+c12Ef0/7/p1pId7AjbrLo=" crossorigin=anonymous></script><script defer src=/infra/pr-preview/pr-626/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/infra/pr-preview/pr-626/js/tabpane-persist.js></script></body></html>