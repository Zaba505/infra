<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/infra/pr-preview/pr-626/favicons/favicon.ico><link rel=apple-touch-icon href=/infra/pr-preview/pr-626/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-192x192.png sizes=192x192><title>Cloud Storage FUSE (gcsfuse) | Zaba505's Home Lab</title><meta name=description content="Analysis of Google Cloud Storage FUSE for mounting GCS buckets as local filesystems in network boot infrastructure"><meta property="og:url" content="https://zaba505.github.io/infra/pr-preview/pr-626/rd/analysis/google-cloud/gcsfuse/"><meta property="og:site_name" content="Zaba505's Home Lab"><meta property="og:title" content="Cloud Storage FUSE (gcsfuse)"><meta property="og:description" content="Analysis of Google Cloud Storage FUSE for mounting GCS buckets as local filesystems in network boot infrastructure"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="r&amp;d"><meta property="article:modified_time" content="2025-11-23T17:19:54+00:00"><meta itemprop=name content="Cloud Storage FUSE (gcsfuse)"><meta itemprop=description content="Analysis of Google Cloud Storage FUSE for mounting GCS buckets as local filesystems in network boot infrastructure"><meta itemprop=dateModified content="2025-11-23T17:19:54+00:00"><meta itemprop=wordCount content="1934"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cloud Storage FUSE (gcsfuse)"><meta name=twitter:description content="Analysis of Google Cloud Storage FUSE for mounting GCS buckets as local filesystems in network boot infrastructure"><link rel=preload href=/infra/pr-preview/pr-626/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css as=style integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><link href=/infra/pr-preview/pr-626/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css rel=stylesheet integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/infra/pr-preview/pr-626/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Zaba505's Home Lab</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/infra/pr-preview/pr-626/offline-search-index.54f2cf6263a4588e01e1b94a683e332f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/infra/pr-preview/pr-626/offline-search-index.54f2cf6263a4588e01e1b94a683e332f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-infrapr-previewpr-626-li><a href=/infra/pr-preview/pr-626/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-infrapr-previewpr-626><span>Zaba505's Home Lab</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626physical_infrastructure-li><a href=/infra/pr-preview/pr-626/physical_infrastructure/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626physical_infrastructure><span>Physical Infrastructure</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-infrapr-previewpr-626rd-li><a href=/infra/pr-preview/pr-626/rd/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rd><span>Research and Development</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-infrapr-previewpr-626rdanalysis-li><a href=/infra/pr-preview/pr-626/rd/analysis/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysis><span>Technology Analysis</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdanalysisresource_identification-li><a href=/infra/pr-preview/pr-626/rd/analysis/resource_identification/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisresource_identification><span>Resource Identifiers Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisresource_identificationuuid-li><a href=/infra/pr-preview/pr-626/rd/analysis/resource_identification/uuid/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisresource_identificationuuid><span>UUID Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisresource_identificationulid-li><a href=/infra/pr-preview/pr-626/rd/analysis/resource_identification/ulid/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisresource_identificationulid><span>ULID Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisresource_identificationsnowflake-li><a href=/infra/pr-preview/pr-626/rd/analysis/resource_identification/snowflake/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisresource_identificationsnowflake><span>Snowflake ID Analysis</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdanalysisserver-os-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisserver-os><span>Server Operating System Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisserver-osubuntu-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/ubuntu/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisserver-osubuntu><span>Ubuntu Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisserver-osfedora-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/fedora/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisserver-osfedora><span>Fedora Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisserver-ostalos-linux-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/talos-linux/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisserver-ostalos-linux><span>Talos Linux Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisserver-osharvester-li><a href=/infra/pr-preview/pr-626/rd/analysis/server-os/harvester/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisserver-osharvester><span>Harvester Analysis</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdanalysisaws-li><a href=/infra/pr-preview/pr-626/rd/analysis/aws/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisaws><span>Amazon Web Services Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisawsnetwork-boot-li><a href=/infra/pr-preview/pr-626/rd/analysis/aws/network-boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisawsnetwork-boot><span>AWS Network Boot Protocol Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisawswireguard-li><a href=/infra/pr-preview/pr-626/rd/analysis/aws/wireguard/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisawswireguard><span>AWS WireGuard VPN Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-infrapr-previewpr-626rdanalysisgoogle-cloud-li><a href=/infra/pr-preview/pr-626/rd/analysis/google-cloud/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisgoogle-cloud><span>Google Cloud Platform Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudgcsfuse-li><a href=/infra/pr-preview/pr-626/rd/analysis/google-cloud/gcsfuse/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudgcsfuse><span class=td-sidebar-nav-active-item>Cloud Storage FUSE (gcsfuse)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudnetwork-boot-li><a href=/infra/pr-preview/pr-626/rd/analysis/google-cloud/network-boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudnetwork-boot><span>GCP Network Boot Protocol Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudwireguard-li><a href=/infra/pr-preview/pr-626/rd/analysis/google-cloud/wireguard/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisgoogle-cloudwireguard><span>GCP WireGuard VPN Support</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9-li><a href=/infra/pr-preview/pr-626/rd/analysis/hp_dl360_gen9/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9><span>HP ProLiant DL360 Gen9 Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9configuration-li><a href=/infra/pr-preview/pr-626/rd/analysis/hp_dl360_gen9/configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9configuration><span>Configuration Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9specifications-li><a href=/infra/pr-preview/pr-626/rd/analysis/hp_dl360_gen9/specifications/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9specifications><span>Hardware Specifications</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9network-boot-li><a href=/infra/pr-preview/pr-626/rd/analysis/hp_dl360_gen9/network-boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysishp_dl360_gen9network-boot><span>Network Boot Capabilities</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdanalysismatchbox-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysismatchbox><span>Matchbox Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysismatchboxconfiguration-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysismatchboxconfiguration><span>Configuration Model</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysismatchboxdeployment-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/deployment/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysismatchboxdeployment><span>Deployment Patterns</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysismatchboxnetwork-boot-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/network-boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysismatchboxnetwork-boot><span>Network Boot Support</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysismatchboxevaluation-li><a href=/infra/pr-preview/pr-626/rd/analysis/matchbox/evaluation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysismatchboxevaluation><span>Use Case Evaluation</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdanalysisudm_pro-li><a href=/infra/pr-preview/pr-626/rd/analysis/udm_pro/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdanalysisudm_pro><span>Ubiquiti Dream Machine Pro Analysis</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdanalysisudm_provlans-li><a href=/infra/pr-preview/pr-626/rd/analysis/udm_pro/vlans/ title="UDM Pro VLAN Configuration & Capabilities" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdanalysisudm_provlans><span>VLANs</span></a></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdadrs-li><a href=/infra/pr-preview/pr-626/rd/adrs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdadrs><span>Architecture Decision Records</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdadrs0001-use-madr-for-architecture-decision-records-li><a href=/infra/pr-preview/pr-626/rd/adrs/0001-use-madr-for-architecture-decision-records/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0001-use-madr-for-architecture-decision-records><span>[0001] Use MADR for Architecture Decision Records</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdadrs0002-network-boot-architecture-li><a href=/infra/pr-preview/pr-626/rd/adrs/0002-network-boot-architecture/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0002-network-boot-architecture><span>[0002] Network Boot Architecture for Home Lab</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdadrs0003-cloud-provider-selection-li><a href=/infra/pr-preview/pr-626/rd/adrs/0003-cloud-provider-selection/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0003-cloud-provider-selection><span>[0003] Cloud Provider Selection for Network Boot Infrastructure</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdadrs0004-server-operating-system-li><a href=/infra/pr-preview/pr-626/rd/adrs/0004-server-operating-system/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0004-server-operating-system><span>[0004] Server Operating System Selection</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdadrs0005-network-boot-infrastructure-gcp-li><a href=/infra/pr-preview/pr-626/rd/adrs/0005-network-boot-infrastructure-gcp/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdadrs0005-network-boot-infrastructure-gcp><span>[0005] Network Boot Infrastructure Implementation on Google Cloud</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-infrapr-previewpr-626rdservices-li><a href=/infra/pr-preview/pr-626/rd/services/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdservices><span>Services</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-infrapr-previewpr-626rdservicesboot-li><a href=/infra/pr-preview/pr-626/rd/services/boot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-infrapr-previewpr-626rdservicesboot><span>Boot Server</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesbootuefi-boot-endpoints-li><a href=/infra/pr-preview/pr-626/rd/services/boot/uefi-boot-endpoints/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesbootuefi-boot-endpoints><span>UEFI HTTP Boot Endpoints</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesbootadmin-api-li><a href=/infra/pr-preview/pr-626/rd/services/boot/admin-api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesbootadmin-api><span>HTTP REST Admin API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-infrapr-previewpr-626rdservicesboothealth-checks-li><a href=/infra/pr-preview/pr-626/rd/services/boot/health-checks/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-infrapr-previewpr-626rdservicesboothealth-checks><span>Health Check Endpoints</span></a></li></ul></li></ul></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/Zaba505/infra/tree/main/content/r&amp;d/analysis/google-cloud/gcsfuse.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/Zaba505/infra/edit/main/content/r&amp;d/analysis/google-cloud/gcsfuse.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/Zaba505/infra/new/main/content/r&amp;d/analysis/google-cloud?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/Zaba505/infra/issues/new?title=Cloud%20Storage%20FUSE%20%28gcsfuse%29" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/Zaba505/infra/issues/new class="td-page-meta--project td-page-meta__project-issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create project issue</a>
<a id=print href=/infra/pr-preview/pr-626/_print/rd/analysis/google-cloud/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#how-gcsfuse-works>How gcsfuse Works</a></li><li><a href=#relevance-to-network-boot-infrastructure>Relevance to Network Boot Infrastructure</a><ul><li><a href=#potential-use-cases>Potential Use Cases</a></li><li><a href=#architecture-pattern>Architecture Pattern</a></li></ul></li><li><a href=#performance-characteristics>Performance Characteristics</a><ul><li><a href=#latency>Latency</a></li><li><a href=#throughput>Throughput</a></li><li><a href=#performance-improvements-recent-features>Performance Improvements (Recent Features)</a></li></ul></li><li><a href=#caching-configuration>Caching Configuration</a><ul><li><a href=#1-stat-cache>1. Stat Cache</a></li><li><a href=#2-type-cache>2. Type Cache</a></li><li><a href=#3-list-cache>3. List Cache</a></li><li><a href=#4-file-cache>4. File Cache</a></li><li><a href=#production-configuration-example>Production Configuration Example</a></li></ul></li><li><a href=#limitations-and-considerations>Limitations and Considerations</a><ul><li><a href=#filesystem-semantics>Filesystem Semantics</a></li><li><a href=#performance-anti-patterns>Performance Anti-Patterns</a></li><li><a href=#consistency-trade-offs>Consistency Trade-offs</a></li><li><a href=#resource-requirements>Resource Requirements</a></li></ul></li><li><a href=#installation>Installation</a><ul><li><a href=#on-compute-engine-container-optimized-os>On Compute Engine (Container-Optimized OS)</a></li><li><a href=#on-debianubuntu>On Debian/Ubuntu</a></li><li><a href=#in-dockercloud-run>In Docker/Cloud Run</a></li></ul></li><li><a href=#network-boot-infrastructure-evaluation>Network Boot Infrastructure Evaluation</a><ul><li><a href=#applicability-to-adr-0005>Applicability to ADR-0005</a></li><li><a href=#when-gcsfuse-might-be-useful>When gcsfuse MIGHT Be Useful</a></li></ul></li><li><a href=#monitoring-and-troubleshooting>Monitoring and Troubleshooting</a><ul><li><a href=#metrics>Metrics</a></li><li><a href=#logging>Logging</a></li><li><a href=#common-issues>Common Issues</a></li></ul></li><li><a href=#comparison-to-alternatives>Comparison to Alternatives</a><ul><li><a href=#gcsfuse-vs-direct-cloud-storage-sdk>gcsfuse vs Direct Cloud Storage SDK</a></li><li><a href=#gcsfuse-vs-rsyncgsutil-sync>gcsfuse vs rsync/gsutil Sync</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#references>References</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/infra/pr-preview/pr-626/rd/>Research and Development</a></li><li class=breadcrumb-item><a href=/infra/pr-preview/pr-626/rd/analysis/>Technology Analysis</a></li><li class=breadcrumb-item><a href=/infra/pr-preview/pr-626/rd/analysis/google-cloud/>Google Cloud Platform Analysis</a></li><li class="breadcrumb-item active" aria-current=page>Cloud Storage FUSE (gcsfuse)</li></ol></nav><div class=td-content><h1>Cloud Storage FUSE (gcsfuse)</h1><div class=lead>Analysis of Google Cloud Storage FUSE for mounting GCS buckets as local filesystems in network boot infrastructure</div><header class=article-meta></header><h2 id=overview>Overview</h2><p>Cloud Storage FUSE (gcsfuse) is a FUSE-based filesystem adapter that allows Google Cloud Storage (GCS) buckets to be mounted and accessed as local filesystems on Linux systems. This enables applications to interact with object storage using standard filesystem operations (open, read, write, etc.) rather than requiring GCS-specific APIs.</p><p><strong>Project</strong>: <a href=https://github.com/GoogleCloudPlatform/gcsfuse>GoogleCloudPlatform/gcsfuse</a>
<strong>License</strong>: Apache 2.0
<strong>Status</strong>: Generally Available (GA)
<strong>Latest Version</strong>: v2.x (as of 2024)</p><h2 id=how-gcsfuse-works>How gcsfuse Works</h2><p>gcsfuse translates filesystem operations into GCS API calls:</p><ol><li><strong>Mount Operation</strong>: <code>gcsfuse bucket-name /mount/point</code> maps a GCS bucket to a local directory</li><li><strong>Directory Structure</strong>: Interprets <code>/</code> in object names as directory separators</li><li><strong>File Operations</strong>: Translates <code>read()</code>, <code>write()</code>, <code>open()</code>, etc. into GCS API requests</li><li><strong>Metadata</strong>: Maintains file attributes (size, modification time) via GCS metadata</li><li><strong>Caching</strong>: Optional stat, type, list, and file caching to reduce API calls</li></ol><p><strong>Example</strong>:</p><ul><li>GCS object: <code>gs://boot-assets/kernels/talos-v1.6.0.img</code></li><li>Mounted path: <code>/mnt/boot-assets/kernels/talos-v1.6.0.img</code></li></ul><h2 id=relevance-to-network-boot-infrastructure>Relevance to Network Boot Infrastructure</h2><p>In the context of <a href=../../adrs/0005-network-boot-infrastructure-gcp.md>ADR-0005 Network Boot Infrastructure</a>, gcsfuse offers a potential approach for serving boot assets from Cloud Storage without custom integration code.</p><h3 id=potential-use-cases>Potential Use Cases</h3><ol><li><strong>Boot Asset Storage</strong>: Mount <code>gs://boot-assets/</code> to <code>/var/lib/boot-server/assets/</code></li><li><strong>Configuration Sync</strong>: Access boot profiles and machine mappings from GCS as local files</li><li><strong>Matchbox Integration</strong>: Mount GCS bucket to <code>/var/lib/matchbox/</code> for assets/profiles/groups</li><li><strong>Simplified Development</strong>: Eliminate custom Cloud Storage SDK integration in boot server code</li></ol><h3 id=architecture-pattern>Architecture Pattern</h3><pre tabindex=0><code>┌─────────────────────────┐
│   Boot Server Process   │
│  (Cloud Run/Compute)    │
└───────────┬─────────────┘
            │ filesystem operations
            │ (read, open, stat)
            ▼
┌─────────────────────────┐
│   gcsfuse mount point   │
│   /var/lib/boot-assets  │
└───────────┬─────────────┘
            │ FUSE layer
            │ (translates to GCS API)
            ▼
┌─────────────────────────┐
│  Cloud Storage Bucket   │
│   gs://boot-assets/     │
└─────────────────────────┘
</code></pre><h2 id=performance-characteristics>Performance Characteristics</h2><h3 id=latency>Latency</h3><ul><li><strong>Much higher latency than local filesystem</strong>: Every operation requires GCS API call(s)</li><li><strong>No default caching</strong>: Without caching enabled, every read re-fetches from GCS</li><li><strong>Network round-trip</strong>: Minimum ~10-50ms latency per operation (depending on region)</li></ul><h3 id=throughput>Throughput</h3><p><strong>Single Large File</strong>:</p><ul><li>Read: ~4.1 MiB/s (individual file), up to 63.3 MiB/s (archive files)</li><li>Write: Comparable to <code>gsutil cp</code> for large files</li><li><strong>With parallel downloads</strong>: Up to 9x faster for single-threaded reads of large files</li></ul><p><strong>Small Files</strong>:</p><ul><li>Poor performance for random I/O on small files</li><li>Bulk operations on many small files create significant bottlenecks</li><li><code>ls</code> on directories with thousands of objects can take minutes</li></ul><p><strong>Concurrent Access</strong>:</p><ul><li>Performance degrades significantly with parallel readers (8 instances: ~30 hours vs 16 minutes with local data)</li><li>Not recommended for high-concurrency scenarios (web servers, NAS)</li></ul><h3 id=performance-improvements-recent-features>Performance Improvements (Recent Features)</h3><ol><li><p><strong>Streaming Writes</strong> (default): Upload data directly to GCS as written</p><ul><li>Up to 40% faster for large sequential writes</li><li>Reduces local disk usage (no staging file)</li></ul></li><li><p><strong>Parallel Downloads</strong>: Download large files using multiple workers</p><ul><li>Up to 9x faster model load times</li><li>Best for single-threaded reads of large files</li></ul></li><li><p><strong>File Cache</strong>: Cache file contents locally (Local SSD, Persistent Disk, or tmpfs)</p><ul><li>Up to 2.3x faster training time (AI/ML workloads)</li><li>Up to 3.4x higher throughput</li><li>Requires explicit cache directory configuration</li></ul></li><li><p><strong>Metadata Cache</strong>: Cache stat, type, and list operations</p><ul><li>Stat and type caches enabled by default</li><li>Configurable TTL (default: 60s, set <code>-1</code> for unlimited)</li></ul></li></ol><h2 id=caching-configuration>Caching Configuration</h2><p>gcsfuse provides four types of caching:</p><h3 id=1-stat-cache>1. Stat Cache</h3><p>Caches file attributes (size, modification time, existence).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Enable with unlimited size and TTL</span>
</span></span><span style=display:flex><span>gcsfuse <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --stat-cache-max-size-mb<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --metadata-cache-ttl-secs<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  bucket-name /mount/point
</span></span></code></pre></div><p><strong>Use case</strong>: Reduces API calls for repeated <code>stat()</code> operations (e.g., checking file existence).</p><h3 id=2-type-cache>2. Type Cache</h3><p>Caches file vs directory type information.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcsfuse <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --type-cache-max-size-mb<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --metadata-cache-ttl-secs<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  bucket-name /mount/point
</span></span></code></pre></div><p><strong>Use case</strong>: Speeds up directory traversal and <code>ls</code> operations.</p><h3 id=3-list-cache>3. List Cache</h3><p>Caches directory listing results.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcsfuse <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --max-conns-per-host<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>100</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --metadata-cache-ttl-secs<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  bucket-name /mount/point
</span></span></code></pre></div><p><strong>Use case</strong>: Improves performance for applications that repeatedly list directory contents.</p><h3 id=4-file-cache>4. File Cache</h3><p>Caches actual file contents locally.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcsfuse <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --file-cache-max-size-mb<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --cache-dir<span style=color:#ce5c00;font-weight:700>=</span>/mnt/local-ssd <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --file-cache-cache-file-for-range-read<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --file-cache-enable-parallel-downloads<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  bucket-name /mount/point
</span></span></code></pre></div><p><strong>Use case</strong>: Essential for AI/ML training, repeated reads of large files.</p><p><strong>Recommended cache storage</strong>:</p><ul><li><strong>Local SSD</strong>: Fastest, but ephemeral (data lost on restart)</li><li><strong>Persistent Disk</strong>: Persistent but slower than Local SSD</li><li><strong>tmpfs</strong> (RAM disk): Fastest but limited by memory</li></ul><h3 id=production-configuration-example>Production Configuration Example</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># config.yaml for gcsfuse</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata-cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ttl-secs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Never expire (use only if bucket is read-only or single-writer)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stat-cache-max-size-mb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type-cache-max-size-mb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>file-cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>max-size-mb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Unlimited (limited by disk space)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>cache-file-for-range-read</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>enable-parallel-downloads</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>parallel-downloads-per-file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>download-chunk-size-mb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>write</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>create-empty-file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Streaming writes (default)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>logging</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>severity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>info</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>format</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>json</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcsfuse --config-file<span style=color:#ce5c00;font-weight:700>=</span>config.yaml boot-assets /mnt/boot-assets
</span></span></code></pre></div><h2 id=limitations-and-considerations>Limitations and Considerations</h2><h3 id=filesystem-semantics>Filesystem Semantics</h3><p>gcsfuse provides <strong>approximate POSIX semantics</strong> but is not fully POSIX-compliant:</p><ul><li><strong>No atomic rename</strong>: Rename operations are copy-then-delete (not atomic)</li><li><strong>No hard links</strong>: GCS doesn&rsquo;t support hard links</li><li><strong>No file locking</strong>: <code>flock()</code> is a no-op</li><li><strong>Limited permissions</strong>: GCS has simpler ACLs than POSIX permissions</li><li><strong>No sparse files</strong>: Writes always materialize full file content</li></ul><h3 id=performance-anti-patterns>Performance Anti-Patterns</h3><p>❌ <strong>Avoid</strong>:</p><ul><li>Serving web content or acting as NAS (concurrent connections)</li><li>Random I/O on many small files (image datasets, text corpora)</li><li>Reading during ML training loops (download first, then train)</li><li>High-concurrency workloads (multiple parallel readers/writers)</li></ul><p>✅ <strong>Good for</strong>:</p><ul><li>Sequential reads of large files (models, checkpoints, kernels)</li><li>Infrequent writes of entire files</li><li>Read-mostly workloads with caching enabled</li><li>Single-writer scenarios</li></ul><h3 id=consistency-trade-offs>Consistency Trade-offs</h3><p><strong>With caching enabled</strong>:</p><ul><li>Stale reads possible if cache TTL > 0 and external modifications occur</li><li>Safe only for:<ul><li>Read-only buckets</li><li>Single-writer, single-mount scenarios</li><li>Workloads tolerant of eventual consistency</li></ul></li></ul><p><strong>Without caching</strong>:</p><ul><li>Strong consistency (every read fetches latest from GCS)</li><li>Much slower performance</li></ul><h3 id=resource-requirements>Resource Requirements</h3><ul><li><strong>Disk space</strong>: File cache and streaming writes require local storage<ul><li>File cache: Size of cached files (can be large for ML datasets)</li><li>Streaming writes: Temporary staging (proportional to concurrent writes)</li></ul></li><li><strong>Memory</strong>: Metadata caches consume RAM</li><li><strong>File handles</strong>: Can exceed system limits with high concurrency</li><li><strong>Network bandwidth</strong>: All data transfers via GCS API</li></ul><h2 id=installation>Installation</h2><h3 id=on-compute-engine-container-optimized-os>On Compute Engine (Container-Optimized OS)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Install gcsfuse (Container-Optimized OS doesn&#39;t include package managers)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GCSFUSE_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>2.x.x
</span></span><span style=display:flex><span>curl -L -O https://github.com/GoogleCloudPlatform/gcsfuse/releases/download/v<span style=color:#4e9a06>${</span><span style=color:#000>GCSFUSE_VERSION</span><span style=color:#4e9a06>}</span>/gcsfuse_<span style=color:#4e9a06>${</span><span style=color:#000>GCSFUSE_VERSION</span><span style=color:#4e9a06>}</span>_amd64.deb
</span></span><span style=display:flex><span>sudo dpkg -i gcsfuse_<span style=color:#4e9a06>${</span><span style=color:#000>GCSFUSE_VERSION</span><span style=color:#4e9a06>}</span>_amd64.deb
</span></span></code></pre></div><h3 id=on-debianubuntu>On Debian/Ubuntu</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GCSFUSE_REPO</span><span style=color:#ce5c00;font-weight:700>=</span>gcsfuse-<span style=color:#4e9a06>`</span>lsb_release -c -s<span style=color:#4e9a06>`</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;deb https://packages.cloud.google.com/apt </span><span style=color:#000>$GCSFUSE_REPO</span><span style=color:#4e9a06> main&#34;</span> <span style=color:#000;font-weight:700>|</span> sudo tee /etc/apt/sources.list.d/gcsfuse.list
</span></span><span style=display:flex><span>curl https://packages.cloud.google.com/apt/doc/apt-key.gpg <span style=color:#000;font-weight:700>|</span> sudo apt-key add -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get install gcsfuse
</span></span></code></pre></div><h3 id=in-dockercloud-run>In Docker/Cloud Run</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>ubuntu:22.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic># Install gcsfuse</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> apt-get update <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> apt-get install -y <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    curl <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    gnupg <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    lsb-release <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>export</span> <span style=color:#000>GCSFUSE_REPO</span><span style=color:#ce5c00;font-weight:700>=</span>gcsfuse-<span style=color:#204a87;font-weight:700>$(</span>lsb_release -c -s<span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;deb https://packages.cloud.google.com/apt </span><span style=color:#000>$GCSFUSE_REPO</span><span style=color:#4e9a06> main&#34;</span> <span style=color:#000;font-weight:700>|</span> tee /etc/apt/sources.list.d/gcsfuse.list <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> curl https://packages.cloud.google.com/apt/doc/apt-key.gpg <span style=color:#000;font-weight:700>|</span> apt-key add - <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> apt-get update <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> apt-get install -y gcsfuse <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic># Create mount point</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> mkdir -p /mnt/boot-assets<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic># Mount gcsfuse at startup</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>CMD</span> gcsfuse --foreground boot-assets /mnt/boot-assets <span style=color:#000;font-weight:700>&amp;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    /usr/local/bin/boot-server<span style=color:#a40000>
</span></span></span></code></pre></div><p><strong>Note</strong>: Cloud Run <strong>does not support FUSE filesystems</strong> (requires privileged mode). gcsfuse only works on Compute Engine or GKE.</p><h2 id=network-boot-infrastructure-evaluation>Network Boot Infrastructure Evaluation</h2><h3 id=applicability-to-adr-0005>Applicability to ADR-0005</h3><p>Based on the analysis, gcsfuse is <strong>not recommended</strong> for the network boot infrastructure for the following reasons:</p><h4 id=-cloud-run-incompatibility>❌ Cloud Run Incompatibility</h4><ul><li>gcsfuse requires FUSE kernel module and privileged containers</li><li>Cloud Run does not support FUSE or privileged mode</li><li>ADR-0005 prefers Cloud Run deployment (HTTP-only boot enables serverless)</li><li><strong>Impact</strong>: Blocks Cloud Run deployment, forcing Compute Engine VM</li></ul><h4 id=-boot-latency-requirements>❌ Boot Latency Requirements</h4><ul><li>Boot file requests target &lt; 100ms latency (ADR-0005 confirmation criteria)</li><li>gcsfuse adds 10-50ms+ latency per operation (network round-trips)</li><li>Kernel/initrd downloads are latency-sensitive (network boot timeout)</li><li><strong>Impact</strong>: May exceed boot timeout thresholds</li></ul><h4 id=-no-caching-for-read-write-workloads>❌ No Caching for Read-Write Workloads</h4><ul><li>Boot server needs to write new assets and read existing ones</li><li>File cache with unlimited TTL requires read-only or single-writer assumption</li><li>Multiple boot server instances (autoscaling) violate single-writer constraint</li><li><strong>Impact</strong>: Either accept stale reads or disable caching (slow)</li></ul><h4 id=-small-file-performance>❌ Small File Performance</h4><ul><li>Machine mapping configs, boot scripts, profiles are small files (KB range)</li><li>gcsfuse performs poorly on small, random I/O</li><li><code>ls</code> operations on directories with many profiles can be slow</li><li><strong>Impact</strong>: Slow boot configuration lookups</li></ul><h4 id=-alternative-direct-cloud-storage-sdk>✅ Alternative: Direct Cloud Storage SDK</h4><p>Using <code>cloud.google.com/go/storage</code> SDK directly offers:</p><ul><li><strong>Lower latency</strong>: Direct API calls without FUSE overhead</li><li><strong>Cloud Run compatible</strong>: No kernel module or privileged mode required</li><li><strong>Better control</strong>: Explicit caching, parallel downloads, streaming</li><li><strong>Simpler deployment</strong>: No mount management, no FUSE dependencies</li><li><strong>Cost</strong>: Similar API call costs to gcsfuse</li></ul><p><strong>Recommended approach</strong> (from ADR-0005):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Custom boot server using Cloud Storage SDK</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>storage</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewClient</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>bucket</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>storage</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Bucket</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;boot-assets&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Stream kernel to boot client</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>obj</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>bucket</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Object</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;kernels/talos-v1.6.0.img&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>_</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>obj</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewReader</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>defer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>io</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Copy</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>// Stream to HTTP response</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=when-gcsfuse-might-be-useful>When gcsfuse MIGHT Be Useful</h3><p>Despite the above limitations, gcsfuse could be considered for:</p><ol><li><p><strong>Matchbox on Compute Engine</strong>:</p><ul><li>Matchbox expects filesystem paths for assets (<code>/var/lib/matchbox/assets/</code>)</li><li>Compute Engine VM supports FUSE</li><li>Read-heavy workload (boot assets rarely change)</li><li>Could mount <code>gs://boot-assets/</code> to <code>/var/lib/matchbox/assets/</code> with file cache</li></ul></li><li><p><strong>Development/Testing</strong>:</p><ul><li>Quick prototyping without writing Cloud Storage integration</li><li>Local development with production bucket access</li><li>Not recommended for production deployment</li></ul></li><li><p><strong>Low-Throughput Scenarios</strong>:</p><ul><li>Home lab scale (&lt; 10 boots/hour)</li><li>File cache enabled with Local SSD</li><li>Single Compute Engine VM (not autoscaled)</li></ul></li></ol><p><strong>Configuration for Matchbox + gcsfuse</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic># Mount boot assets for Matchbox</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>BUCKET</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;boot-assets&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>MOUNT_POINT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/var/lib/matchbox/assets&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>CACHE_DIR</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/mnt/disks/local-ssd/gcsfuse-cache&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p <span style=color:#4e9a06>&#34;</span><span style=color:#000>$MOUNT_POINT</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$CACHE_DIR</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcsfuse <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --stat-cache-max-size-mb<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --type-cache-max-size-mb<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --metadata-cache-ttl-secs<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --file-cache-max-size-mb<span style=color:#ce5c00;font-weight:700>=</span>-1 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --cache-dir<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$CACHE_DIR</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --file-cache-cache-file-for-range-read<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --file-cache-enable-parallel-downloads<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --implicit-dirs <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --foreground <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  <span style=color:#4e9a06>&#34;</span><span style=color:#000>$BUCKET</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$MOUNT_POINT</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><h2 id=monitoring-and-troubleshooting>Monitoring and Troubleshooting</h2><h3 id=metrics>Metrics</h3><p>gcsfuse exposes Prometheus metrics:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcsfuse --prometheus --prometheus-port<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>9101</span> bucket /mnt/point
</span></span></code></pre></div><p><strong>Key metrics</strong>:</p><ul><li><code>gcs_read_count</code>: Number of GCS read operations</li><li><code>gcs_write_count</code>: Number of GCS write operations</li><li><code>gcs_read_bytes</code>: Bytes read from GCS</li><li><code>gcs_write_bytes</code>: Bytes written to GCS</li><li><code>fs_ops_count</code>: Filesystem operations by type (open, read, write, etc.)</li><li><code>fs_ops_error_count</code>: Filesystem operation errors</li></ul><h3 id=logging>Logging</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># JSON logging for Cloud Logging integration</span>
</span></span><span style=display:flex><span>gcsfuse --log-format<span style=color:#ce5c00;font-weight:700>=</span>json --log-file<span style=color:#ce5c00;font-weight:700>=</span>/var/log/gcsfuse.log bucket /mnt/point
</span></span></code></pre></div><h3 id=common-issues>Common Issues</h3><p><strong>Issue</strong>: <code>ls</code> on large directories takes minutes</p><p><strong>Solution</strong>:</p><ul><li>Enable list caching with <code>--metadata-cache-ttl-secs=-1</code></li><li>Reduce directory depth (flatten object hierarchy)</li><li>Consider prefix-based filtering instead of full listings</li></ul><p><strong>Issue</strong>: Stale reads after external bucket modifications</p><p><strong>Solution</strong>:</p><ul><li>Reduce <code>--metadata-cache-ttl-secs</code> (default 60s)</li><li>Disable caching entirely for strong consistency</li><li>Use versioned object names (immutable assets)</li></ul><p><strong>Issue</strong>: <code>Transport endpoint is not connected</code> errors</p><p><strong>Solution</strong>:</p><ul><li>Unmount cleanly before remounting: <code>fusermount -u /mnt/point</code></li><li>Check GCS bucket permissions (IAM roles)</li><li>Verify network connectivity to <code>storage.googleapis.com</code></li></ul><p><strong>Issue</strong>: High memory usage</p><p><strong>Solution</strong>:</p><ul><li>Limit metadata cache sizes: <code>--stat-cache-max-size-mb=1024</code></li><li>Disable file cache if not needed</li><li>Monitor with <code>--prometheus</code> metrics</li></ul><h2 id=comparison-to-alternatives>Comparison to Alternatives</h2><h3 id=gcsfuse-vs-direct-cloud-storage-sdk>gcsfuse vs Direct Cloud Storage SDK</h3><table><thead><tr><th>Aspect</th><th>gcsfuse</th><th>Cloud Storage SDK</th></tr></thead><tbody><tr><td><strong>Latency</strong></td><td>Higher (FUSE overhead + GCS API)</td><td>Lower (direct GCS API)</td></tr><tr><td><strong>Cloud Run</strong></td><td>❌ Not supported</td><td>✅ Fully supported</td></tr><tr><td><strong>Development Effort</strong></td><td>Low (standard filesystem code)</td><td>Medium (SDK integration)</td></tr><tr><td><strong>Performance</strong></td><td>Slower (filesystem abstraction)</td><td>Faster (optimized for use case)</td></tr><tr><td><strong>Caching</strong></td><td>Built-in (stat, type, list, file)</td><td>Manual (application-level)</td></tr><tr><td><strong>Streaming</strong></td><td>Automatic</td><td>Explicit (<code>io.Copy</code>)</td></tr><tr><td><strong>Dependencies</strong></td><td>FUSE kernel module, privileged mode</td><td>None (pure Go library)</td></tr></tbody></table><p><strong>Recommendation</strong>: Use Cloud Storage SDK directly for production network boot infrastructure.</p><h3 id=gcsfuse-vs-rsyncgsutil-sync>gcsfuse vs rsync/gsutil Sync</h3><p><strong>Periodic sync pattern</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Sync bucket to local disk every 5 minutes</span>
</span></span><span style=display:flex><span>*/5 * * * * gsutil -m rsync -r gs://boot-assets /var/lib/boot-assets
</span></span></code></pre></div><table><thead><tr><th>Aspect</th><th>gcsfuse</th><th>rsync/gsutil sync</th></tr></thead><tbody><tr><td><strong>Consistency</strong></td><td>Eventual (with caching)</td><td>Strong (within sync interval)</td></tr><tr><td><strong>Disk Usage</strong></td><td>Minimal (file cache optional)</td><td>Full copy of assets</td></tr><tr><td><strong>Latency</strong></td><td>GCS API per request</td><td>Local disk (fast)</td></tr><tr><td><strong>Sync Lag</strong></td><td>Real-time (no caching) or TTL</td><td>Sync interval (minutes)</td></tr><tr><td><strong>Deployment</strong></td><td>Requires FUSE</td><td>Simple cron job</td></tr></tbody></table><p><strong>Recommendation</strong>: For read-heavy, infrequent-write workloads on Compute Engine, rsync/gsutil sync is simpler and faster than gcsfuse.</p><h2 id=conclusion>Conclusion</h2><p>Cloud Storage FUSE (gcsfuse) provides a convenient filesystem abstraction over GCS buckets, but <strong>is not recommended for the network boot infrastructure</strong> due to:</p><ol><li>Cloud Run incompatibility (requires FUSE kernel module)</li><li>Added latency (FUSE overhead + network round-trips)</li><li>Poor performance for small files and concurrent access</li><li>Caching trade-offs (consistency vs performance)</li></ol><p><strong>Recommended alternatives</strong>:</p><ul><li><strong>Custom Boot Server</strong>: Direct Cloud Storage SDK integration (<code>cloud.google.com/go/storage</code>)</li><li><strong>Matchbox on Compute Engine</strong>: rsync/gsutil sync to local disk</li><li><strong>Cloud Run Deployment</strong>: Direct SDK (no gcsfuse possible)</li></ul><p>gcsfuse may be useful for <strong>development/testing</strong> or <strong>Matchbox prototyping</strong> on Compute Engine, but production deployments should use direct SDK integration or periodic sync for optimal performance and Cloud Run compatibility.</p><h2 id=references>References</h2><ul><li><a href=https://cloud.google.com/storage/docs/cloud-storage-fuse/overview>Cloud Storage FUSE Documentation</a></li><li><a href=https://github.com/GoogleCloudPlatform/gcsfuse>gcsfuse GitHub Repository</a></li><li><a href=https://cloud.google.com/storage/docs/gcsfuse-performance-and-best-practices>Performance Tuning Best Practices</a></li><li><a href=https://github.com/GoogleCloudPlatform/gcsfuse/blob/master/docs/semantics.md>gcsfuse Semantics</a></li><li><a href=../../adrs/0005-network-boot-infrastructure-gcp.md>ADR-0005: Network Boot Infrastructure Implementation on Google Cloud</a></li></ul><div class=td-page-meta__lastmod>Last modified November 23, 2025: <a data-proofer-ignore href=https://github.com/Zaba505/infra/commit/580d8ab031709632574bc0be316bd98126ded811>Merge 79aa822950bdfb3576a2647718ab87391fd29a21 into 0365091529941d020b104dd5b7694d85078e5b00 (580d8ab)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/Zaba505/infra aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024&ndash;2025
<span class=td-footer__authors>Zaba505 | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/infra/pr-preview/pr-626/js/main.min.eb40505784d893e4b5c8dbd67b59c353e735d847f4ffbfe9d6921dec08dbacba.js integrity="sha256-60BQV4TYk+S1yNvWe1nDU+c12Ef0/7/p1pId7AjbrLo=" crossorigin=anonymous></script><script defer src=/infra/pr-preview/pr-626/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/infra/pr-preview/pr-626/js/tabpane-persist.js></script></body></html>