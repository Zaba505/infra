<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://zaba505.github.io/infra/pr-preview/pr-626/rd/services/machine-mgmt/><link rel=alternate type=application/rss+xml href=https://zaba505.github.io/infra/pr-preview/pr-626/rd/services/machine-mgmt/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/infra/pr-preview/pr-626/favicons/favicon.ico><link rel=apple-touch-icon href=/infra/pr-preview/pr-626/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/infra/pr-preview/pr-626/favicons/android-192x192.png sizes=192x192><title>Machine Management Service | Zaba505's Home Lab</title><meta name=description content="Service for managing machine profiles and boot profiles"><meta property="og:url" content="https://zaba505.github.io/infra/pr-preview/pr-626/rd/services/machine-mgmt/"><meta property="og:site_name" content="Zaba505's Home Lab"><meta property="og:title" content="Machine Management Service"><meta property="og:description" content="Service for managing machine profiles and boot profiles"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Machine Management Service"><meta itemprop=description content="Service for managing machine profiles and boot profiles"><meta itemprop=dateModified content="2025-11-23T22:06:38+00:00"><meta itemprop=wordCount content="199"><meta name=twitter:card content="summary"><meta name=twitter:title content="Machine Management Service"><meta name=twitter:description content="Service for managing machine profiles and boot profiles"><link rel=preload href=/infra/pr-preview/pr-626/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css as=style integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><link href=/infra/pr-preview/pr-626/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css rel=stylesheet integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/infra/pr-preview/pr-626/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Zaba505's Home Lab</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/infra/pr-preview/pr-626/offline-search-index.70ea39cfa8cd4a96a15607a9c00979b2.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/infra/pr-preview/pr-626/rd/services/machine-mgmt/>Return to the regular view of this page</a>.</p></div><h1 class=title>Machine Management Service</h1><div class=lead>Service for managing machine profiles and boot profiles</div><ul><li>1: <a href=#pg-93285c8bb6914d4b63030f6cbb2a0021>Machine Management Service API</a></li></ul><div class=content><p>The Machine Management Service is a REST API that manages machine hardware profiles and boot profiles for the network boot infrastructure. It stores machine hardware specifications and boot profiles in Firestore, manages kernel and initrd blobs in Cloud Storage, and serves both the Boot Service (during boot operations) and administrators (for configuration management).</p><h2 id=architecture>Architecture</h2><p>The service is responsible for:</p><ul><li><strong>Machine Profile Management</strong>: Creating, listing, retrieving, updating, and deleting machine hardware profiles</li><li><strong>Boot Profile Management</strong>: Creating, listing, retrieving, updating, and deleting boot profiles</li><li><strong>Blob Storage</strong>: Uploading and streaming kernel/initrd binaries to/from Cloud Storage</li><li><strong>Machine-to-Boot Profile Mapping</strong>: Associating machines with boot profiles via machine ID</li></ul><h2 id=components>Components</h2><ul><li><strong>Firestore</strong>: Stores machine hardware profiles and boot profile metadata</li><li><strong>Cloud Storage</strong>: Stores kernel and initrd blobs using UUIDv7 identifiers</li><li><strong>REST API</strong>: HTTP endpoints for machine and boot profile management</li></ul><h2 id=clients>Clients</h2><p>The service is consumed by:</p><ol><li><strong>Boot Service</strong>: Retrieves machine profiles and boot profiles during boot operations</li><li><strong>Admin Tools</strong>: CLI or web interfaces for managing machines and profiles</li><li><strong>CI/CD Pipelines</strong>: Automated profile deployment workflows</li></ol><h2 id=deployment>Deployment</h2><ul><li><strong>Platform</strong>: GCP Cloud Run</li><li><strong>Scaling</strong>: Automatic scaling based on request load</li><li><strong>Availability</strong>: Min instances = 1 for low-latency responses</li><li><strong>Region</strong>: Same region as Boot Service and Cloud Storage for minimal latency</li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-93285c8bb6914d4b63030f6cbb2a0021>1 - Machine Management Service API</h1><div class=lead>REST API endpoints for machine profiles and boot profiles</div><p>The Machine Management Service provides HTTP REST endpoints for managing machine hardware profiles and boot profiles. This service is called by the Boot Service during boot operations and by administrators for configuration management. Since this is for a home lab environment, no authentication is required.</p><h2 id=boot-profile-management>Boot Profile Management</h2><p>Boot profiles bundle kernel, initrd, and kernel arguments together. Each profile is associated with a specific machine and its version. Profiles can be updated, creating new versions while maintaining the association with the machine.</p><h2 id=cloud-storage-structure>Cloud Storage Structure</h2><p>Kernel and initrd binaries are stored in Google Cloud Storage using their UUIDv7 identifiers as object keys:</p><pre tabindex=0><code>gs://{bucket}/blobs/{kernel_id}
gs://{bucket}/blobs/{initrd_id}
</code></pre><p>For example:</p><pre tabindex=0><code>gs://boot-server-blobs/blobs/018c7dbd-b100-7000-8000-123456789abc
gs://boot-server-blobs/blobs/018c7dbd-b200-7000-8000-987654321fed
</code></pre><p>The UUIDv7 identifiers are generated server-side during upload, ensuring:</p><ul><li>Globally unique object keys</li><li>Time-ordered storage (UUIDv7 timestamp prefix)</li><li>No namespace collisions between profiles</li></ul><h3 id=post-apiv1profiles><code>POST /api/v1/profiles</code></h3><p>Create a new boot profile by uploading kernel, initrd, and configuration. The profile is associated with a specific machine ID and version.</p><h4 id=sequence-diagram>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant MachineDB as Machine Service
    participant Storage as Cloud Storage
    participant DB as Firestore
    
    Client-&gt;&gt;API: POST /api/v1/profiles (multipart/form-data)
    API-&gt;&gt;MachineDB: Fetch machine profile by id
    MachineDB--&gt;&gt;API: Machine profile
    API-&gt;&gt;API: Generate UUIDv7 for profile
    API-&gt;&gt;API: Generate UUIDv7 for kernel blob
    API-&gt;&gt;API: Generate UUIDv7 for initrd blob
    API-&gt;&gt;Storage: PUT gs://bucket/blobs/{kernel_id}
    Storage--&gt;&gt;API: Kernel stored
    API-&gt;&gt;Storage: PUT gs://bucket/blobs/{initrd_id}
    Storage--&gt;&gt;API: Initrd stored
    API-&gt;&gt;DB: Store profile metadata (profile_id, kernel_id, initrd_id)
    DB--&gt;&gt;API: Profile created
    API--&gt;&gt;Client: 201 Created (profile metadata with IDs)</pre><p><strong>Request Body (multipart/form-data):</strong></p><p>Form fields:</p><ul><li><code>machine_id</code> (text): Machine identifier (UUIDv7)</li><li><code>kernel</code> (file): Kernel image file</li><li><code>initrd</code> (file): Initrd image file</li><li><code>kernel_args</code> (JSON array): Kernel command-line arguments</li></ul><p><strong>Example Request:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/api/v1/profiles</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>boot.example.com</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>------WebKitFormBoundary7MA4YWxkTrZu0gW
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;machine_id&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>018c7dbd-c000-7000-8000-fedcba987654
</span></span><span class=line><span class=cl>------WebKitFormBoundary7MA4YWxkTrZu0gW
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;kernel&#34;; filename=&#34;vmlinuz&#34;
</span></span><span class=line><span class=cl>Content-Type: application/octet-stream
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;kernel binary data&gt;
</span></span><span class=line><span class=cl>------WebKitFormBoundary7MA4YWxkTrZu0gW
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;initrd&#34;; filename=&#34;initrd.img&#34;
</span></span><span class=line><span class=cl>Content-Type: application/octet-stream
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;initrd binary data&gt;
</span></span><span class=line><span class=cl>------WebKitFormBoundary7MA4YWxkTrZu0gW
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;kernel_args&#34;
</span></span><span class=line><span class=cl>Content-Type: application/json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[&#34;console=tty0&#34;, &#34;console=ttyS0&#34;, &#34;ip=dhcp&#34;]
</span></span><span class=line><span class=cl>------WebKitFormBoundary7MA4YWxkTrZu0gW--
</span></span></code></pre></div><p><strong>Request Headers:</strong></p><ul><li><code>Content-Type: multipart/form-data</code></li></ul><p><strong>Response (201 Created):</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-a000-7000-8000-abcdef123456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;kernel&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-b100-7000-8000-123456789abc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;args&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;console=tty0&#34;</span><span class=p>,</span> <span class=s2>&#34;console=ttyS0&#34;</span><span class=p>,</span> <span class=s2>&#34;ip=dhcp&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;initrd&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-b200-7000-8000-987654321fed&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>400 Bad Request</td><td>Invalid request body or missing required fields</td></tr><tr><td>422 Unprocessable Entity</td><td>Validation error (file too large, invalid JSON, machine_id not found)</td></tr></tbody></table><hr><h3 id=get-apiv1profiles><code>GET /api/v1/profiles</code></h3><p>List all boot profiles.</p><h4 id=sequence-diagram-1>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant DB as Firestore
    
    Client-&gt;&gt;API: GET /api/v1/profiles?machine_id=...
    API-&gt;&gt;DB: Query profiles with filters
    DB--&gt;&gt;API: Profile list
    API--&gt;&gt;Client: 200 OK (profiles list)</pre><p><strong>Query Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>page</code></td><td>integer</td><td>No</td><td>Page number (1-indexed)</td><td>1</td></tr><tr><td><code>per_page</code></td><td>integer</td><td>No</td><td>Results per page (1-100)</td><td>20</td></tr><tr><td><code>machine_id</code></td><td>string</td><td>No</td><td>Filter by machine ID (UUIDv7)</td><td>-</td></tr></tbody></table><p><strong>Response (200 OK):</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;profiles&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-a000-7000-8000-abcdef123456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;kernel&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-b100-7000-8000-123456789abc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;args&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;console=tty0&#34;</span><span class=p>,</span> <span class=s2>&#34;console=ttyS0&#34;</span><span class=p>,</span> <span class=s2>&#34;ip=dhcp&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;initrd&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-b200-7000-8000-987654321fed&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pagination&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;total&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;page&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;per_page&#34;</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;total_pages&#34;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h3 id=get-apiv1profilesid><code>GET /api/v1/profiles/{id}</code></h3><p>Retrieve metadata for a specific boot profile by ID.</p><h4 id=sequence-diagram-2>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant DB as Firestore
    
    Client-&gt;&gt;API: GET /api/v1/profiles/{id}
    API-&gt;&gt;DB: Query profile by ID
    DB--&gt;&gt;API: Profile metadata
    API--&gt;&gt;Client: 200 OK (profile metadata)</pre><p><strong>Path Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>Yes</td><td>Boot profile identifier (UUIDv7 format)</td></tr></tbody></table><p><strong>Response (200 OK):</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-a000-7000-8000-abcdef123456&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;kernel&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-b100-7000-8000-123456789abc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;args&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;console=tty0&#34;</span><span class=p>,</span> <span class=s2>&#34;console=ttyS0&#34;</span><span class=p>,</span> <span class=s2>&#34;ip=dhcp&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;initrd&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-b200-7000-8000-987654321fed&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>404 Not Found</td><td>Profile with specified ID not found</td></tr></tbody></table><hr><h3 id=get-apiv1profilesidkernel><code>GET /api/v1/profiles/{id}/kernel</code></h3><p>Download the kernel binary for a specific profile.</p><h4 id=sequence-diagram-3>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant Storage as Cloud Storage
    participant DB as Firestore
    
    Client-&gt;&gt;API: GET /api/v1/profiles/{id}/kernel
    API-&gt;&gt;DB: Query profile by ID
    DB--&gt;&gt;API: Profile metadata (kernel_id)
    API-&gt;&gt;Storage: GET gs://bucket/blobs/{kernel_id}
    Storage--&gt;&gt;API: Kernel binary
    API--&gt;&gt;Client: 200 OK (application/octet-stream)</pre><p><strong>Path Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>Yes</td><td>Boot profile identifier (UUIDv7 format)</td></tr></tbody></table><p><strong>Response (200 OK):</strong></p><ul><li><strong>Content-Type</strong>: <code>application/octet-stream</code></li><li><strong>Body</strong>: Binary kernel data</li></ul><p><strong>Response Headers:</strong></p><pre tabindex=0><code>Content-Type: application/octet-stream
Content-Disposition: attachment; filename=&#34;vmlinuz&#34;
</code></pre><p><strong>Storage Path:</strong></p><p>The kernel is fetched from <code>gs://{bucket}/blobs/{kernel_id}</code> where <code>kernel_id</code> is the UUIDv7 identifier from the profile.</p><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>404 Not Found</td><td>Profile with specified ID not found</td></tr></tbody></table><hr><h3 id=get-apiv1profilesidinitrd><code>GET /api/v1/profiles/{id}/initrd</code></h3><p>Download the initrd binary for a specific profile.</p><h4 id=sequence-diagram-4>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant Storage as Cloud Storage
    participant DB as Firestore
    
    Client-&gt;&gt;API: GET /api/v1/profiles/{id}/initrd
    API-&gt;&gt;DB: Query profile by ID
    DB--&gt;&gt;API: Profile metadata (initrd_id)
    API-&gt;&gt;Storage: GET gs://bucket/blobs/{initrd_id}
    Storage--&gt;&gt;API: Initrd binary
    API--&gt;&gt;Client: 200 OK (application/octet-stream)</pre><p><strong>Path Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>Yes</td><td>Boot profile identifier (UUIDv7 format)</td></tr></tbody></table><p><strong>Response (200 OK):</strong></p><ul><li><strong>Content-Type</strong>: <code>application/octet-stream</code></li><li><strong>Body</strong>: Binary initrd data</li></ul><p><strong>Response Headers:</strong></p><pre tabindex=0><code>Content-Type: application/octet-stream
Content-Disposition: attachment; filename=&#34;initrd.img&#34;
</code></pre><p><strong>Storage Path:</strong></p><p>The initrd is fetched from <code>gs://{bucket}/blobs/{initrd_id}</code> where <code>initrd_id</code> is the UUIDv7 identifier from the profile.</p><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>404 Not Found</td><td>Profile with specified ID not found</td></tr></tbody></table><hr><h3 id=put-apiv1profilesid><code>PUT /api/v1/profiles/{id}</code></h3><p>Update a boot profile (creates a new version associated with the machine).</p><h4 id=sequence-diagram-5>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant Storage as Cloud Storage
    participant DB as Firestore
    
    Client-&gt;&gt;API: PUT /api/v1/profiles/{id}
    API-&gt;&gt;DB: Get current profile
    DB--&gt;&gt;API: Current profile
    API-&gt;&gt;API: Generate UUIDs for new kernel/initrd
    API-&gt;&gt;Storage: PUT new kernel/initrd blobs
    Storage--&gt;&gt;API: Blobs stored
    API-&gt;&gt;DB: Update boot profile info
    DB--&gt;&gt;API: Profile updated
    API--&gt;&gt;Client: 200 OK (updated profile)</pre><p><strong>Path Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>Yes</td><td>Boot profile identifier (UUIDv7 format)</td></tr></tbody></table><p><strong>Request Body (multipart/form-data):</strong></p><p>Same as POST request (machine_id, kernel, initrd, kernel_args).</p><p><strong>Response (200 OK):</strong></p><p>Updated profile metadata.</p><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>404 Not Found</td><td>Profile with specified ID not found</td></tr><tr><td>422 Unprocessable Entity</td><td>Validation error</td></tr></tbody></table><hr><h3 id=delete-apiv1profilesid><code>DELETE /api/v1/profiles/{id}</code></h3><p>Delete a boot profile and its associated blobs.</p><h4 id=sequence-diagram-6>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant Storage as Cloud Storage
    participant DB as Firestore
    
    Client-&gt;&gt;API: DELETE /api/v1/profiles/{id}
    API-&gt;&gt;DB: Get kernel_id and initrd_id
    DB--&gt;&gt;API: Blob IDs
    API-&gt;&gt;Storage: DELETE gs://bucket/blobs/{kernel_id}
    API-&gt;&gt;Storage: DELETE gs://bucket/blobs/{initrd_id}
    API-&gt;&gt;DB: Delete profile metadata
    API--&gt;&gt;Client: 204 No Content</pre><p><strong>Path Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>Yes</td><td>Boot profile identifier (UUIDv7 format)</td></tr></tbody></table><p><strong>Response (204 No Content):</strong></p><p>Empty response body.</p><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>404 Not Found</td><td>Profile with specified ID not found</td></tr></tbody></table><hr><h2 id=machine-management>Machine Management</h2><h3 id=post-apiv1machines><code>POST /api/v1/machines</code></h3><p>Register a new machine with hardware specifications.</p><h4 id=sequence-diagram-7>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant DB as Firestore
    
    Client-&gt;&gt;API: POST /api/v1/machines
    API-&gt;&gt;API: Generate machine id (UUIDv7)
    API-&gt;&gt;API: Validate machine profile
    API-&gt;&gt;DB: Insert machine profile
    DB--&gt;&gt;API: Machine created
    API--&gt;&gt;Client: 201 Created (machine id)</pre><p><strong>Request Body:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpus&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;manufacturer&#34;</span><span class=p>:</span> <span class=s2>&#34;Intel&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;clock_frequency&#34;</span><span class=p>:</span> <span class=mi>2400000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cores&#34;</span><span class=p>:</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;memory_modules&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;size&#34;</span><span class=p>:</span> <span class=mi>17179869184</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;size&#34;</span><span class=p>:</span> <span class=mi>17179869184</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;accelerators&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;nics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;mac&#34;</span><span class=p>:</span> <span class=s2>&#34;52:54:00:12:34:56&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;drives&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;capacity&#34;</span><span class=p>:</span> <span class=mi>500107862016</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Response (201 Created):</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-c000-7000-8000-fedcba987654&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpus&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;manufacturer&#34;</span><span class=p>:</span> <span class=s2>&#34;Intel&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;clock_frequency&#34;</span><span class=p>:</span> <span class=mi>2400000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cores&#34;</span><span class=p>:</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;memory_modules&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;size&#34;</span><span class=p>:</span> <span class=mi>17179869184</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;size&#34;</span><span class=p>:</span> <span class=mi>17179869184</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;accelerators&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;nics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;mac&#34;</span><span class=p>:</span> <span class=s2>&#34;52:54:00:12:34:56&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;drives&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;capacity&#34;</span><span class=p>:</span> <span class=mi>500107862016</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>400 Bad Request</td><td>Invalid request body or missing required fields</td></tr><tr><td>409 Conflict</td><td>Machine with the same NIC MAC address already exists</td></tr></tbody></table><p><strong>Notes:</strong></p><ul><li>The machine ID is generated server-side (UUIDv7)</li><li>MAC addresses must be unique across all machines</li><li>All size/capacity values are in bytes</li><li>Clock frequency is in hertz</li></ul><hr><h3 id=get-apiv1machines><code>GET /api/v1/machines</code></h3><p>List all registered machines.</p><h4 id=sequence-diagram-8>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant DB as Firestore
    
    Client-&gt;&gt;API: GET /api/v1/machines?mac=...
    API-&gt;&gt;DB: Query machines with filters
    DB--&gt;&gt;API: Machine list
    API--&gt;&gt;Client: 200 OK (machines list)</pre><p><strong>Query Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>page</code></td><td>integer</td><td>No</td><td>Page number (1-indexed)</td><td>1</td></tr><tr><td><code>per_page</code></td><td>integer</td><td>No</td><td>Results per page (1-100)</td><td>20</td></tr><tr><td><code>mac</code></td><td>string</td><td>No</td><td>Filter by NIC MAC address</td><td>-</td></tr></tbody></table><p><strong>Response (200 OK):</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;machines&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;018c7dbd-c000-7000-8000-fedcba987654&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;cpus&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;manufacturer&#34;</span><span class=p>:</span> <span class=s2>&#34;Intel&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;clock_frequency&#34;</span><span class=p>:</span> <span class=mi>2400000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;cores&#34;</span><span class=p>:</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;memory_modules&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;size&#34;</span><span class=p>:</span> <span class=mi>17179869184</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;accelerators&#34;</span><span class=p>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;nics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;mac&#34;</span><span class=p>:</span> <span class=s2>&#34;52:54:00:12:34:56&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;drives&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;capacity&#34;</span><span class=p>:</span> <span class=mi>500107862016</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pagination&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;total&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;page&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;per_page&#34;</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;total_pages&#34;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h3 id=get-apiv1machinesid><code>GET /api/v1/machines/{id}</code></h3><p>Retrieve a specific machine by ID.</p><h4 id=sequence-diagram-9>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant DB as Firestore
    
    Client-&gt;&gt;API: GET /api/v1/machines/{id}
    API-&gt;&gt;DB: Query machine by ID
    DB--&gt;&gt;API: Machine profile
    API--&gt;&gt;Client: 200 OK (machine profile)</pre><p><strong>Path Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>Yes</td><td>Machine identifier (UUIDv7 format)</td></tr></tbody></table><p><strong>Response (200 OK):</strong></p><p>Same as POST response.</p><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>404 Not Found</td><td>Machine with specified ID not found</td></tr></tbody></table><hr><h3 id=put-apiv1machinesid><code>PUT /api/v1/machines/{id}</code></h3><p>Update a machine&rsquo;s hardware profile.</p><h4 id=sequence-diagram-10>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant DB as Firestore
    
    Client-&gt;&gt;API: PUT /api/v1/machines/{id}
    API-&gt;&gt;DB: Update machine profile
    DB--&gt;&gt;API: Machine updated
    API--&gt;&gt;Client: 200 OK (updated profile)</pre><p><strong>Path Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>Yes</td><td>Machine identifier (UUIDv7 format)</td></tr></tbody></table><p><strong>Request Body:</strong></p><p>Full machine profile (same as POST request).</p><p><strong>Response (200 OK):</strong></p><p>Full machine profile with updated fields.</p><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>404 Not Found</td><td>Machine with specified ID not found</td></tr><tr><td>400 Bad Request</td><td>Invalid request body</td></tr></tbody></table><hr><h3 id=delete-apiv1machinesid><code>DELETE /api/v1/machines/{id}</code></h3><p>Delete a machine registration.</p><h4 id=sequence-diagram-11>Sequence Diagram</h4><pre class=mermaid>sequenceDiagram
    participant Client as Admin Client
    participant API as Machine Management Service
    participant DB as Firestore
    
    Client-&gt;&gt;API: DELETE /api/v1/machines/{id}
    API-&gt;&gt;DB: Delete machine by ID
    DB--&gt;&gt;API: Machine deleted
    API--&gt;&gt;Client: 204 No Content</pre><p><strong>Path Parameters:</strong></p><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>Yes</td><td>Machine identifier (UUIDv7 format)</td></tr></tbody></table><p><strong>Response (204 No Content):</strong></p><p>Empty response body.</p><p><strong>Error Responses:</strong></p><table><thead><tr><th>Status Code</th><th>Description</th></tr></thead><tbody><tr><td>404 Not Found</td><td>Machine with specified ID not found</td></tr></tbody></table><hr><h2 id=boot-profile-management-1>Boot Profile Management</h2><p>All data models are defined as Protocol Buffer (protobuf) messages and stored in Firestore.</p><h3 id=boot-profile>Boot Profile</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=n>syntax</span> <span class=o>=</span> <span class=s>&#34;proto3&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>Kernel</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>id</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>              <span class=c1>// UUIDv7 blob identifier
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>repeated</span> <span class=kt>string</span> <span class=n>args</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>   <span class=c1>// Kernel command-line arguments
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>Initrd</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>id</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>              <span class=c1>// UUIDv7 blob identifier
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>BootProfile</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>id</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>              <span class=c1>// UUIDv7 identifier
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Kernel</span> <span class=n>kernel</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>          <span class=c1>// Kernel configuration
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Initrd</span> <span class=n>initrd</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>          <span class=c1>// Initrd configuration
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></div><h3 id=machine>Machine</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=n>syntax</span> <span class=o>=</span> <span class=s>&#34;proto3&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>CPU</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>manufacturer</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>int64</span> <span class=n>clock_frequency</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>  <span class=c1>// measured in hertz
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int64</span> <span class=n>cores</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>            <span class=c1>// number of cores
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>MemoryModule</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>int64</span> <span class=n>size</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>             <span class=c1>// measured in bytes
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>Accelerator</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>manufacturer</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>NIC</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>mac</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>             <span class=c1>// mac address
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>Drive</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>int64</span> <span class=n>capacity</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>         <span class=c1>// capacity in bytes
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=kd>message</span> <span class=nc>Machine</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>id</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>              <span class=c1>// UUIDv7 machine identifier
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>repeated</span> <span class=n>CPU</span> <span class=n>cpus</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>repeated</span> <span class=n>MemoryModule</span> <span class=n>memory_modules</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>repeated</span> <span class=n>Accelerator</span> <span class=n>accelerators</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>repeated</span> <span class=n>NIC</span> <span class=n>nics</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>repeated</span> <span class=n>Drive</span> <span class=n>drives</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></div><hr><h2 id=rate-limiting>Rate Limiting</h2><p>Admin API endpoints are rate-limited to prevent abuse:</p><ul><li><strong>Per User/Service Account</strong>: 100 requests/minute</li><li><strong>Per IP Address</strong>: 300 requests/minute</li><li><strong>Global</strong>: 1000 requests/minute</li></ul><p>Rate limit headers are included in responses:</p><pre tabindex=0><code>X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1700000000
</code></pre><p>When rate limit is exceeded, API returns <code>429 Too Many Requests</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=s2>&#34;RATE_LIMIT_EXCEEDED&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Rate limit exceeded. Try again in 30 seconds.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;details&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;retry_after&#34;</span><span class=p>:</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 id=versioning>Versioning</h2><p>The Admin API uses URL versioning (<code>/api/v1/</code>):</p><ul><li><strong>Current Version</strong>: v1</li><li><strong>Deprecation Policy</strong>: Minimum 6 months notice before version deprecation</li><li><strong>Version Header</strong>: <code>X-API-Version: v1</code> included in all responses</li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/Zaba505/infra aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024&ndash;2025
<span class=td-footer__authors>Zaba505 | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/infra/pr-preview/pr-626/js/main.min.eb40505784d893e4b5c8dbd67b59c353e735d847f4ffbfe9d6921dec08dbacba.js integrity="sha256-60BQV4TYk+S1yNvWe1nDU+c12Ef0/7/p1pId7AjbrLo=" crossorigin=anonymous></script><script defer src=/infra/pr-preview/pr-626/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/infra/pr-preview/pr-626/js/tabpane-persist.js></script></body></html>