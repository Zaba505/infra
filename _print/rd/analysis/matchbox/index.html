<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://zaba505.github.io/infra/rd/analysis/matchbox/><link rel=alternate type=application/rss+xml href=https://zaba505.github.io/infra/rd/analysis/matchbox/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/infra/favicons/favicon.ico><link rel=apple-touch-icon href=/infra/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/infra/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/infra/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/infra/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/infra/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/infra/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/infra/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/infra/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/infra/favicons/android-192x192.png sizes=192x192><title>Matchbox Analysis | Zaba505's Home Lab</title><meta name=description content="Analysis of Matchbox network boot service capabilities and architecture"><meta property="og:url" content="https://zaba505.github.io/infra/rd/analysis/matchbox/"><meta property="og:site_name" content="Zaba505's Home Lab"><meta property="og:title" content="Matchbox Analysis"><meta property="og:description" content="Analysis of Matchbox network boot service capabilities and architecture"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Matchbox Analysis"><meta itemprop=description content="Analysis of Matchbox network boot service capabilities and architecture"><meta itemprop=dateModified content="2025-11-20T21:45:52-05:00"><meta itemprop=wordCount content="323"><meta name=twitter:card content="summary"><meta name=twitter:title content="Matchbox Analysis"><meta name=twitter:description content="Analysis of Matchbox network boot service capabilities and architecture"><link rel=preload href=/infra/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css as=style integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><link href=/infra/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css rel=stylesheet integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/infra/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Zaba505's Home Lab</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/infra/offline-search-index.e5f8d617485c494e2750ae1a84a3bbbc.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/infra/rd/analysis/matchbox/>Return to the regular view of this page</a>.</p></div><h1 class=title>Matchbox Analysis</h1><div class=lead>Analysis of Matchbox network boot service capabilities and architecture</div><ul><li>1: <a href=#pg-a23269e9072cc20bff941edf0359244d>Configuration Model</a></li><li>2: <a href=#pg-8e3a89622c44227eb5a7e5a4a31bef5c>Deployment Patterns</a></li><li>3: <a href=#pg-62ea704f9d07efc4c09282944f58f495>Network Boot Support</a></li><li>4: <a href=#pg-177196d5d574619d0c7d1eb930af7a44>Use Case Evaluation</a></li></ul><div class=content><h1 id=matchbox-network-boot-analysis>Matchbox Network Boot Analysis</h1><p>This section contains a comprehensive analysis of <a href=https://matchbox.psdn.io/>Matchbox</a>, a network boot service for provisioning bare-metal machines.</p><h2 id=overview>Overview</h2><p>Matchbox is an HTTP and gRPC service developed by Poseidon that automates bare-metal machine provisioning through network booting. It matches machines to configuration profiles based on hardware attributes and serves boot configurations, kernel images, and provisioning configs.</p><p><strong>Primary Repository</strong>: <a href=https://github.com/poseidon/matchbox>poseidon/matchbox</a><br><strong>Documentation</strong>: <a href=https://matchbox.psdn.io/>https://matchbox.psdn.io/</a><br><strong>License</strong>: Apache 2.0</p><h2 id=key-features>Key Features</h2><ul><li><strong>Network Boot Support</strong>: iPXE, PXELINUX, GRUB2 chainloading</li><li><strong>OS Provisioning</strong>: Fedora CoreOS, Flatcar Linux, RHEL CoreOS</li><li><strong>Configuration Management</strong>: Ignition v3.x configs, Butane transpilation</li><li><strong>Machine Matching</strong>: Label-based matching (MAC, UUID, hostname, serial, custom)</li><li><strong>API</strong>: Read-only HTTP API + authenticated gRPC API</li><li><strong>Asset Serving</strong>: Local caching of OS images for faster deployment</li><li><strong>Templating</strong>: Go template support for dynamic configuration</li></ul><h2 id=use-cases>Use Cases</h2><ol><li><strong>Bare-metal Kubernetes clusters</strong> - Provision CoreOS nodes for k8s</li><li><strong>Lab/development environments</strong> - Quick PXE boot for testing</li><li><strong>Datacenter provisioning</strong> - Automate OS installation across fleets</li><li><strong>Immutable infrastructure</strong> - Declarative machine provisioning via Terraform</li></ol><h2 id=analysis-contents>Analysis Contents</h2><ul><li><a href=./network-boot/>Network Boot Architecture</a> - Deep dive into PXE, iPXE, and GRUB support</li><li><a href=./configuration/>Configuration Model</a> - Profiles, Groups, and templating system</li><li><a href=./deployment/>Deployment Patterns</a> - Installation options and operational considerations</li></ul><h2 id=quick-architecture>Quick Architecture</h2><pre tabindex=0><code>┌─────────────┐
│   Machine   │ PXE Boot
│  (BIOS/UEFI)│───┐
└─────────────┘   │
                  │
┌─────────────┐   │ DHCP/TFTP
│   dnsmasq   │◄──┘ (chainload to iPXE)
│  DHCP+TFTP  │
└─────────────┘
       │
       │ HTTP
       ▼
┌─────────────────────────┐
│      Matchbox           │
│  ┌──────────────────┐   │
│  │  HTTP Endpoints  │   │ /boot.ipxe, /ignition
│  └──────────────────┘   │
│  ┌──────────────────┐   │
│  │   gRPC API       │   │ Terraform provider
│  └──────────────────┘   │
│  ┌──────────────────┐   │
│  │ Profile/Group    │   │ Match machines
│  │   Matcher        │   │ to configs
│  └──────────────────┘   │
└─────────────────────────┘
</code></pre><h2 id=technology-stack>Technology Stack</h2><ul><li><strong>Language</strong>: Go</li><li><strong>Config Formats</strong>: Ignition JSON, Butane YAML</li><li><strong>Boot Protocols</strong>: PXE, iPXE, GRUB2</li><li><strong>APIs</strong>: HTTP (read-only), gRPC (authenticated)</li><li><strong>Deployment</strong>: Binary, container (Podman/Docker), Kubernetes</li></ul><h2 id=integration-points>Integration Points</h2><ul><li><strong>Terraform</strong>: <code>terraform-provider-matchbox</code> for declarative provisioning</li><li><strong>Ignition/Butane</strong>: CoreOS provisioning configs</li><li><strong>dnsmasq</strong>: Reference DHCP/TFTP/DNS implementation (<code>quay.io/poseidon/dnsmasq</code>)</li><li><strong>Asset sources</strong>: Can serve local or remote (HTTPS) OS images</li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-a23269e9072cc20bff941edf0359244d>1 - Configuration Model</h1><div class=lead>Analysis of Matchbox&rsquo;s profile, group, and templating system</div><h1 id=matchbox-configuration-model>Matchbox Configuration Model</h1><p>Matchbox uses a flexible configuration model based on <strong>Profiles</strong> (what to provision) and <strong>Groups</strong> (which machines get which profile), with support for templating and metadata.</p><h2 id=architecture-overview>Architecture Overview</h2><pre tabindex=0><code>┌─────────────────────────────────────────────────────────────┐
│                    Matchbox Store                           │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐            │
│  │  Profiles  │  │   Groups   │  │   Assets   │            │
│  └────────────┘  └────────────┘  └────────────┘            │
│        │               │                                    │
│        │               │                                    │
│        ▼               ▼                                    │
│  ┌─────────────────────────────────────┐                   │
│  │       Matcher Engine                │                   │
│  │  (Label-based group selection)      │                   │
│  └─────────────────────────────────────┘                   │
│                    │                                        │
│                    ▼                                        │
│  ┌─────────────────────────────────────┐                   │
│  │    Template Renderer                │                   │
│  │  (Go templates + metadata)          │                   │
│  └─────────────────────────────────────┘                   │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
            Rendered Config (iPXE, Ignition, etc.)
</code></pre><h2 id=data-directory-structure>Data Directory Structure</h2><p>Matchbox uses a FileStore (default) that reads from <code>-data-path</code> (default: <code>/var/lib/matchbox</code>):</p><pre tabindex=0><code>/var/lib/matchbox/
├── groups/              # Machine group definitions (JSON)
│   ├── default.json
│   ├── node1.json
│   └── us-west.json
├── profiles/            # Profile definitions (JSON)
│   ├── worker.json
│   ├── controller.json
│   └── etcd.json
├── ignition/            # Ignition configs (.ign) or Butane (.yaml)
│   ├── worker.ign
│   ├── controller.ign
│   └── butane-example.yaml
├── cloud/               # Cloud-Config templates (DEPRECATED)
│   └── legacy.yaml.tmpl
├── generic/             # Arbitrary config templates
│   ├── setup.cfg
│   └── metadata.yaml.tmpl
└── assets/              # Static files (kernel, initrd)
    ├── fedora-coreos/
    └── flatcar/
</code></pre><p><strong>Version control:</strong> Poseidon recommends keeping <code>/var/lib/matchbox</code> under git for auditability and rollback.</p><h2 id=profiles>Profiles</h2><p>Profiles define <strong>what to provision</strong>: network boot settings (kernel, initrd, args) and config references (Ignition, Cloud-Config, generic).</p><h3 id=profile-schema>Profile Schema</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Fedora CoreOS Worker Node&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;boot&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;kernel&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/assets/fedora-coreos/36.20220906.3.2/fedora-coreos-36.20220906.3.2-live-kernel-x86_64&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;initrd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;--name main /assets/fedora-coreos/36.20220906.3.2/fedora-coreos-36.20220906.3.2-live-initramfs.x86_64.img&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;args&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;initrd=main&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;coreos.live.rootfs_url=http://matchbox.example.com:8080/assets/fedora-coreos/36.20220906.3.2/fedora-coreos-36.20220906.3.2-live-rootfs.x86_64.img&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;coreos.inst.install_dev=/dev/sda&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;coreos.inst.ignition_url=http://matchbox.example.com:8080/ignition?uuid=${uuid}&amp;mac=${mac:hexhyp}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;ignition_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker.ign&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;cloud_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;generic_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=profile-fields>Profile Fields</h3><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>✅</td><td>Unique profile identifier (referenced by groups)</td></tr><tr><td><code>name</code></td><td>string</td><td>❌</td><td>Human-readable description</td></tr><tr><td><code>boot</code></td><td>object</td><td>❌</td><td>Network boot configuration</td></tr><tr><td><code>boot.kernel</code></td><td>string</td><td>❌</td><td>Kernel URL (HTTP/HTTPS or /assets path)</td></tr><tr><td><code>boot.initrd</code></td><td>array</td><td>❌</td><td>Initrd URLs (can specify <code>--name</code> for multi-initrd)</td></tr><tr><td><code>boot.args</code></td><td>array</td><td>❌</td><td>Kernel command-line arguments</td></tr><tr><td><code>ignition_id</code></td><td>string</td><td>❌</td><td>Ignition/Butane config filename in <code>ignition/</code></td></tr><tr><td><code>cloud_id</code></td><td>string</td><td>❌</td><td>Cloud-Config filename in <code>cloud/</code> (deprecated)</td></tr><tr><td><code>generic_id</code></td><td>string</td><td>❌</td><td>Generic config filename in <code>generic/</code></td></tr></tbody></table><h3 id=boot-configuration-patterns>Boot Configuration Patterns</h3><h4 id=pattern-1-live-pxe-ram-based-ephemeral>Pattern 1: Live PXE (RAM-based, ephemeral)</h4><p>Boot and run OS entirely from RAM, no disk install:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;boot&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;kernel&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/assets/fedora-coreos/VERSION/fedora-coreos-VERSION-live-kernel-x86_64&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;initrd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;--name main /assets/fedora-coreos/VERSION/fedora-coreos-VERSION-live-initramfs.x86_64.img&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;args&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;initrd=main&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;coreos.live.rootfs_url=http://matchbox/assets/fedora-coreos/VERSION/fedora-coreos-VERSION-live-rootfs.x86_64.img&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;ignition.config.url=http://matchbox/ignition?uuid=${uuid}&amp;mac=${mac:hexhyp}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Use case:</strong> Diskless workers, testing, ephemeral compute</p><h4 id=pattern-2-disk-install-persistent>Pattern 2: Disk Install (persistent)</h4><p>PXE boot live image, install to disk, reboot to disk:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;boot&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;kernel&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/assets/fedora-coreos/VERSION/fedora-coreos-VERSION-live-kernel-x86_64&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;initrd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;--name main /assets/fedora-coreos/VERSION/fedora-coreos-VERSION-live-initramfs.x86_64.img&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;args&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;initrd=main&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;coreos.live.rootfs_url=http://matchbox/assets/fedora-coreos/VERSION/fedora-coreos-VERSION-live-rootfs.x86_64.img&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;coreos.inst.install_dev=/dev/sda&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;coreos.inst.ignition_url=http://matchbox/ignition?uuid=${uuid}&amp;mac=${mac:hexhyp}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Key difference:</strong> <code>coreos.inst.install_dev</code> triggers disk install before reboot</p><h4 id=pattern-3-multi-initrd-layered>Pattern 3: Multi-initrd (layered)</h4><p>Multiple initrds can be loaded (e.g., base + drivers):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;initrd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;--name main /assets/fedora-coreos/VERSION/fedora-coreos-VERSION-live-initramfs.x86_64.img&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;--name drivers /assets/drivers/custom-drivers.img&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;args&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;initrd=main,drivers&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;...&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=config-references>Config References</h3><h4 id=ignition-configs>Ignition Configs</h4><p><strong>Direct Ignition (.ign files):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;ignition_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker.ign&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>File: <code>/var/lib/matchbox/ignition/worker.ign</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;ignition&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;3.3.0&#34;</span> <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;systemd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;units&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;example.service&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;enabled&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;contents&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;[Service]\nType=oneshot\nExecStart=/usr/bin/echo Hello\n\n[Install]\nWantedBy=multi-user.target&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Butane Configs (transpiled to Ignition):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;ignition_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker.yaml&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>File: <code>/var/lib/matchbox/ignition/worker.yaml</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>variant</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fcos</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1.5.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>passwd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>core</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>ssh_authorized_keys</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>ssh-ed25519 AAAA...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>systemd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>units</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>etcd.service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Matchbox automatically:</strong></p><ol><li>Detects Butane format (file doesn&rsquo;t end in <code>.ign</code> or <code>.ignition</code>)</li><li>Transpiles Butane → Ignition using embedded library</li><li>Renders templates with group metadata</li><li>Serves as Ignition v3.3.0</li></ol><h4 id=generic-configs>Generic Configs</h4><p>For non-Ignition configs (scripts, YAML, arbitrary data):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;generic_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;setup-script.sh.tmpl&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>File: <code>/var/lib/matchbox/generic/setup-script.sh.tmpl</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic># Rendered with group metadata</span>
</span></span><span style=display:flex><span><span style=color:#000>NODE_NAME</span><span style=color:#ce5c00;font-weight:700>={{</span>.node_name<span style=color:#ce5c00;font-weight:700>}}</span>
</span></span><span style=display:flex><span><span style=color:#000>CLUSTER_ID</span><span style=color:#ce5c00;font-weight:700>={{</span>.cluster_id<span style=color:#ce5c00;font-weight:700>}}</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Provisioning </span><span style=color:#4e9a06>${</span><span style=color:#000>NODE_NAME</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06> in cluster </span><span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER_ID</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><p><strong>Access via:</strong> <code>GET /generic?uuid=...&amp;mac=...</code></p><h2 id=groups>Groups</h2><p>Groups match machines to profiles using <strong>selectors</strong> (label matching) and provide <strong>metadata</strong> for template rendering.</p><h3 id=group-schema>Group Schema</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;node1-worker&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Worker Node 1&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;profile&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;selector&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;mac&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;52:54:00:89:d8:10&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;uuid&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;550e8400-e29b-41d4-a716-446655440000&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;node_name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker-01&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;cluster_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;prod-cluster&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;etcd_endpoints&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;https://10.0.1.10:2379,https://10.0.1.11:2379&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;ssh_authorized_keys&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;ssh-ed25519 AAAA...&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;ssh-rsa AAAA...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=group-fields>Group Fields</h3><table><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>id</code></td><td>string</td><td>✅</td><td>Unique group identifier</td></tr><tr><td><code>name</code></td><td>string</td><td>❌</td><td>Human-readable description</td></tr><tr><td><code>profile</code></td><td>string</td><td>✅</td><td>Profile ID to apply</td></tr><tr><td><code>selector</code></td><td>object</td><td>❌</td><td>Label match criteria (omit for default group)</td></tr><tr><td><code>metadata</code></td><td>object</td><td>❌</td><td>Key-value data for template rendering</td></tr></tbody></table><h3 id=selector-matching>Selector Matching</h3><p><strong>Reserved selectors</strong> (automatically populated from machine attributes):</p><table><thead><tr><th>Selector</th><th>Source</th><th>Example</th><th>Normalized</th></tr></thead><tbody><tr><td><code>uuid</code></td><td>SMBIOS UUID</td><td><code>550e8400-e29b-41d4-a716-446655440000</code></td><td>Lowercase</td></tr><tr><td><code>mac</code></td><td>Primary NIC MAC</td><td><code>52:54:00:89:d8:10</code></td><td>Colon-separated</td></tr><tr><td><code>hostname</code></td><td>Network hostname</td><td><code>node1.example.com</code></td><td>As reported</td></tr><tr><td><code>serial</code></td><td>Hardware serial</td><td><code>VMware-42 1a...</code></td><td>As reported</td></tr></tbody></table><p><strong>Custom selectors</strong> (passed as query params):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;selector&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;region&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;us-west&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;environment&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;production&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;rack&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;A23&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Matching request:</strong> <code>/ipxe?mac=52:54:00:89:d8:10&amp;region=us-west&amp;environment=production&amp;rack=A23</code></p><p><strong>Matching logic:</strong></p><ol><li>All selector key-value pairs must match request labels (AND logic)</li><li>Most specific group wins (most selector matches)</li><li>If multiple groups have same specificity, first match wins (undefined order)</li><li>Groups with no selectors = default group (matches all)</li></ol><h3 id=default-groups>Default Groups</h3><p>Group with empty <code>selector</code> matches all machines:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;default-worker&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Default Worker&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;profile&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;environment&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;dev&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>⚠️ <strong>Warning:</strong> Avoid multiple default groups (non-deterministic matching)</p><h3 id=example-region-based-matching>Example: Region-based Matching</h3><p><strong>Group 1: US-West Workers</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;us-west-workers&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;profile&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;selector&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;region&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;us-west&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;etcd_endpoints&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;https://etcd-usw.example.com:2379&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Group 2: EU Workers</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;eu-workers&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;profile&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;selector&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;region&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;eu&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;etcd_endpoints&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;https://etcd-eu.example.com:2379&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Group 3: Specific Machine Override</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;node-special&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;profile&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;controller&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;selector&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;mac&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;52:54:00:89:d8:10&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;region&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;us-west&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;role&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;controller&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Matching precedence:</strong></p><ul><li>Machine with <code>mac=52:54:00:89:d8:10&amp;region=us-west</code> → <code>node-special</code> (2 selectors)</li><li>Machine with <code>region=us-west</code> → <code>us-west-workers</code> (1 selector)</li><li>Machine with <code>region=eu</code> → <code>eu-workers</code> (1 selector)</li></ul><h2 id=templating-system>Templating System</h2><p>Matchbox uses Go&rsquo;s <code>text/template</code> for rendering configs with group metadata.</p><h3 id=template-context>Template Context</h3><p>Available variables in Ignition/Butane/Cloud-Config/generic templates:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Group metadata (all keys from group.metadata)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{.</span><span style=color:#000>node_name</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{.</span><span style=color:#000>cluster_id</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{.</span><span style=color:#000>etcd_endpoints</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Group selectors (normalized)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{.</span><span style=color:#000>mac</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic>// e.g., &#34;52:54:00:89:d8:10&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{.</span><span style=color:#000>uuid</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#8f5902;font-style:italic>// e.g., &#34;550e8400-...&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{.</span><span style=color:#000>region</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#8f5902;font-style:italic>// Custom selector</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Request query params (raw)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{.</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>query</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mac</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#8f5902;font-style:italic>// As passed in URL</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{.</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>query</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>foo</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#8f5902;font-style:italic>// Custom query param</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{.</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>raw_query</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#8f5902;font-style:italic>// Full query string</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// Special functions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{</span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>index</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>.</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ssh_authorized_keys&#34;</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>// Check if key exists</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>{{</span><span style=color:#204a87;font-weight:700>range</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>$</span><span style=color:#000>element</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>:=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ssh_authorized_keys</span><span style=color:#000;font-weight:700>}}</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>// Iterate arrays</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=example-templated-butane-config>Example: Templated Butane Config</h3><p><strong>Group metadata:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;node_name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;worker-01&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;ssh_authorized_keys&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;ssh-ed25519 AAA...&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;ssh-rsa BBB...&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;ntp_servers&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;time1.google.com&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;time2.google.com&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Butane template:</strong> <code>/var/lib/matchbox/ignition/worker.yaml</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>variant</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fcos</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1.5.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>storage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/hostname</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0644</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>contents</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>inline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{{<span style=color:#000>.node_name}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/etc/systemd/timesyncd.conf</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>mode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0644</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>contents</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>inline</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          [Time]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          {{range $server := .ntp_servers}}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          NTP={{$server}}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          {{end}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>{{<span style=color:#000>if index . &#34;ssh_authorized_keys&#34;}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>passwd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>users</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>core</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>ssh_authorized_keys</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{{<span style=color:#000>range $key := .ssh_authorized_keys}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- {{<span style=color:#000>$key}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{{<span style=color:#000>end}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>{{<span style=color:#000>end}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Rendered Ignition (simplified):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;ignition&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;3.3.0&#34;</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;storage&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;files&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;path&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/etc/hostname&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;contents&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;source&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;data:,worker-01&#34;</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;mode&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>420</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;path&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/etc/systemd/timesyncd.conf&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;contents&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span><span style=color:#204a87;font-weight:700>&#34;source&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;data:,%5BTime%5D%0ANTP%3Dtime1.google.com%0ANTP%3Dtime2.google.com&#34;</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;mode&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>420</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;passwd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;users&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;core&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;sshAuthorizedKeys&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;ssh-ed25519 AAA...&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ssh-rsa BBB...&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=template-best-practices>Template Best Practices</h3><ol><li><strong>Prefer external rendering:</strong> Use Terraform + <code>ct_config</code> provider for complex templates</li><li><strong>Validate Butane:</strong> Use <code>strict: true</code> in Terraform or <code>fcct --strict</code></li><li><strong>Escape carefully:</strong> Go templates use <code>{{}}</code>, Butane uses YAML - mind the interaction</li><li><strong>Test rendering:</strong> Request <code>/ignition?mac=...</code> directly to inspect output</li><li><strong>Version control:</strong> Keep templates + groups in git for auditability</li></ol><h3 id=reserved-metadata-keys>Reserved Metadata Keys</h3><p><strong>Warning:</strong> <code>.request</code> is reserved for query param access. Group metadata with <code>"request": {...}</code> will be overwritten.</p><p><strong>Reserved keys:</strong></p><ul><li><code>request.query.*</code> - Query parameters</li><li><code>request.raw_query</code> - Raw query string</li></ul><h2 id=api-integration>API Integration</h2><h3 id=http-endpoints-read-only>HTTP Endpoints (Read-only)</h3><table><thead><tr><th>Endpoint</th><th>Purpose</th><th>Template Context</th></tr></thead><tbody><tr><td><code>/ipxe</code></td><td>iPXE boot script</td><td>Profile <code>boot</code> section</td></tr><tr><td><code>/grub</code></td><td>GRUB config</td><td>Profile <code>boot</code> section</td></tr><tr><td><code>/ignition</code></td><td>Ignition config</td><td>Group metadata + selectors + query</td></tr><tr><td><code>/cloud</code></td><td>Cloud-Config (deprecated)</td><td>Group metadata + selectors + query</td></tr><tr><td><code>/generic</code></td><td>Generic config</td><td>Group metadata + selectors + query</td></tr><tr><td><code>/metadata</code></td><td>Key-value env format</td><td>Group metadata + selectors + query</td></tr></tbody></table><p><strong>Example metadata endpoint response:</strong></p><pre tabindex=0><code>GET /metadata?mac=52:54:00:89:d8:10&amp;foo=bar

NODE_NAME=worker-01
CLUSTER_ID=prod
MAC=52:54:00:89:d8:10
REQUEST_QUERY_MAC=52:54:00:89:d8:10
REQUEST_QUERY_FOO=bar
REQUEST_RAW_QUERY=mac=52:54:00:89:d8:10&amp;foo=bar
</code></pre><h3 id=grpc-api-authenticated-mutable>gRPC API (Authenticated, mutable)</h3><p>Used by <code>terraform-provider-matchbox</code> for declarative infrastructure:</p><p><strong>Terraform example:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#204a87;font-weight:700>provider</span> <span style=color:#4e9a06>&#34;matchbox&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  endpoint</span>    <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;matchbox.example.com:8081&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  client_cert</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;~/.matchbox/client.crt&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>  client_key</span>  <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;~/.matchbox/client.key&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>  ca</span>          <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;~/.matchbox/ca.crt&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>resource</span> <span style=color:#4e9a06>&#34;matchbox_profile&#34; &#34;worker&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  name</span>   <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;worker&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  kernel</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/assets/fedora-coreos/.../kernel&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  initrd</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;--name main /assets/fedora-coreos/.../initramfs.img&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>  args</span>   <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span><span style=color:#000>    &#34;initrd</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>main</span><span style=color:#a40000>&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000>    &#34;coreos.inst.install_dev</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#a40000>/</span><span style=color:#204a87;font-weight:700>dev</span><span style=color:#a40000>/</span><span style=color:#204a87;font-weight:700>sda</span><span style=color:#a40000>&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000>    &#34;coreos.inst.ignition_url</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>${var.matchbox_http_endpoint}/ignition?uuid</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$${uuid}&amp;mac</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#a40000>$</span><span style=color:#4e9a06>${</span><span style=color:#a40000>mac:hexhyp</span><span style=color:#4e9a06>}</span><span style=color:#a40000>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>  raw_ignition</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>ct_config</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>worker</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>rendered</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>resource</span> <span style=color:#4e9a06>&#34;matchbox_group&#34; &#34;node1&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  name</span>    <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;node1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  profile</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>matchbox_profile</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>worker</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>name</span>
</span></span><span style=display:flex><span><span style=color:#000>  selector</span> <span style=color:#ce5c00;font-weight:700>=</span> {
</span></span><span style=display:flex><span><span style=color:#000>    mac</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;52:54:00:89:d8:10&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span><span style=color:#000>  metadata</span> <span style=color:#ce5c00;font-weight:700>=</span> {
</span></span><span style=display:flex><span><span style=color:#000>    node_name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;worker-01&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Operations:</strong></p><ul><li><code>CreateProfile</code>, <code>GetProfile</code>, <code>UpdateProfile</code>, <code>DeleteProfile</code></li><li><code>CreateGroup</code>, <code>GetGroup</code>, <code>UpdateGroup</code>, <code>DeleteGroup</code></li></ul><p><strong>TLS client authentication required</strong> (see deployment docs)</p><h2 id=configuration-workflow>Configuration Workflow</h2><h3 id=recommended-terraform--external-configs>Recommended: Terraform + External Configs</h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────────────┐
│ 1. Write Butane configs (YAML)                             │
│    - worker.yaml, controller.yaml                          │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. Terraform ct_config transpiles Butane → Ignition        │
│    data &#34;ct_config&#34; &#34;worker&#34; {                             │
│      content = file(&#34;worker.yaml&#34;)                         │
│      strict  = true                                        │
│    }                                                        │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. Terraform creates profiles + groups in Matchbox         │
│    matchbox_profile.worker → gRPC CreateProfile()          │
│    matchbox_group.node1 → gRPC CreateGroup()               │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. Machine PXE boots, queries Matchbox                     │
│    GET /ipxe?mac=... → matches group → returns profile     │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 5. Ignition fetches rendered config                        │
│    GET /ignition?mac=... → Matchbox returns Ignition       │
└─────────────────────────────────────────────────────────────┘
</code></pre><p><strong>Benefits:</strong></p><ul><li>Rich Terraform templating (loops, conditionals, external data sources)</li><li>Butane validation before deployment</li><li>Declarative infrastructure (can <code>terraform plan</code> before apply)</li><li>Version control workflow (git + CI/CD)</li></ul><h3 id=alternative-manual-filestore>Alternative: Manual FileStore</h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────────────┐
│ 1. Create profile JSON manually                            │
│    /var/lib/matchbox/profiles/worker.json                  │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. Create group JSON manually                              │
│    /var/lib/matchbox/groups/node1.json                     │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. Write Ignition/Butane config                            │
│    /var/lib/matchbox/ignition/worker.ign                   │
└─────────────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. Restart matchbox (to reload FileStore)                  │
│    systemctl restart matchbox                              │
└─────────────────────────────────────────────────────────────┘
</code></pre><p><strong>Drawbacks:</strong></p><ul><li>Manual file management</li><li>No validation before deployment</li><li>Requires matchbox restart to pick up changes</li><li>Error-prone for large fleets</li></ul><h2 id=storage-backends>Storage Backends</h2><h3 id=filestore-default>FileStore (Default)</h3><p><strong>Config:</strong> <code>-data-path=/var/lib/matchbox</code></p><p><strong>Pros:</strong></p><ul><li>Simple file-based storage</li><li>Easy to version control (git)</li><li>Human-readable JSON</li></ul><p><strong>Cons:</strong></p><ul><li>Requires file system access</li><li>Manual reload for gRPC-created resources</li></ul><h3 id=custom-store-extensible>Custom Store (Extensible)</h3><p>Matchbox&rsquo;s <code>Store</code> interface allows custom backends:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Store</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>interface</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>ProfileGet</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Profile</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>GroupGet</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Group</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>IgnitionGet</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>// ... other methods</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Potential custom stores:</strong></p><ul><li>etcd backend (for HA Matchbox)</li><li>Database backend (PostgreSQL, MySQL)</li><li>S3/object storage backend</li></ul><p><strong>Note:</strong> Not officially provided by Matchbox project; requires custom implementation</p><h2 id=security-considerations>Security Considerations</h2><ol><li><p><strong>gRPC API authentication:</strong> Requires TLS client certificates</p><ul><li><code>ca.crt</code> - CA that signed client certs</li><li><code>server.crt</code>/<code>server.key</code> - Server TLS identity</li><li><code>client.crt</code>/<code>client.key</code> - Client credentials (Terraform)</li></ul></li><li><p><strong>HTTP endpoints are read-only:</strong> No auth, machines fetch configs</p><ul><li>Do NOT put secrets in Ignition configs</li><li>Use external secret stores (Vault, GCP Secret Manager)</li><li>Reference secrets via Ignition <code>files.source</code> with auth headers</li></ul></li><li><p><strong>Network segmentation:</strong> Matchbox on provisioning VLAN, isolate from production</p></li><li><p><strong>Config validation:</strong> Validate Ignition/Butane before deployment to avoid boot failures</p></li><li><p><strong>Audit logging:</strong> Version control groups/profiles; log gRPC API changes</p></li></ol><h2 id=operational-tips>Operational Tips</h2><ol><li><p><strong>Test groups with curl:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#4e9a06>&#39;http://matchbox.example.com:8080/ignition?mac=52:54:00:89:d8:10&#39;</span>
</span></span></code></pre></div></li><li><p><strong>List profiles:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls -la /var/lib/matchbox/profiles/
</span></span></code></pre></div></li><li><p><strong>Validate Butane:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>podman run -i --rm quay.io/coreos/fcct:release --strict &lt; worker.yaml
</span></span></code></pre></div></li><li><p><strong>Check group matching:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Default group (no selectors)</span>
</span></span><span style=display:flex><span>curl http://matchbox.example.com:8080/ignition
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Specific machine</span>
</span></span><span style=display:flex><span>curl <span style=color:#4e9a06>&#39;http://matchbox.example.com:8080/ignition?mac=52:54:00:89:d8:10&amp;uuid=550e8400-e29b-41d4-a716-446655440000&#39;</span>
</span></span></code></pre></div></li><li><p><strong>Backup configs:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar -czf matchbox-backup-<span style=color:#204a87;font-weight:700>$(</span>date +%F<span style=color:#204a87;font-weight:700>)</span>.tar.gz /var/lib/matchbox/<span style=color:#ce5c00;font-weight:700>{</span>groups,profiles,ignition<span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div></li></ol><h2 id=summary>Summary</h2><p>Matchbox&rsquo;s configuration model provides:</p><ul><li><strong>Separation of concerns:</strong> Profiles (what) vs Groups (who/where)</li><li><strong>Flexible matching:</strong> Label-based, multi-attribute, custom selectors</li><li><strong>Template support:</strong> Go templates for dynamic configs (but prefer external rendering)</li><li><strong>API-driven:</strong> Terraform integration for GitOps workflows</li><li><strong>Storage options:</strong> FileStore (simple) or custom backends (extensible)</li><li><strong>OS-agnostic:</strong> Works with any Ignition-based distro (FCOS, Flatcar, RHCOS)</li></ul><p><strong>Best practice:</strong> Use Terraform + external Butane configs for production; manual FileStore for labs/development.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8e3a89622c44227eb5a7e5a4a31bef5c>2 - Deployment Patterns</h1><div class=lead>Matchbox deployment options and operational considerations</div><h1 id=matchbox-deployment-patterns>Matchbox Deployment Patterns</h1><p>Analysis of deployment architectures, installation methods, and operational considerations for running Matchbox in production.</p><h2 id=deployment-architectures>Deployment Architectures</h2><h3 id=single-host-deployment>Single-Host Deployment</h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────┐
│           Provisioning Host                         │
│  ┌─────────────┐        ┌─────────────┐            │
│  │  Matchbox   │        │  dnsmasq    │            │
│  │  :8080 HTTP │        │  DHCP/TFTP  │            │
│  │  :8081 gRPC │        │  :67,:69    │            │
│  └─────────────┘        └─────────────┘            │
│         │                      │                    │
│         └──────────┬───────────┘                    │
│                    │                                │
│  /var/lib/matchbox/                                 │
│  ├── groups/                                        │
│  ├── profiles/                                      │
│  ├── ignition/                                      │
│  └── assets/                                        │
└─────────────────────────────────────────────────────┘
              │
              │ Network
              ▼
     ┌──────────────┐
     │ PXE Clients  │
     └──────────────┘
</code></pre><p><strong>Use case:</strong> Lab, development, small deployments (&lt;50 machines)</p><p><strong>Pros:</strong></p><ul><li>Simple setup</li><li>Single service to manage</li><li>Minimal resource requirements</li></ul><p><strong>Cons:</strong></p><ul><li>Single point of failure</li><li>No scalability</li><li>Downtime during updates</li></ul><h3 id=ha-deployment-multiple-matchbox-instances>HA Deployment (Multiple Matchbox Instances)</h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────┐
│              Load Balancer (Ingress/HAProxy)        │
│           :8080 HTTP        :8081 gRPC              │
└─────────────────────────────────────────────────────┘
       │                              │
       ├─────────────┬────────────────┤
       ▼             ▼                ▼
┌──────────┐  ┌──────────┐    ┌──────────┐
│Matchbox 1│  │Matchbox 2│    │Matchbox N│
│ (Pod/VM) │  │ (Pod/VM) │    │ (Pod/VM) │
└──────────┘  └──────────┘    └──────────┘
       │             │                │
       └─────────────┴────────────────┘
                     │
                     ▼
         ┌────────────────────────┐
         │  Shared Storage        │
         │  /var/lib/matchbox     │
         │  (NFS, PV, ConfigMap)  │
         └────────────────────────┘
</code></pre><p><strong>Use case:</strong> Production, datacenter-scale (100+ machines)</p><p><strong>Pros:</strong></p><ul><li>High availability (no single point of failure)</li><li>Rolling updates (zero downtime)</li><li>Load distribution</li></ul><p><strong>Cons:</strong></p><ul><li>Complex storage (shared volume or etcd backend)</li><li>More infrastructure required</li></ul><p><strong>Storage options:</strong></p><ol><li><strong>Kubernetes PersistentVolume</strong> (RWX mode)</li><li><strong>NFS share</strong> mounted on multiple hosts</li><li><strong>Custom etcd-backed Store</strong> (requires custom implementation)</li><li><strong>Git-sync sidecar</strong> (read-only, periodic pull)</li></ol><h3 id=kubernetes-deployment>Kubernetes Deployment</h3><pre tabindex=0><code>┌─────────────────────────────────────────────────────┐
│              Ingress Controller                     │
│  matchbox.example.com → Service matchbox:8080       │
│  matchbox-rpc.example.com → Service matchbox:8081   │
└─────────────────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────┐
│          Service: matchbox (ClusterIP)              │
│            ports: 8080/TCP, 8081/TCP                │
└─────────────────────────────────────────────────────┘
                     │
         ┌───────────┴───────────┐
         ▼                       ▼
┌─────────────────┐     ┌─────────────────┐
│  Pod: matchbox  │     │  Pod: matchbox  │
│  replicas: 2+   │     │  replicas: 2+   │
└─────────────────┘     └─────────────────┘
         │                       │
         └───────────┬───────────┘
                     ▼
┌─────────────────────────────────────────────────────┐
│    PersistentVolumeClaim: matchbox-data             │
│    /var/lib/matchbox (RWX mode)                     │
└─────────────────────────────────────────────────────┘
</code></pre><p><strong>Manifest structure:</strong></p><pre tabindex=0><code>contrib/k8s/
├── matchbox-deployment.yaml  # Deployment + replicas
├── matchbox-service.yaml     # Service (8080, 8081)
├── matchbox-ingress.yaml     # Ingress (HTTP + gRPC TLS)
└── matchbox-pvc.yaml         # PersistentVolumeClaim
</code></pre><p><strong>Key configurations:</strong></p><ol><li><p><strong>Secret for gRPC TLS:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create secret generic matchbox-rpc <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --from-file<span style=color:#ce5c00;font-weight:700>=</span>ca.crt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --from-file<span style=color:#ce5c00;font-weight:700>=</span>server.crt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --from-file<span style=color:#ce5c00;font-weight:700>=</span>server.key
</span></span></code></pre></div></li><li><p><strong>Ingress for gRPC (TLS passthrough):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nginx.ingress.kubernetes.io/ssl-passthrough</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>nginx.ingress.kubernetes.io/backend-protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;GRPC&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p><strong>Volume mount:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>persistentVolumeClaim</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>claimName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>matchbox-data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/lib/matchbox</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li></ol><p><strong>Use case:</strong> Cloud-native deployments, Kubernetes-based infrastructure</p><p><strong>Pros:</strong></p><ul><li>Native Kubernetes primitives (Deployments, Services, Ingress)</li><li>Rolling updates via Deployment strategy</li><li>Easy scaling (<code>kubectl scale</code>)</li><li>Health checks + auto-restart</li></ul><p><strong>Cons:</strong></p><ul><li>Requires RWX PersistentVolume or shared storage</li><li>Ingress TLS configuration complexity (gRPC passthrough)</li><li>Cluster dependency (can&rsquo;t provision cluster bootstrap nodes)</li></ul><p>⚠️ <strong>Bootstrap problem:</strong> Kubernetes-hosted Matchbox can&rsquo;t PXE boot its own cluster nodes (chicken-and-egg). Use external Matchbox for initial cluster bootstrap, then migrate.</p><h2 id=installation-methods>Installation Methods</h2><h3 id=1-binary-installation-systemd>1. Binary Installation (systemd)</h3><p><strong>Recommended for:</strong> Bare-metal hosts, VMs, traditional Linux servers</p><p><strong>Steps:</strong></p><ol><li><p><strong>Download and verify:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/poseidon/matchbox/releases/download/v0.10.0/matchbox-v0.10.0-linux-amd64.tar.gz
</span></span><span style=display:flex><span>wget https://github.com/poseidon/matchbox/releases/download/v0.10.0/matchbox-v0.10.0-linux-amd64.tar.gz.asc
</span></span><span style=display:flex><span>gpg --verify matchbox-v0.10.0-linux-amd64.tar.gz.asc
</span></span></code></pre></div></li><li><p><strong>Extract and install:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar xzf matchbox-v0.10.0-linux-amd64.tar.gz
</span></span><span style=display:flex><span>sudo cp matchbox-v0.10.0-linux-amd64/matchbox /usr/local/bin/
</span></span></code></pre></div></li><li><p><strong>Create user and directories:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo useradd -U matchbox
</span></span><span style=display:flex><span>sudo mkdir -p /var/lib/matchbox/<span style=color:#ce5c00;font-weight:700>{</span>assets,groups,profiles,ignition<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>sudo chown -R matchbox:matchbox /var/lib/matchbox
</span></span></code></pre></div></li><li><p><strong>Install systemd unit:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp contrib/systemd/matchbox.service /etc/systemd/system/
</span></span></code></pre></div></li><li><p><strong>Configure via systemd dropin:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl edit matchbox
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[Service]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Environment</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;MATCHBOX_ADDRESS=0.0.0.0:8080&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Environment</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;MATCHBOX_RPC_ADDRESS=0.0.0.0:8081&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Environment</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;MATCHBOX_LOG_LEVEL=debug&#34;</span>
</span></span></code></pre></div></li><li><p><strong>Start service:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl daemon-reload
</span></span><span style=display:flex><span>sudo systemctl start matchbox
</span></span><span style=display:flex><span>sudo systemctl <span style=color:#204a87>enable</span> matchbox
</span></span></code></pre></div></li></ol><p><strong>Pros:</strong></p><ul><li>Direct control over service</li><li>Easy log access (<code>journalctl -u matchbox</code>)</li><li>Native OS integration</li></ul><p><strong>Cons:</strong></p><ul><li>Manual updates required</li><li>OS dependency (package compatibility)</li></ul><h3 id=2-container-deployment-dockerpodman>2. Container Deployment (Docker/Podman)</h3><p><strong>Recommended for:</strong> Docker hosts, quick testing, immutable infrastructure</p><p><strong>Docker:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /var/lib/matchbox/assets
</span></span><span style=display:flex><span>docker run -d --name matchbox <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --net<span style=color:#ce5c00;font-weight:700>=</span>host <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -v /var/lib/matchbox:/var/lib/matchbox:Z <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -v /etc/matchbox:/etc/matchbox:Z,ro <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  quay.io/poseidon/matchbox:v0.10.0 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -address<span style=color:#ce5c00;font-weight:700>=</span>0.0.0.0:8080 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -rpc-address<span style=color:#ce5c00;font-weight:700>=</span>0.0.0.0:8081 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -log-level<span style=color:#ce5c00;font-weight:700>=</span>debug
</span></span></code></pre></div><p><strong>Podman:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>podman run -d --name matchbox <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --net<span style=color:#ce5c00;font-weight:700>=</span>host <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -v /var/lib/matchbox:/var/lib/matchbox:Z <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -v /etc/matchbox:/etc/matchbox:Z,ro <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  quay.io/poseidon/matchbox:v0.10.0 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -address<span style=color:#ce5c00;font-weight:700>=</span>0.0.0.0:8080 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -rpc-address<span style=color:#ce5c00;font-weight:700>=</span>0.0.0.0:8081 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -log-level<span style=color:#ce5c00;font-weight:700>=</span>debug
</span></span></code></pre></div><p><strong>Volume mounts:</strong></p><ul><li><code>/var/lib/matchbox</code> - Data directory (groups, profiles, configs, assets)</li><li><code>/etc/matchbox</code> - TLS certificates (ca.crt, server.crt, server.key)</li></ul><p><strong>Network mode:</strong></p><ul><li><code>--net=host</code> - Required for DHCP/TFTP interaction on same host</li><li>Bridge mode possible if Matchbox is on separate host from dnsmasq</li></ul><p><strong>Pros:</strong></p><ul><li>Immutable deployments</li><li>Easy updates (pull new image)</li><li>Portable across hosts</li></ul><p><strong>Cons:</strong></p><ul><li>Volume management complexity</li><li>SELinux considerations (<code>:Z</code> flag)</li></ul><h3 id=3-kubernetes-deployment>3. Kubernetes Deployment</h3><p><strong>Recommended for:</strong> Kubernetes environments, cloud platforms</p><p><strong>Quick start:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create TLS secret for gRPC</span>
</span></span><span style=display:flex><span>kubectl create secret generic matchbox-rpc <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --from-file<span style=color:#ce5c00;font-weight:700>=</span>ca.crt<span style=color:#ce5c00;font-weight:700>=</span>~/.matchbox/ca.crt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --from-file<span style=color:#ce5c00;font-weight:700>=</span>server.crt<span style=color:#ce5c00;font-weight:700>=</span>~/.matchbox/server.crt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --from-file<span style=color:#ce5c00;font-weight:700>=</span>server.key<span style=color:#ce5c00;font-weight:700>=</span>~/.matchbox/server.key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Deploy manifests</span>
</span></span><span style=display:flex><span>kubectl apply -R -f contrib/k8s/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check status</span>
</span></span><span style=display:flex><span>kubectl get pods -l <span style=color:#000>app</span><span style=color:#ce5c00;font-weight:700>=</span>matchbox
</span></span><span style=display:flex><span>kubectl get svc matchbox
</span></span><span style=display:flex><span>kubectl get ingress matchbox matchbox-rpc
</span></span></code></pre></div><p><strong>Persistence options:</strong></p><p><strong>Option 1: emptyDir (ephemeral, dev only):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>emptyDir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Option 2: PersistentVolumeClaim (production):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>persistentVolumeClaim</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>claimName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>matchbox-data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Option 3: ConfigMap (static configs):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>groups</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>configMap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>matchbox-groups</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>profiles</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>configMap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>matchbox-profiles</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Option 4: Git-sync sidecar (GitOps):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>initContainers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>git-sync</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>k8s.gcr.io/git-sync:v3.6.3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GIT_SYNC_REPO</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://github.com/example/matchbox-configs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GIT_SYNC_DEST</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/lib/matchbox</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/lib/matchbox</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>Pros:</strong></p><ul><li>Native k8s features (scaling, health checks, rolling updates)</li><li>Ingress integration</li><li>GitOps workflows</li></ul><p><strong>Cons:</strong></p><ul><li>Complexity (Ingress, PVC, TLS)</li><li>Can&rsquo;t bootstrap own cluster</li></ul><h2 id=network-boot-environment-setup>Network Boot Environment Setup</h2><p>Matchbox requires separate DHCP/TFTP/DNS services. Options:</p><h3 id=option-1-dnsmasq-container-quickest>Option 1: dnsmasq Container (Quickest)</h3><p><strong>Use case:</strong> Lab, testing, environments without existing DHCP</p><p><strong>Full DHCP + TFTP + DNS:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d --name dnsmasq <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --cap-add<span style=color:#ce5c00;font-weight:700>=</span>NET_ADMIN <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --net<span style=color:#ce5c00;font-weight:700>=</span>host <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  quay.io/poseidon/dnsmasq:latest <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -d -q <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-range<span style=color:#ce5c00;font-weight:700>=</span>192.168.1.3,192.168.1.254,30m <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --enable-tftp <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --tftp-root<span style=color:#ce5c00;font-weight:700>=</span>/var/lib/tftpboot <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-match<span style=color:#ce5c00;font-weight:700>=</span>set:bios,option:client-arch,0 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-boot<span style=color:#ce5c00;font-weight:700>=</span>tag:bios,undionly.kpxe <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-match<span style=color:#ce5c00;font-weight:700>=</span>set:efi64,option:client-arch,9 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-boot<span style=color:#ce5c00;font-weight:700>=</span>tag:efi64,ipxe.efi <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-userclass<span style=color:#ce5c00;font-weight:700>=</span>set:ipxe,iPXE <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-boot<span style=color:#ce5c00;font-weight:700>=</span>tag:ipxe,http://matchbox.example.com:8080/boot.ipxe <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --address<span style=color:#ce5c00;font-weight:700>=</span>/matchbox.example.com/192.168.1.2 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --log-queries <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --log-dhcp
</span></span></code></pre></div><p><strong>Proxy DHCP (alongside existing DHCP):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d --name dnsmasq <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --cap-add<span style=color:#ce5c00;font-weight:700>=</span>NET_ADMIN <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --net<span style=color:#ce5c00;font-weight:700>=</span>host <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  quay.io/poseidon/dnsmasq:latest <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -d -q <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-range<span style=color:#ce5c00;font-weight:700>=</span>192.168.1.1,proxy,255.255.255.0 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --enable-tftp <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --tftp-root<span style=color:#ce5c00;font-weight:700>=</span>/var/lib/tftpboot <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-userclass<span style=color:#ce5c00;font-weight:700>=</span>set:ipxe,iPXE <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --pxe-service<span style=color:#ce5c00;font-weight:700>=</span>tag:#ipxe,x86PC,<span style=color:#4e9a06>&#34;PXE chainload to iPXE&#34;</span>,undionly.kpxe <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --pxe-service<span style=color:#ce5c00;font-weight:700>=</span>tag:ipxe,x86PC,<span style=color:#4e9a06>&#34;iPXE&#34;</span>,http://matchbox.example.com:8080/boot.ipxe <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --log-queries <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --log-dhcp
</span></span></code></pre></div><p><strong>Included files:</strong> <code>undionly.kpxe</code>, <code>ipxe.efi</code>, <code>grub.efi</code> (bundled in image)</p><h3 id=option-2-existing-dhcptftp-infrastructure>Option 2: Existing DHCP/TFTP Infrastructure</h3><p><strong>Use case:</strong> Enterprise environments with network admin policies</p><p><strong>Required DHCP options (ISC DHCP example):</strong></p><pre tabindex=0><code>subnet 192.168.1.0 netmask 255.255.255.0 {
  range 192.168.1.10 192.168.1.250;
  
  # BIOS clients
  if option architecture-type = 00:00 {
    filename &#34;undionly.kpxe&#34;;
  }
  # UEFI clients
  elsif option architecture-type = 00:09 {
    filename &#34;ipxe.efi&#34;;
  }
  # iPXE clients
  elsif exists user-class and option user-class = &#34;iPXE&#34; {
    filename &#34;http://matchbox.example.com:8080/boot.ipxe&#34;;
  }
  
  next-server 192.168.1.100;  # TFTP server IP
}
</code></pre><p><strong>TFTP files (place in tftp root):</strong></p><ul><li>Download from <a href=http://boot.ipxe.org/undionly.kpxe>http://boot.ipxe.org/undionly.kpxe</a></li><li>Download from <a href=http://boot.ipxe.org/ipxe.efi>http://boot.ipxe.org/ipxe.efi</a></li></ul><h3 id=option-3-ipxe-only-no-pxe-chainload>Option 3: iPXE-only (No PXE Chainload)</h3><p><strong>Use case:</strong> Modern hardware with native iPXE firmware</p><p><strong>DHCP config (simpler):</strong></p><pre tabindex=0><code>filename &#34;http://matchbox.example.com:8080/boot.ipxe&#34;;
</code></pre><p><strong>No TFTP server needed</strong> (iPXE fetches directly via HTTP)</p><p><strong>Limitation:</strong> Doesn&rsquo;t support legacy BIOS with basic PXE ROM</p><h2 id=tls-certificate-setup>TLS Certificate Setup</h2><p>gRPC API requires TLS client certificates for authentication.</p><h3 id=option-1-provided-cert-gen-script>Option 1: Provided cert-gen Script</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> scripts/tls
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>SAN</span><span style=color:#ce5c00;font-weight:700>=</span>DNS.1:matchbox.example.com,IP.1:192.168.1.100
</span></span><span style=display:flex><span>./cert-gen
</span></span></code></pre></div><p><strong>Generates:</strong></p><ul><li><code>ca.crt</code> - Self-signed CA</li><li><code>server.crt</code>, <code>server.key</code> - Server credentials</li><li><code>client.crt</code>, <code>client.key</code> - Client credentials (for Terraform)</li></ul><p><strong>Install server certs:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /etc/matchbox
</span></span><span style=display:flex><span>sudo cp ca.crt server.crt server.key /etc/matchbox/
</span></span><span style=display:flex><span>sudo chown -R matchbox:matchbox /etc/matchbox
</span></span></code></pre></div><p><strong>Save client certs for Terraform:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/.matchbox
</span></span><span style=display:flex><span>cp client.crt client.key ca.crt ~/.matchbox/
</span></span></code></pre></div><h3 id=option-2-corporate-pki>Option 2: Corporate PKI</h3><p><strong>Preferred for production:</strong> Use organization&rsquo;s certificate authority</p><p><strong>Requirements:</strong></p><ul><li>Server cert with SAN: <code>DNS:matchbox.example.com</code></li><li>Client cert issued by same CA</li><li>CA cert for validation</li></ul><p><strong>Matchbox flags:</strong></p><pre tabindex=0><code>-ca-file=/etc/matchbox/ca.crt
-cert-file=/etc/matchbox/server.crt
-key-file=/etc/matchbox/server.key
</code></pre><p><strong>Terraform provider config:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#204a87;font-weight:700>provider</span> <span style=color:#4e9a06>&#34;matchbox&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  endpoint</span>    <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;matchbox.example.com:8081&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  client_cert</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/path/to/client.crt&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>  client_key</span>  <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/path/to/client.key&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>  ca</span>          <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>file</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/path/to/ca.crt&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=option-3-lets-encrypt-http-api-only>Option 3: Let&rsquo;s Encrypt (HTTP API only)</h3><p><strong>Note:</strong> gRPC requires client cert auth (incompatible with Let&rsquo;s Encrypt)</p><p><strong>Use case:</strong> TLS for HTTP endpoints only (read-only API)</p><p><strong>Matchbox flags:</strong></p><pre tabindex=0><code>-web-ssl=true
-web-cert-file=/etc/letsencrypt/live/matchbox.example.com/fullchain.pem
-web-key-file=/etc/letsencrypt/live/matchbox.example.com/privkey.pem
</code></pre><p><strong>Limitation:</strong> Still need self-signed certs for gRPC API</p><h2 id=configuration-flags>Configuration Flags</h2><h3 id=core-flags>Core Flags</h3><table><thead><tr><th>Flag</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>-address</code></td><td><code>127.0.0.1:8080</code></td><td>HTTP API listen address</td></tr><tr><td><code>-rpc-address</code></td><td>``</td><td>gRPC API listen address (empty = disabled)</td></tr><tr><td><code>-data-path</code></td><td><code>/var/lib/matchbox</code></td><td>Data directory (FileStore)</td></tr><tr><td><code>-assets-path</code></td><td><code>/var/lib/matchbox/assets</code></td><td>Static assets directory</td></tr><tr><td><code>-log-level</code></td><td><code>info</code></td><td>Logging level (debug, info, warn, error)</td></tr></tbody></table><h3 id=tls-flags-grpc>TLS Flags (gRPC)</h3><table><thead><tr><th>Flag</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>-ca-file</code></td><td><code>/etc/matchbox/ca.crt</code></td><td>CA certificate for client verification</td></tr><tr><td><code>-cert-file</code></td><td><code>/etc/matchbox/server.crt</code></td><td>Server TLS certificate</td></tr><tr><td><code>-key-file</code></td><td><code>/etc/matchbox/server.key</code></td><td>Server TLS private key</td></tr></tbody></table><h3 id=tls-flags-http-optional>TLS Flags (HTTP, optional)</h3><table><thead><tr><th>Flag</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>-web-ssl</code></td><td><code>false</code></td><td>Enable TLS for HTTP API</td></tr><tr><td><code>-web-cert-file</code></td><td>``</td><td>HTTP server TLS certificate</td></tr><tr><td><code>-web-key-file</code></td><td>``</td><td>HTTP server TLS private key</td></tr></tbody></table><h3 id=environment-variables>Environment Variables</h3><p>All flags can be set via environment variables with <code>MATCHBOX_</code> prefix:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MATCHBOX_ADDRESS</span><span style=color:#ce5c00;font-weight:700>=</span>0.0.0.0:8080
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MATCHBOX_RPC_ADDRESS</span><span style=color:#ce5c00;font-weight:700>=</span>0.0.0.0:8081
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MATCHBOX_LOG_LEVEL</span><span style=color:#ce5c00;font-weight:700>=</span>debug
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MATCHBOX_DATA_PATH</span><span style=color:#ce5c00;font-weight:700>=</span>/custom/path
</span></span></code></pre></div><h2 id=operational-considerations>Operational Considerations</h2><h3 id=firewall-configuration>Firewall Configuration</h3><p><strong>Matchbox host:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firewall-cmd --permanent --add-port<span style=color:#ce5c00;font-weight:700>=</span>8080/tcp  <span style=color:#8f5902;font-style:italic># HTTP API</span>
</span></span><span style=display:flex><span>firewall-cmd --permanent --add-port<span style=color:#ce5c00;font-weight:700>=</span>8081/tcp  <span style=color:#8f5902;font-style:italic># gRPC API</span>
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><p><strong>dnsmasq host (if separate):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firewall-cmd --permanent --add-service<span style=color:#ce5c00;font-weight:700>=</span>dhcp
</span></span><span style=display:flex><span>firewall-cmd --permanent --add-service<span style=color:#ce5c00;font-weight:700>=</span>tftp
</span></span><span style=display:flex><span>firewall-cmd --permanent --add-service<span style=color:#ce5c00;font-weight:700>=</span>dns  <span style=color:#8f5902;font-style:italic># optional</span>
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><h3 id=monitoring>Monitoring</h3><p><strong>Health check endpoints:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># HTTP API</span>
</span></span><span style=display:flex><span>curl http://matchbox.example.com:8080
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Should return: matchbox</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># gRPC API</span>
</span></span><span style=display:flex><span>openssl s_client -connect matchbox.example.com:8081 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -CAfile ~/.matchbox/ca.crt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -cert ~/.matchbox/client.crt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -key ~/.matchbox/client.key
</span></span></code></pre></div><p><strong>Prometheus metrics:</strong> Not built-in; consider adding reverse proxy (e.g., nginx) with metrics exporter</p><p><strong>Logs (systemd):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>journalctl -u matchbox -f
</span></span></code></pre></div><p><strong>Logs (container):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker logs -f matchbox
</span></span></code></pre></div><h3 id=backup-strategy>Backup Strategy</h3><p><strong>What to backup:</strong></p><ol><li><code>/var/lib/matchbox/{groups,profiles,ignition}</code> - Configs</li><li><code>/etc/matchbox/*.{crt,key}</code> - TLS certificates</li><li>Terraform state (if using Terraform provider)</li></ol><p><strong>Backup command:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar -czf matchbox-backup-<span style=color:#204a87;font-weight:700>$(</span>date +%F<span style=color:#204a87;font-weight:700>)</span>.tar.gz <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  /var/lib/matchbox/<span style=color:#ce5c00;font-weight:700>{</span>groups,profiles,ignition<span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  /etc/matchbox
</span></span></code></pre></div><p><strong>Restore:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tar -xzf matchbox-backup-YYYY-MM-DD.tar.gz -C /
</span></span><span style=display:flex><span>sudo chown -R matchbox:matchbox /var/lib/matchbox
</span></span><span style=display:flex><span>sudo systemctl restart matchbox
</span></span></code></pre></div><p><strong>GitOps approach:</strong> Store configs in git repository for versioning and auditability</p><h3 id=updates>Updates</h3><p><strong>Binary deployment:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Download new version</span>
</span></span><span style=display:flex><span>wget https://github.com/poseidon/matchbox/releases/download/vX.Y.Z/matchbox-vX.Y.Z-linux-amd64.tar.gz
</span></span><span style=display:flex><span>tar xzf matchbox-vX.Y.Z-linux-amd64.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Replace binary</span>
</span></span><span style=display:flex><span>sudo systemctl stop matchbox
</span></span><span style=display:flex><span>sudo cp matchbox-vX.Y.Z-linux-amd64/matchbox /usr/local/bin/
</span></span><span style=display:flex><span>sudo systemctl start matchbox
</span></span></code></pre></div><p><strong>Container deployment:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker pull quay.io/poseidon/matchbox:vX.Y.Z
</span></span><span style=display:flex><span>docker stop matchbox
</span></span><span style=display:flex><span>docker rm matchbox
</span></span><span style=display:flex><span>docker run -d --name matchbox ... quay.io/poseidon/matchbox:vX.Y.Z ...
</span></span></code></pre></div><p><strong>Kubernetes deployment:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl <span style=color:#204a87>set</span> image deployment/matchbox <span style=color:#000>matchbox</span><span style=color:#ce5c00;font-weight:700>=</span>quay.io/poseidon/matchbox:vX.Y.Z
</span></span><span style=display:flex><span>kubectl rollout status deployment/matchbox
</span></span></code></pre></div><h3 id=scaling-considerations>Scaling Considerations</h3><p><strong>Vertical scaling (single instance):</strong></p><ul><li>CPU: Minimal (config rendering is lightweight)</li><li>Memory: ~50MB base + asset cache</li><li>Disk: Depends on cached assets (100MB - 10GB+)</li></ul><p><strong>Horizontal scaling (multiple instances):</strong></p><ul><li>Stateless HTTP API (load balance round-robin)</li><li>Shared storage required (RWX PV, NFS, or custom backend)</li><li>gRPC API can be load-balanced with gRPC-aware LB</li></ul><p><strong>Asset serving optimization:</strong></p><ul><li>Use CDN or cache proxy for remote assets</li><li>Local asset caching for &lt;100 machines</li><li>Dedicated HTTP server (nginx) for large deployments (1000+ machines)</li></ul><h3 id=security-best-practices>Security Best Practices</h3><ol><li><p><strong>Don&rsquo;t store secrets in Ignition configs</strong></p><ul><li>Use Ignition <code>files.source</code> with auth headers to fetch from Vault</li><li>Or provision minimal config, fetch secrets post-boot</li></ul></li><li><p><strong>Network segmentation</strong></p><ul><li>Provision VLAN isolated from production</li><li>Firewall rules: only allow provisioning traffic</li></ul></li><li><p><strong>gRPC API access control</strong></p><ul><li>Client cert authentication (mandatory)</li><li>Restrict cert issuance to authorized personnel/systems</li><li>Rotate certs periodically</li></ul></li><li><p><strong>Audit logging</strong></p><ul><li>Version control groups/profiles (git)</li><li>Log gRPC API changes (Terraform state tracking)</li><li>Monitor HTTP endpoint access</li></ul></li><li><p><strong>Validate configs before deployment</strong></p><ul><li><code>fcct --strict</code> for Butane configs</li><li>Terraform plan before apply</li><li>Test in dev environment first</li></ul></li></ol><h2 id=troubleshooting>Troubleshooting</h2><h3 id=common-issues>Common Issues</h3><p><strong>1. Machines not PXE booting:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check DHCP responses</span>
</span></span><span style=display:flex><span>tcpdump -i eth0 port <span style=color:#0000cf;font-weight:700>67</span> and port <span style=color:#0000cf;font-weight:700>68</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Verify TFTP files</span>
</span></span><span style=display:flex><span>ls -la /var/lib/tftpboot/
</span></span><span style=display:flex><span>curl tftp://192.168.1.100/undionly.kpxe
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check Matchbox accessibility</span>
</span></span><span style=display:flex><span>curl http://matchbox.example.com:8080/boot.ipxe
</span></span></code></pre></div><p><strong>2. 404 Not Found on /ignition:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Test group matching</span>
</span></span><span style=display:flex><span>curl <span style=color:#4e9a06>&#39;http://matchbox.example.com:8080/ignition?mac=52:54:00:89:d8:10&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check group exists</span>
</span></span><span style=display:flex><span>ls -la /var/lib/matchbox/groups/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check profile referenced by group exists</span>
</span></span><span style=display:flex><span>ls -la /var/lib/matchbox/profiles/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Verify ignition_id file exists</span>
</span></span><span style=display:flex><span>ls -la /var/lib/matchbox/ignition/
</span></span></code></pre></div><p><strong>3. gRPC connection refused (Terraform):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Test TLS connection</span>
</span></span><span style=display:flex><span>openssl s_client -connect matchbox.example.com:8081 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -CAfile ~/.matchbox/ca.crt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -cert ~/.matchbox/client.crt <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -key ~/.matchbox/client.key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check Matchbox gRPC is listening</span>
</span></span><span style=display:flex><span>sudo ss -tlnp <span style=color:#000;font-weight:700>|</span> grep <span style=color:#0000cf;font-weight:700>8081</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Verify firewall</span>
</span></span><span style=display:flex><span>sudo firewall-cmd --list-ports
</span></span></code></pre></div><p><strong>4. Ignition config validation errors:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Validate Butane locally</span>
</span></span><span style=display:flex><span>podman run -i --rm quay.io/coreos/fcct:release --strict &lt; config.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Fetch rendered Ignition</span>
</span></span><span style=display:flex><span>curl <span style=color:#4e9a06>&#39;http://matchbox.example.com:8080/ignition?mac=...&#39;</span> <span style=color:#000;font-weight:700>|</span> jq .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Validate Ignition spec</span>
</span></span><span style=display:flex><span>curl <span style=color:#4e9a06>&#39;http://matchbox.example.com:8080/ignition?mac=...&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  podman run -i --rm quay.io/coreos/ignition-validate:latest
</span></span></code></pre></div><h2 id=summary>Summary</h2><p>Matchbox deployment considerations:</p><ul><li><strong>Architecture:</strong> Single-host (dev/lab) vs HA (production) vs Kubernetes</li><li><strong>Installation:</strong> Binary (systemd), container (Docker/Podman), or Kubernetes manifests</li><li><strong>Network boot:</strong> dnsmasq container (quick), existing infrastructure (enterprise), or iPXE-only (modern)</li><li><strong>TLS:</strong> Self-signed (dev), corporate PKI (production), Let&rsquo;s Encrypt (HTTP only)</li><li><strong>Scaling:</strong> Vertical (simple) vs horizontal (requires shared storage)</li><li><strong>Security:</strong> Client cert auth, network segmentation, no secrets in configs</li><li><strong>Operations:</strong> Backup configs, GitOps workflow, monitoring/logging</li></ul><p><strong>Recommendation for production:</strong></p><ul><li>HA deployment (2+ instances) with load balancer</li><li>Shared storage (NFS or RWX PV on Kubernetes)</li><li>Corporate PKI for TLS certificates</li><li>GitOps workflow (Terraform + git-controlled configs)</li><li>Network segmentation (dedicated provisioning VLAN)</li><li>Prometheus/Grafana monitoring</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-62ea704f9d07efc4c09282944f58f495>3 - Network Boot Support</h1><div class=lead>Detailed analysis of Matchbox&rsquo;s network boot capabilities</div><h1 id=network-boot-support-in-matchbox>Network Boot Support in Matchbox</h1><p>Matchbox provides comprehensive network boot support for bare-metal provisioning, supporting multiple boot firmware types and protocols.</p><h2 id=overview>Overview</h2><p>Matchbox serves as an HTTP entrypoint for network-booted machines but <strong>does not implement DHCP, TFTP, or DNS services itself</strong>. Instead, it integrates with existing network infrastructure (or companion services like dnsmasq) to provide a complete PXE boot solution.</p><h2 id=boot-protocol-support>Boot Protocol Support</h2><h3 id=1-pxe-preboot-execution-environment>1. PXE (Preboot Execution Environment)</h3><p><strong>Legacy BIOS support via chainloading to iPXE:</strong></p><pre tabindex=0><code>Machine BIOS → DHCP (gets TFTP server) → TFTP (gets undionly.kpxe) 
→ iPXE firmware → HTTP (Matchbox /boot.ipxe)
</code></pre><p><strong>Key characteristics:</strong></p><ul><li>Requires TFTP server to serve <code>undionly.kpxe</code> (iPXE bootloader)</li><li>Chainloads from legacy PXE ROM to modern iPXE</li><li>Supports older hardware with basic PXE firmware</li><li>TFTP only used for initial iPXE bootstrap; subsequent downloads via HTTP</li></ul><h3 id=2-ipxe-enhanced-pxe>2. iPXE (Enhanced PXE)</h3><p><strong>Primary boot method supported by Matchbox:</strong></p><pre tabindex=0><code>iPXE Client → DHCP (gets boot script URL) → HTTP (Matchbox endpoints)
→ Kernel/initrd download → Boot with Ignition config
</code></pre><p><strong>Endpoints served by Matchbox:</strong></p><table><thead><tr><th>Endpoint</th><th>Purpose</th></tr></thead><tbody><tr><td><code>/boot.ipxe</code></td><td>Static script that gathers machine attributes (UUID, MAC, hostname, serial)</td></tr><tr><td><code>/ipxe?&lt;labels></code></td><td>Rendered iPXE script with kernel, initrd, and boot args for matched machine</td></tr><tr><td><code>/assets/</code></td><td>Optional local caching of kernel/initrd images</td></tr></tbody></table><p><strong>Example iPXE flow:</strong></p><ol><li>Machine boots with iPXE firmware</li><li>DHCP response points to <code>http://matchbox.example.com:8080/boot.ipxe</code></li><li>iPXE fetches <code>/boot.ipxe</code>:<pre tabindex=0><code>#!ipxe
chain ipxe?uuid=${uuid}&amp;mac=${mac:hexhyp}&amp;domain=${domain}&amp;hostname=${hostname}&amp;serial=${serial}
</code></pre></li><li>iPXE makes request to <code>/ipxe?uuid=...&amp;mac=...</code> with machine attributes</li><li>Matchbox matches machine to group/profile and renders iPXE script:<pre tabindex=0><code>#!ipxe
kernel /assets/coreos/VERSION/coreos_production_pxe.vmlinuz \
  coreos.config.url=http://matchbox.foo:8080/ignition?uuid=${uuid}&amp;mac=${mac:hexhyp} \
  coreos.first_boot=1
initrd /assets/coreos/VERSION/coreos_production_pxe_image.cpio.gz
boot
</code></pre></li></ol><p><strong>Advantages:</strong></p><ul><li>HTTP downloads (faster than TFTP)</li><li>Scriptable boot logic</li><li>Can fetch configs from HTTP endpoints</li><li>Supports HTTPS (if compiled with TLS support)</li></ul><h3 id=3-grub2>3. GRUB2</h3><p><strong>UEFI firmware support:</strong></p><pre tabindex=0><code>UEFI Firmware → DHCP (gets GRUB bootloader) → TFTP (grub.efi)
→ GRUB → HTTP (Matchbox /grub endpoint)
</code></pre><p><strong>Matchbox endpoint:</strong> <code>/grub?&lt;labels></code></p><p><strong>Example GRUB config rendered by Matchbox:</strong></p><pre tabindex=0><code>default=0
timeout=1
menuentry &#34;CoreOS&#34; {
  echo &#34;Loading kernel&#34;
  linuxefi &#34;(http;matchbox.foo:8080)/assets/coreos/VERSION/coreos_production_pxe.vmlinuz&#34; \
    &#34;coreos.config.url=http://matchbox.foo:8080/ignition&#34; &#34;coreos.first_boot&#34;
  echo &#34;Loading initrd&#34;
  initrdefi &#34;(http;matchbox.foo:8080)/assets/coreos/VERSION/coreos_production_pxe_image.cpio.gz&#34;
}
</code></pre><p><strong>Use case:</strong></p><ul><li>UEFI systems that prefer GRUB over iPXE</li><li>Environments with existing GRUB network boot infrastructure</li></ul><h3 id=4-pxelinux-legacy-via-tftp>4. PXELINUX (Legacy, via TFTP)</h3><p>While not a primary Matchbox target, PXELINUX clients can be configured to chainload iPXE:</p><pre tabindex=0><code># /var/lib/tftpboot/pxelinux.cfg/default
timeout 10
default iPXE
LABEL iPXE
KERNEL ipxe.lkrn
APPEND dhcp &amp;&amp; chain http://matchbox.example.com:8080/boot.ipxe
</code></pre><h2 id=dhcp-configuration-patterns>DHCP Configuration Patterns</h2><p>Matchbox supports two DHCP deployment models:</p><h3 id=pattern-1-pxe-enabled-dhcp>Pattern 1: PXE-Enabled DHCP</h3><p>Full DHCP server provides IP allocation + PXE boot options.</p><p><strong>Example dnsmasq configuration:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#c4a000>dhcp-range</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>192.168.1.1,192.168.1.254,30m</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>enable-tftp</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>tftp-root</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/var/lib/tftpboot</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Legacy BIOS → chainload to iPXE</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dhcp-match</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>set:bios,option:client-arch,0</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dhcp-boot</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>tag:bios,undionly.kpxe</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># UEFI → iPXE</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dhcp-match</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>set:efi32,option:client-arch,6</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dhcp-boot</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>tag:efi32,ipxe.efi</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dhcp-match</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>set:efi64,option:client-arch,9</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dhcp-boot</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>tag:efi64,ipxe.efi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># iPXE clients → Matchbox</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dhcp-userclass</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>set:ipxe,iPXE</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dhcp-boot</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>tag:ipxe,http://matchbox.example.com:8080/boot.ipxe</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># DNS for Matchbox</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>address</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/matchbox.example.com/192.168.1.100</span>
</span></span></code></pre></div><p><strong>Client architecture detection:</strong></p><ul><li>Option 93 (<code>client-arch</code>): Identifies BIOS (0), UEFI32 (6), UEFI64 (9)</li><li>User class: Detects iPXE clients to skip TFTP chainloading</li></ul><h3 id=pattern-2-proxy-dhcp>Pattern 2: Proxy DHCP</h3><p>Runs alongside existing DHCP server; provides only boot options (no IP allocation).</p><p><strong>Example dnsmasq proxy-DHCP:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#c4a000>dhcp-range</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>192.168.1.1,proxy,255.255.255.0</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>enable-tftp</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>tftp-root</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/var/lib/tftpboot</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Chainload legacy PXE to iPXE</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>pxe-service</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>tag:#ipxe,x86PC,&#34;PXE chainload to iPXE&#34;,undionly.kpxe</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># iPXE clients → Matchbox</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>dhcp-userclass</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>set:ipxe,iPXE</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>pxe-service</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>tag:ipxe,x86PC,&#34;iPXE&#34;,http://matchbox.example.com:8080/boot.ipxe</span>
</span></span></code></pre></div><p><strong>Benefits:</strong></p><ul><li>Non-invasive: doesn&rsquo;t replace existing DHCP</li><li>PXE clients receive merged responses from both DHCP servers</li><li>Ideal for environments where main DHCP cannot be modified</li></ul><h2 id=network-boot-flow-complete>Network Boot Flow (Complete)</h2><h3 id=scenario-bios-machine-with-legacy-pxe-firmware>Scenario: BIOS machine with legacy PXE firmware</h3><pre tabindex=0><code>┌──────────────────────────────────────────────────────────────────┐
│ 1. Machine powers on, BIOS set to network boot                  │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 2. NIC PXE firmware broadcasts DHCPDISCOVER (PXEClient)          │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 3. DHCP/proxyDHCP responds with:                                 │
│    - IP address (if full DHCP)                                   │
│    - Next-server: TFTP server IP                                 │
│    - Filename: undionly.kpxe (based on arch=0)                   │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 4. PXE firmware downloads undionly.kpxe via TFTP                 │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 5. Execute iPXE (undionly.kpxe)                                  │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 6. iPXE requests DHCP again, identifies as iPXE (user-class)     │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 7. DHCP responds with boot URL (not TFTP):                       │
│    http://matchbox.example.com:8080/boot.ipxe                    │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 8. iPXE fetches /boot.ipxe via HTTP:                             │
│    #!ipxe                                                        │
│    chain ipxe?uuid=${uuid}&amp;mac=${mac:hexhyp}&amp;...                 │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 9. iPXE chains to /ipxe?uuid=XXX&amp;mac=YYY (introspected labels)   │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 10. Matchbox matches machine to group/profile                    │
│     - Finds most specific group matching labels                  │
│     - Retrieves profile (kernel, initrd, args, configs)          │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 11. Matchbox renders iPXE script with:                           │
│     - kernel URL (local asset or remote HTTPS)                   │
│     - initrd URL                                                 │
│     - kernel args (including ignition.config.url)                │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 12. iPXE downloads kernel + initrd (HTTP/HTTPS)                  │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 13. iPXE boots kernel with specified args                        │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 14. Fedora CoreOS/Flatcar boots, Ignition runs                   │
│     - Fetches /ignition?uuid=XXX&amp;mac=YYY from Matchbox           │
│     - Matchbox renders Ignition config with group metadata       │
│     - Ignition partitions disk, writes files, creates users      │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│ 15. System reboots (if disk install), boots from disk            │
└──────────────────────────────────────────────────────────────────┘
</code></pre><h2 id=asset-serving>Asset Serving</h2><p>Matchbox can serve static assets (kernel, initrd images) from a local directory to reduce bandwidth and increase speed:</p><p><strong>Asset directory structure:</strong></p><pre tabindex=0><code>/var/lib/matchbox/assets/
├── fedora-coreos/
│   └── 36.20220906.3.2/
│       ├── fedora-coreos-36.20220906.3.2-live-kernel-x86_64
│       ├── fedora-coreos-36.20220906.3.2-live-initramfs.x86_64.img
│       └── fedora-coreos-36.20220906.3.2-live-rootfs.x86_64.img
└── flatcar/
    └── 3227.2.0/
        ├── flatcar_production_pxe.vmlinuz
        ├── flatcar_production_pxe_image.cpio.gz
        └── version.txt
</code></pre><p><strong>HTTP endpoint:</strong> <code>http://matchbox.example.com:8080/assets/</code></p><p><strong>Scripts provided:</strong></p><ul><li><code>scripts/get-fedora-coreos</code> - Download/verify Fedora CoreOS images</li><li><code>scripts/get-flatcar</code> - Download/verify Flatcar Linux images</li></ul><p><strong>Profile reference:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;boot&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;kernel&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;/assets/fedora-coreos/36.20220906.3.2/fedora-coreos-36.20220906.3.2-live-kernel-x86_64&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;initrd&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;--name main /assets/fedora-coreos/36.20220906.3.2/fedora-coreos-36.20220906.3.2-live-initramfs.x86_64.img&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Alternative:</strong> Profiles can reference remote HTTPS URLs (requires iPXE compiled with TLS support):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;kernel&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/36.20220906.3.2/x86_64/fedora-coreos-36.20220906.3.2-live-kernel-x86_64&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=os-support>OS Support</h2><h3 id=fedora-coreos>Fedora CoreOS</h3><p><strong>Boot types:</strong></p><ol><li><strong>Live PXE</strong> (RAM-only, ephemeral)</li><li><strong>Install to disk</strong> (persistent, recommended)</li></ol><p><strong>Required kernel args:</strong></p><ul><li><code>coreos.inst.install_dev=/dev/sda</code> - Target disk for install</li><li><code>coreos.inst.ignition_url=http://matchbox/ignition?uuid=${uuid}&amp;mac=${mac:hexhyp}</code> - Provisioning config</li><li><code>coreos.live.rootfs_url=...</code> - Root filesystem image</li></ul><p><strong>Ignition fetch:</strong> During first boot, <code>ignition.service</code> fetches config from Matchbox</p><h3 id=flatcar-linux>Flatcar Linux</h3><p><strong>Boot types:</strong></p><ol><li><strong>Live PXE</strong> (RAM-only)</li><li><strong>Install to disk</strong></li></ol><p><strong>Required kernel args:</strong></p><ul><li><code>flatcar.first_boot=yes</code> - Marks first boot</li><li><code>flatcar.config.url=http://matchbox/ignition?uuid=${uuid}&amp;mac=${mac:hexhyp}</code> - Ignition config URL</li><li><code>flatcar.autologin</code> - Auto-login to console (optional, dev/debug)</li></ul><p><strong>Ignition support:</strong> Flatcar uses Ignition v3.x for provisioning</p><h3 id=rhel-coreos>RHEL CoreOS</h3><p>Supported as it uses Ignition like Fedora CoreOS. Requires Red Hat-specific image sources.</p><h2 id=machine-matching--labels>Machine Matching & Labels</h2><p>Matchbox matches machines to profiles using labels extracted during boot:</p><h3 id=reserved-label-selectors>Reserved Label Selectors</h3><table><thead><tr><th>Label</th><th>Source</th><th>Example</th><th>Normalized</th></tr></thead><tbody><tr><td><code>uuid</code></td><td>SMBIOS UUID</td><td><code>550e8400-e29b-41d4-a716-446655440000</code></td><td>Lowercase</td></tr><tr><td><code>mac</code></td><td>NIC MAC address</td><td><code>52:54:00:89:d8:10</code></td><td>Normalized to colons</td></tr><tr><td><code>hostname</code></td><td>Network boot program</td><td><code>node1.example.com</code></td><td>As-is</td></tr><tr><td><code>serial</code></td><td>Hardware serial</td><td><code>VMware-42 1a...</code></td><td>As-is</td></tr></tbody></table><h3 id=custom-labels>Custom Labels</h3><p>Groups can match on arbitrary labels passed as query params:</p><pre tabindex=0><code>/ipxe?mac=52:54:00:89:d8:10&amp;region=us-west&amp;env=prod
</code></pre><p><strong>Matching precedence:</strong> Most specific group wins (most selector matches)</p><h2 id=firmware-compatibility>Firmware Compatibility</h2><table><thead><tr><th>Firmware Type</th><th>Client Arch</th><th>Boot File</th><th>Protocol</th><th>Matchbox Support</th></tr></thead><tbody><tr><td>BIOS (legacy PXE)</td><td>0</td><td><code>undionly.kpxe</code> → iPXE</td><td>TFTP → HTTP</td><td>✅ Via chainload</td></tr><tr><td>UEFI 32-bit</td><td>6</td><td><code>ipxe.efi</code></td><td>TFTP → HTTP</td><td>✅</td></tr><tr><td>UEFI (BIOS compat)</td><td>7</td><td><code>ipxe.efi</code></td><td>TFTP → HTTP</td><td>✅</td></tr><tr><td>UEFI 64-bit</td><td>9</td><td><code>ipxe.efi</code></td><td>TFTP → HTTP</td><td>✅</td></tr><tr><td>Native iPXE</td><td>-</td><td>N/A</td><td>HTTP</td><td>✅ Direct</td></tr><tr><td>GRUB (UEFI)</td><td>-</td><td><code>grub.efi</code></td><td>TFTP → HTTP</td><td>✅ <code>/grub</code> endpoint</td></tr></tbody></table><h2 id=network-requirements>Network Requirements</h2><p><strong>Firewall rules on Matchbox host:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># HTTP API (read-only)</span>
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#ce5c00;font-weight:700>=</span>8080/tcp --permanent
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># gRPC API (authenticated, Terraform)</span>
</span></span><span style=display:flex><span>firewall-cmd --add-port<span style=color:#ce5c00;font-weight:700>=</span>8081/tcp --permanent
</span></span></code></pre></div><p><strong>DNS requirement:</strong></p><ul><li><code>matchbox.example.com</code> must resolve to Matchbox server IP</li><li>Can be configured in dnsmasq, corporate DNS, or <code>/etc/hosts</code> on DHCP server</li></ul><p><strong>DHCP/TFTP host (if using dnsmasq):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>firewall-cmd --add-service<span style=color:#ce5c00;font-weight:700>=</span>dhcp --permanent
</span></span><span style=display:flex><span>firewall-cmd --add-service<span style=color:#ce5c00;font-weight:700>=</span>tftp --permanent
</span></span><span style=display:flex><span>firewall-cmd --add-service<span style=color:#ce5c00;font-weight:700>=</span>dns --permanent  <span style=color:#8f5902;font-style:italic># optional</span>
</span></span></code></pre></div><h2 id=troubleshooting-tips>Troubleshooting Tips</h2><ol><li><p><strong>Verify Matchbox endpoints:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://matchbox.example.com:8080
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Should return: matchbox</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl http://matchbox.example.com:8080/boot.ipxe
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Should return iPXE script</span>
</span></span></code></pre></div></li><li><p><strong>Test machine matching:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#4e9a06>&#39;http://matchbox.example.com:8080/ipxe?mac=52:54:00:89:d8:10&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Should return rendered iPXE script with kernel/initrd</span>
</span></span></code></pre></div></li><li><p><strong>Check TFTP files:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls -la /var/lib/tftpboot/
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Should contain: undionly.kpxe, ipxe.efi, grub.efi</span>
</span></span></code></pre></div></li><li><p><strong>Verify DHCP responses:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tcpdump -i eth0 -n port <span style=color:#0000cf;font-weight:700>67</span> and port <span style=color:#0000cf;font-weight:700>68</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Watch for DHCP offers with PXE options</span>
</span></span></code></pre></div></li><li><p><strong>iPXE console debugging:</strong></p><ul><li>Press Ctrl+B during iPXE boot to enter console</li><li>Commands: <code>dhcp</code>, <code>ifstat</code>, <code>show net0/ip</code>, <code>chain http://...</code></li></ul></li></ol><h2 id=limitations>Limitations</h2><ol><li><strong>HTTPS support:</strong> iPXE must be compiled with crypto support (larger binary, ~80KB vs ~45KB)</li><li><strong>TFTP dependency:</strong> Legacy PXE requires TFTP for initial chainload (can&rsquo;t skip)</li><li><strong>No DHCP/TFTP built-in:</strong> Must use external services or dnsmasq container</li><li><strong>Boot firmware variations:</strong> Some vendor PXE implementations have quirks</li><li><strong>SecureBoot:</strong> iPXE and GRUB must be signed (or SecureBoot disabled)</li></ol><h2 id=reference-implementation-dnsmasq-container>Reference Implementation: dnsmasq Container</h2><p>Matchbox project provides <code>quay.io/poseidon/dnsmasq</code> with:</p><ul><li>Pre-configured DHCP/TFTP/DNS service</li><li>Bundled <code>ipxe.efi</code>, <code>undionly.kpxe</code>, <code>grub.efi</code></li><li>Example configs for PXE-DHCP and proxy-DHCP modes</li></ul><p><strong>Quick start (full DHCP):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm --cap-add<span style=color:#ce5c00;font-weight:700>=</span>NET_ADMIN --net<span style=color:#ce5c00;font-weight:700>=</span>host quay.io/poseidon/dnsmasq <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -d -q <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-range<span style=color:#ce5c00;font-weight:700>=</span>192.168.1.3,192.168.1.254 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --enable-tftp --tftp-root<span style=color:#ce5c00;font-weight:700>=</span>/var/lib/tftpboot <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-match<span style=color:#ce5c00;font-weight:700>=</span>set:bios,option:client-arch,0 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-boot<span style=color:#ce5c00;font-weight:700>=</span>tag:bios,undionly.kpxe <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-match<span style=color:#ce5c00;font-weight:700>=</span>set:efi64,option:client-arch,9 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-boot<span style=color:#ce5c00;font-weight:700>=</span>tag:efi64,ipxe.efi <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-userclass<span style=color:#ce5c00;font-weight:700>=</span>set:ipxe,iPXE <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-boot<span style=color:#ce5c00;font-weight:700>=</span>tag:ipxe,http://matchbox.example.com:8080/boot.ipxe <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --address<span style=color:#ce5c00;font-weight:700>=</span>/matchbox.example.com/192.168.1.2 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --log-queries --log-dhcp
</span></span></code></pre></div><p><strong>Quick start (proxy-DHCP):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm --cap-add<span style=color:#ce5c00;font-weight:700>=</span>NET_ADMIN --net<span style=color:#ce5c00;font-weight:700>=</span>host quay.io/poseidon/dnsmasq <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -d -q <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-range<span style=color:#ce5c00;font-weight:700>=</span>192.168.1.1,proxy,255.255.255.0 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --enable-tftp --tftp-root<span style=color:#ce5c00;font-weight:700>=</span>/var/lib/tftpboot <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --dhcp-userclass<span style=color:#ce5c00;font-weight:700>=</span>set:ipxe,iPXE <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --pxe-service<span style=color:#ce5c00;font-weight:700>=</span>tag:#ipxe,x86PC,<span style=color:#4e9a06>&#34;PXE chainload to iPXE&#34;</span>,undionly.kpxe <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --pxe-service<span style=color:#ce5c00;font-weight:700>=</span>tag:ipxe,x86PC,<span style=color:#4e9a06>&#34;iPXE&#34;</span>,http://matchbox.example.com:8080/boot.ipxe <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --log-queries --log-dhcp
</span></span></code></pre></div><h2 id=summary>Summary</h2><p>Matchbox provides robust network boot support through:</p><ul><li><strong>Protocol flexibility:</strong> iPXE (primary), GRUB2, legacy PXE (via chainload)</li><li><strong>Firmware compatibility:</strong> BIOS and UEFI</li><li><strong>Modern approach:</strong> HTTP-based with optional local asset caching</li><li><strong>Clean separation:</strong> Matchbox handles config rendering; external services handle DHCP/TFTP</li><li><strong>Production-ready:</strong> Used by Typhoon Kubernetes distributions for bare-metal provisioning</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-177196d5d574619d0c7d1eb930af7a44>4 - Use Case Evaluation</h1><div class=lead>Evaluation of Matchbox for specific use cases and comparison with alternatives</div><h1 id=matchbox-use-case-evaluation>Matchbox Use Case Evaluation</h1><p>Analysis of Matchbox&rsquo;s suitability for various use cases, strengths, limitations, and comparison with alternative provisioning solutions.</p><h2 id=use-case-fit-analysis>Use Case Fit Analysis</h2><h3 id=-ideal-use-cases>✅ Ideal Use Cases</h3><h4 id=1-bare-metal-kubernetes-clusters>1. Bare-Metal Kubernetes Clusters</h4><p><strong>Scenario:</strong> Provisioning 10-1000 physical servers for Kubernetes nodes</p><p><strong>Why Matchbox Excels:</strong></p><ul><li>Ignition-native (perfect for Fedora CoreOS/Flatcar)</li><li>Declarative machine provisioning via Terraform</li><li>Label-based matching (region, role, hardware type)</li><li>Integration with Typhoon Kubernetes distribution</li><li>Minimal OS surface (immutable, container-optimized)</li></ul><p><strong>Example workflow:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=display:flex><span><span style=color:#204a87;font-weight:700>resource</span> <span style=color:#4e9a06>&#34;matchbox_profile&#34; &#34;k8s_controller&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  name</span>   <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;k8s-controller&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  kernel</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/assets/fedora-coreos/.../kernel&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>  raw_ignition</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>ct_config</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>controller</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>rendered</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>resource</span> <span style=color:#4e9a06>&#34;matchbox_group&#34; &#34;controllers&#34;</span> {
</span></span><span style=display:flex><span><span style=color:#000>  profile</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>matchbox_profile</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>k8s_controller</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>name</span>
</span></span><span style=display:flex><span><span style=color:#000>  selector</span> <span style=color:#ce5c00;font-weight:700>=</span> {
</span></span><span style=display:flex><span><span style=color:#000>    role</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;controller&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Alternatives considered:</strong></p><ul><li><strong>Cloud-init + netboot.xyz</strong>: Less declarative, no native Ignition support</li><li><strong>Foreman</strong>: Heavier, more complex for container-centric workloads</li><li><strong>Metal³</strong>: Kubernetes-native but requires existing cluster</li></ul><p><strong>Verdict:</strong> ⭐⭐⭐⭐⭐ Matchbox is purpose-built for this</p><hr><h4 id=2-labdevelopment-environments>2. Lab/Development Environments</h4><p><strong>Scenario:</strong> Rapid PXE boot testing with QEMU/KVM VMs or homelab servers</p><p><strong>Why Matchbox Excels:</strong></p><ul><li>Quick setup (binary + dnsmasq container)</li><li>No DHCP infrastructure required (proxy-DHCP mode)</li><li>Localhost deployment (no external dependencies)</li><li>Fast iteration (change configs, re-PXE)</li><li>Included examples and scripts</li></ul><p><strong>Example setup:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Start Matchbox locally</span>
</span></span><span style=display:flex><span>docker run -d --net<span style=color:#ce5c00;font-weight:700>=</span>host -v /var/lib/matchbox:/var/lib/matchbox <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  quay.io/poseidon/matchbox:latest -address<span style=color:#ce5c00;font-weight:700>=</span>0.0.0.0:8080
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Start dnsmasq on same host</span>
</span></span><span style=display:flex><span>docker run -d --net<span style=color:#ce5c00;font-weight:700>=</span>host --cap-add<span style=color:#ce5c00;font-weight:700>=</span>NET_ADMIN <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  quay.io/poseidon/dnsmasq ...
</span></span></code></pre></div><p><strong>Alternatives considered:</strong></p><ul><li><strong>netboot.xyz</strong>: Great for manual OS selection, no automation</li><li><strong>PiXE server</strong>: Simpler but less flexible matching logic</li><li><strong>Manual iPXE scripts</strong>: No dynamic matching, manual maintenance</li></ul><p><strong>Verdict:</strong> ⭐⭐⭐⭐⭐ Minimal setup, maximum flexibility</p><hr><h4 id=3-edgeremote-site-provisioning>3. Edge/Remote Site Provisioning</h4><p><strong>Scenario:</strong> Provision machines at 10+ remote datacenters or edge locations</p><p><strong>Why Matchbox Excels:</strong></p><ul><li>Lightweight (single binary, ~20MB)</li><li>Declarative region-based matching</li><li>Centralized config management (Terraform)</li><li>Can run on minimal hardware (ARM support)</li><li>HTTP-based (works over WAN with reverse proxy)</li></ul><p><strong>Architecture:</strong></p><pre tabindex=0><code>Central Matchbox (via Terraform)
  ↓ gRPC API
Regional Matchbox Instances (read-only cache)
  ↓ HTTP
Edge Machines (PXE boot)
</code></pre><p><strong>Label-based routing:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;selector&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;region&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;us-west&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;site&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;pdx-1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;metadata&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;ntp_servers&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;10.100.1.1&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;10.100.1.2&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>Alternatives considered:</strong></p><ul><li><strong>Foreman</strong>: Requires more resources per site</li><li><strong>Ansible + netboot</strong>: No declarative PXE boot, post-install only</li><li><strong>Cloud-init datasources</strong>: Requires cloud metadata service per site</li></ul><p><strong>Verdict:</strong> ⭐⭐⭐⭐☆ Good fit, but consider caching strategy for WAN</p><hr><h3 id=-moderate-fit-use-cases>⚠️ Moderate Fit Use Cases</h3><h4 id=4-multi-tenant-bare-metal-cloud>4. Multi-Tenant Bare-Metal Cloud</h4><p><strong>Scenario:</strong> Provide bare-metal-as-a-service to multiple customers</p><p><strong>Matchbox challenges:</strong></p><ul><li>No built-in multi-tenancy (single namespace)</li><li>No RBAC (gRPC API is all-or-nothing with client certs)</li><li>No customer self-service portal</li></ul><p><strong>Workarounds:</strong></p><ul><li>Deploy separate Matchbox per tenant (isolation via separate instances)</li><li>Proxy gRPC API with custom RBAC layer</li><li>Use group selectors with customer IDs</li></ul><p><strong>Better alternatives:</strong></p><ul><li><strong>Metal³</strong> (Kubernetes-native, better multi-tenancy)</li><li><strong>OpenStack Ironic</strong> (purpose-built for bare-metal cloud)</li><li><strong>MAAS</strong> (Ubuntu-specific, has RBAC)</li></ul><p><strong>Verdict:</strong> ⭐⭐☆☆☆ Possible but architecturally challenging</p><hr><h4 id=5-heterogeneous-os-provisioning>5. Heterogeneous OS Provisioning</h4><p><strong>Scenario:</strong> Need to provision Fedora CoreOS, Ubuntu, RHEL, Windows</p><p><strong>Matchbox challenges:</strong></p><ul><li>Designed for Ignition-based OSes (FCOS, Flatcar, RHCOS)</li><li>No native support for Kickstart (RHEL/CentOS)</li><li>No support for Preseed (Ubuntu/Debian)</li><li>No Windows unattend.xml support</li></ul><p><strong>What works:</strong></p><ul><li>Fedora CoreOS ✅</li><li>Flatcar Linux ✅</li><li>RHEL CoreOS ✅</li><li>Container Linux (deprecated but supported) ✅</li></ul><p><strong>What requires workarounds:</strong></p><ul><li>RHEL/CentOS: Possible via generic configs + Kickstart URLs, but not native</li><li>Ubuntu: Can PXE boot and point to autoinstall ISO, but loses Matchbox templating benefits</li><li>Debian: Similar to Ubuntu</li><li>Windows: Not supported (different PXE boot mechanisms)</li></ul><p><strong>Better alternatives for heterogeneous environments:</strong></p><ul><li><strong>Foreman</strong> (supports Kickstart, Preseed, unattend.xml)</li><li><strong>MAAS</strong> (Ubuntu-centric but extensible)</li><li><strong>Cobbler</strong> (older but supports many OS types)</li></ul><p><strong>Verdict:</strong> ⭐⭐☆☆☆ Stick to Ignition-based OSes or use different tool</p><hr><h3 id=-poor-fit-use-cases>❌ Poor Fit Use Cases</h3><h4 id=6-windows-pxe-boot>6. Windows PXE Boot</h4><p><strong>Why Matchbox doesn&rsquo;t fit:</strong></p><ul><li>No WinPE support</li><li>No unattend.xml rendering</li><li>Different PXE boot chain (WDS/SCCM model)</li></ul><p><strong>Recommendation:</strong> Use Microsoft WDS or SCCM</p><p><strong>Verdict:</strong> ⭐☆☆☆☆ Not designed for this</p><hr><h4 id=7-biosfirmware-updates>7. BIOS/Firmware Updates</h4><p><strong>Why Matchbox doesn&rsquo;t fit:</strong></p><ul><li>Focused on OS provisioning, not firmware</li><li>No vendor-specific tooling (Dell iDRAC, HP iLO integration)</li></ul><p><strong>Recommendation:</strong> Use vendor tools or Ansible with ipmi/redfish modules</p><p><strong>Verdict:</strong> ⭐☆☆☆☆ Out of scope</p><hr><h2 id=strengths>Strengths</h2><h3 id=1-ignition-first-design>1. Ignition-First Design</h3><ul><li>Native support for modern immutable OSes</li><li>Declarative, atomic provisioning (no config drift)</li><li>First-boot partition/filesystem setup</li></ul><h3 id=2-label-based-matching>2. Label-Based Matching</h3><ul><li>Flexible machine classification (MAC, UUID, region, role, custom)</li><li>Most-specific-match algorithm (override defaults per machine)</li><li>Query params for dynamic attributes</li></ul><h3 id=3-terraform-integration>3. Terraform Integration</h3><ul><li>Declarative infrastructure as code</li><li>Plan before apply (preview changes)</li><li>State tracking for auditability</li><li>Rich templating (ct_config provider for Butane)</li></ul><h3 id=4-minimal-dependencies>4. Minimal Dependencies</h3><ul><li>Single static binary (~20MB)</li><li>No database required (FileStore default)</li><li>No built-in DHCP/TFTP (separation of concerns)</li><li>Container-ready (OCI image available)</li></ul><h3 id=5-http-centric>5. HTTP-Centric</h3><ul><li>Faster downloads than TFTP (iPXE via HTTP)</li><li>Proxy/CDN friendly for asset distribution</li><li>Standard web tooling (curl, load balancers, Ingress)</li></ul><h3 id=6-production-ready>6. Production-Ready</h3><ul><li>Used by Typhoon Kubernetes (battle-tested)</li><li>Clear upgrade path (SemVer releases)</li><li>OpenPGP signature support for config integrity</li></ul><h2 id=limitations>Limitations</h2><h3 id=1-no-multi-tenancy>1. No Multi-Tenancy</h3><ul><li>Single namespace (all groups/profiles global)</li><li>No RBAC on gRPC API (client cert = full access)</li><li>Requires separate instances per tenant</li></ul><h3 id=2-ignition-only-focus>2. Ignition-Only Focus</h3><ul><li>Cloud-Config deprecated (legacy support only)</li><li>No native Kickstart/Preseed/unattend.xml</li><li>Limits OS choice to CoreOS family</li></ul><h3 id=3-storage-constraints>3. Storage Constraints</h3><ul><li>FileStore doesn&rsquo;t scale to 10,000+ profiles</li><li>No built-in HA storage (requires NFS or custom backend)</li><li>Kubernetes deployment needs RWX PersistentVolume</li></ul><h3 id=4-no-machine-discovery>4. No Machine Discovery</h3><ul><li>Doesn&rsquo;t detect new machines (passive service)</li><li>No inventory management (use external CMDB)</li><li>No hardware introspection (use Ironic for that)</li></ul><h3 id=5-limited-observability>5. Limited Observability</h3><ul><li>No built-in metrics (Prometheus integration requires reverse proxy)</li><li>Logs are minimal (request logging only)</li><li>No audit trail for gRPC API changes (use Terraform state)</li></ul><h3 id=6-tftp-still-required>6. TFTP Still Required</h3><ul><li>Legacy BIOS PXE needs TFTP for chainloading to iPXE</li><li>Can&rsquo;t fully eliminate TFTP unless all machines have native iPXE</li></ul><h2 id=comparison-with-alternatives>Comparison with Alternatives</h2><h3 id=vs-foreman>vs. Foreman</h3><table><thead><tr><th>Feature</th><th>Matchbox</th><th>Foreman</th></tr></thead><tbody><tr><td><strong>OS Support</strong></td><td>Ignition-based</td><td>Kickstart, Preseed, AutoYaST, etc.</td></tr><tr><td><strong>Complexity</strong></td><td>Low (single binary)</td><td>High (Rails app, DB, Puppet/Ansible)</td></tr><tr><td><strong>Config Model</strong></td><td>Declarative (Ignition)</td><td>Imperative (post-install scripts)</td></tr><tr><td><strong>API</strong></td><td>HTTP + gRPC</td><td>REST API</td></tr><tr><td><strong>UI</strong></td><td>None (API-only)</td><td>Full web UI</td></tr><tr><td><strong>Terraform</strong></td><td>Native provider</td><td>Community modules</td></tr><tr><td><strong>Use Case</strong></td><td>Container-centric infra</td><td>Traditional Linux servers</td></tr></tbody></table><p><strong>When to choose Matchbox:</strong> CoreOS-based Kubernetes clusters, minimal infrastructure<br><strong>When to choose Foreman:</strong> Heterogeneous OS, need web UI, traditional config mgmt</p><hr><h3 id=vs-metal>vs. Metal³</h3><table><thead><tr><th>Feature</th><th>Matchbox</th><th>Metal³</th></tr></thead><tbody><tr><td><strong>Platform</strong></td><td>Standalone</td><td>Kubernetes-native (operator)</td></tr><tr><td><strong>Bootstrap</strong></td><td>Can bootstrap k8s cluster</td><td>Needs existing k8s cluster</td></tr><tr><td><strong>Machine Lifecycle</strong></td><td>Provision only</td><td>Provision + decommission + reprovision</td></tr><tr><td><strong>Hardware Introspection</strong></td><td>No (labels passed manually)</td><td>Yes (via Ironic)</td></tr><tr><td><strong>Multi-tenancy</strong></td><td>No</td><td>Yes (via k8s namespaces)</td></tr><tr><td><strong>Complexity</strong></td><td>Low</td><td>High (requires Ironic, DHCP, etc.)</td></tr></tbody></table><p><strong>When to choose Matchbox:</strong> Greenfield bare-metal, no existing k8s<br><strong>When to choose Metal³:</strong> Existing k8s, need hardware mgmt lifecycle</p><hr><h3 id=vs-cobbler>vs. Cobbler</h3><table><thead><tr><th>Feature</th><th>Matchbox</th><th>Cobbler</th></tr></thead><tbody><tr><td><strong>Age</strong></td><td>Modern (2016+)</td><td>Legacy (2008+)</td></tr><tr><td><strong>Config Format</strong></td><td>Ignition (declarative)</td><td>Kickstart/Preseed (imperative)</td></tr><tr><td><strong>Templating</strong></td><td>Go templates (minimal)</td><td>Cheetah templates (extensive)</td></tr><tr><td><strong>Python</strong></td><td>Go (static binary)</td><td>Python (requires interpreter)</td></tr><tr><td><strong>DHCP Management</strong></td><td>External</td><td>Can manage DHCP</td></tr><tr><td><strong>Maintenance</strong></td><td>Active (Poseidon)</td><td>Low activity</td></tr></tbody></table><p><strong>When to choose Matchbox:</strong> Modern immutable OSes, container workloads<br><strong>When to choose Cobbler:</strong> Legacy infra, need DHCP management, heterogeneous OS</p><hr><h3 id=vs-maas-ubuntu>vs. MAAS (Ubuntu)</h3><table><thead><tr><th>Feature</th><th>Matchbox</th><th>MAAS</th></tr></thead><tbody><tr><td><strong>OS Support</strong></td><td>CoreOS family</td><td>Ubuntu (primary), others (limited)</td></tr><tr><td><strong>IPAM</strong></td><td>No (external DHCP)</td><td>Built-in IPAM</td></tr><tr><td><strong>Power Mgmt</strong></td><td>No (manual or scripts)</td><td>Built-in (IPMI, AMT, etc.)</td></tr><tr><td><strong>UI</strong></td><td>No</td><td>Full web UI</td></tr><tr><td><strong>Declarative</strong></td><td>Yes (Terraform)</td><td>Limited (CLI mostly)</td></tr><tr><td><strong>Cloud Integration</strong></td><td>No</td><td>Yes (libvirt, LXD, VM hosts)</td></tr></tbody></table><p><strong>When to choose Matchbox:</strong> Non-Ubuntu, Kubernetes, minimal dependencies<br><strong>When to choose MAAS:</strong> Ubuntu-centric, need power mgmt, cloud integration</p><hr><h3 id=vs-netbootxyz>vs. netboot.xyz</h3><table><thead><tr><th>Feature</th><th>Matchbox</th><th>netboot.xyz</th></tr></thead><tbody><tr><td><strong>Purpose</strong></td><td>Automated provisioning</td><td>Manual OS selection menu</td></tr><tr><td><strong>Automation</strong></td><td>Full (API-driven)</td><td>None (interactive menu)</td></tr><tr><td><strong>Customization</strong></td><td>Per-machine configs</td><td>Global menu</td></tr><tr><td><strong>Ignition</strong></td><td>Native support</td><td>No</td></tr><tr><td><strong>Complexity</strong></td><td>Medium</td><td>Very low</td></tr></tbody></table><p><strong>When to choose Matchbox:</strong> Automated fleet provisioning<br><strong>When to choose netboot.xyz:</strong> Ad-hoc OS installation, homelab</p><hr><h2 id=decision-matrix>Decision Matrix</h2><p>Use this table to evaluate Matchbox for your use case:</p><table><thead><tr><th>Requirement</th><th>Weight</th><th>Matchbox Score</th><th>Notes</th></tr></thead><tbody><tr><td><strong>Ignition/CoreOS support</strong></td><td>High</td><td>⭐⭐⭐⭐⭐</td><td>Native, first-class</td></tr><tr><td><strong>Heterogeneous OS</strong></td><td>High</td><td>⭐⭐☆☆☆</td><td>Limited to Ignition OSes</td></tr><tr><td><strong>Declarative provisioning</strong></td><td>Medium</td><td>⭐⭐⭐⭐⭐</td><td>Terraform native</td></tr><tr><td><strong>Multi-tenancy</strong></td><td>Medium</td><td>⭐☆☆☆☆</td><td>Requires separate instances</td></tr><tr><td><strong>Web UI</strong></td><td>Medium</td><td>☆☆☆☆☆</td><td>No UI (API-only)</td></tr><tr><td><strong>Ease of deployment</strong></td><td>Medium</td><td>⭐⭐⭐⭐☆</td><td>Binary or container, minimal deps</td></tr><tr><td><strong>Scalability</strong></td><td>Medium</td><td>⭐⭐⭐☆☆</td><td>FileStore limits, need shared storage for HA</td></tr><tr><td><strong>Hardware mgmt</strong></td><td>Low</td><td>☆☆☆☆☆</td><td>No power mgmt, no introspection</td></tr><tr><td><strong>Cost</strong></td><td>Low</td><td>⭐⭐⭐⭐⭐</td><td>Open source, Apache 2.0</td></tr></tbody></table><p><strong>Scoring:</strong></p><ul><li>⭐⭐⭐⭐⭐ Excellent</li><li>⭐⭐⭐⭐☆ Good</li><li>⭐⭐⭐☆☆ Adequate</li><li>⭐⭐☆☆☆ Limited</li><li>⭐☆☆☆☆ Poor</li><li>☆☆☆☆☆ Not supported</li></ul><h2 id=recommendations>Recommendations</h2><h3 id=choose-matchbox-if>Choose Matchbox if:</h3><ol><li>✅ Provisioning Fedora CoreOS, Flatcar, or RHEL CoreOS</li><li>✅ Building bare-metal Kubernetes clusters</li><li>✅ Prefer declarative infrastructure (Terraform)</li><li>✅ Want minimal dependencies (single binary)</li><li>✅ Need flexible label-based machine matching</li><li>✅ Have homogeneous OS requirements (all Ignition-based)</li></ol><h3 id=avoid-matchbox-if>Avoid Matchbox if:</h3><ol><li>❌ Need multi-OS support (Windows, traditional Linux)</li><li>❌ Require web UI for operations teams</li><li>❌ Need built-in hardware management (power, BIOS config)</li><li>❌ Have strict multi-tenancy requirements</li><li>❌ Need automated hardware discovery/introspection</li></ol><h3 id=hybrid-approaches>Hybrid Approaches</h3><p><strong>Pattern 1: Matchbox + Ansible</strong></p><ul><li>Matchbox: Initial OS provisioning</li><li>Ansible: Post-boot configuration, app deployment</li><li>Works well for stateful services on bare-metal</li></ul><p><strong>Pattern 2: Matchbox + Metal³</strong></p><ul><li>Matchbox: Bootstrap initial k8s cluster</li><li>Metal³: Ongoing cluster node lifecycle management</li><li>Gradual migration from Matchbox to Metal³</li></ul><p><strong>Pattern 3: Matchbox + Terraform + External Secrets</strong></p><ul><li>Matchbox: Base OS + minimal config</li><li>Ignition: Fetch secrets from Vault/GCP Secret Manager</li><li>Terraform: Orchestrate end-to-end provisioning</li></ul><h2 id=conclusion>Conclusion</h2><p>Matchbox is a <strong>purpose-built, minimalist network boot service</strong> optimized for modern immutable operating systems (Ignition-based). It excels in container-centric bare-metal environments, particularly for Kubernetes clusters built with Fedora CoreOS or Flatcar Linux.</p><p><strong>Best fit:</strong> Organizations adopting immutable infrastructure patterns, container orchestration, and declarative provisioning workflows.</p><p><strong>Not ideal for:</strong> Heterogeneous OS environments, multi-tenant bare-metal clouds, or teams requiring extensive web UI and built-in hardware management.</p><p>For home labs and development, Matchbox offers an excellent balance of simplicity and power. For production Kubernetes deployments, it&rsquo;s a proven, battle-tested solution (via Typhoon). For complex enterprise provisioning with mixed OS requirements, consider Foreman or MAAS instead.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/Zaba505/infra aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024&ndash;2025
<span class=td-footer__authors>Zaba505 | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/infra/js/main.min.eb40505784d893e4b5c8dbd67b59c353e735d847f4ffbfe9d6921dec08dbacba.js integrity="sha256-60BQV4TYk+S1yNvWe1nDU+c12Ef0/7/p1pId7AjbrLo=" crossorigin=anonymous></script><script defer src=/infra/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/infra/js/tabpane-persist.js></script></body></html>