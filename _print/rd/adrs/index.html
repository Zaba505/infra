<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://zaba505.github.io/infra/rd/adrs/><link rel=alternate type=application/rss+xml href=https://zaba505.github.io/infra/rd/adrs/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/infra/favicons/favicon.ico><link rel=apple-touch-icon href=/infra/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/infra/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/infra/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/infra/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/infra/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/infra/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/infra/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/infra/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/infra/favicons/android-192x192.png sizes=192x192><title>Architecture Decision Records | Zaba505's Home Lab</title><meta name=description content="Documentation of architectural decisions made using MADR 4.0.0 standard"><meta property="og:url" content="https://zaba505.github.io/infra/rd/adrs/"><meta property="og:site_name" content="Zaba505's Home Lab"><meta property="og:title" content="Architecture Decision Records"><meta property="og:description" content="Documentation of architectural decisions made using MADR 4.0.0 standard"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Architecture Decision Records"><meta itemprop=description content="Documentation of architectural decisions made using MADR 4.0.0 standard"><meta itemprop=dateModified content="2025-11-17T12:27:49+09:00"><meta itemprop=wordCount content="195"><meta name=twitter:card content="summary"><meta name=twitter:title content="Architecture Decision Records"><meta name=twitter:description content="Documentation of architectural decisions made using MADR 4.0.0 standard"><link rel=preload href=/infra/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css as=style integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><link href=/infra/scss/main.min.74eef40c5172b0e2f11bd9c3ea40dba66c2dc642ac5294c208f5dc9ff772c0e9.css rel=stylesheet integrity="sha256-dO70DFFysOLxG9nD6kDbpmwtxkKsUpTCCPXcn/dywOk=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/infra/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Zaba505's Home Lab</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/infra/offline-search-index.9008ecb4c56e137e9d88f8b4ae67ec37.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/infra/rd/adrs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Architecture Decision Records</h1><div class=lead>Documentation of architectural decisions made using MADR 4.0.0 standard</div><ul><li>1: <a href=#pg-be14bb13e79709979af80fa8e61452c5>[0001] Use MADR for Architecture Decision Records</a></li><li>2: <a href=#pg-79e3b41ba15ba3a179ad4b5df5f3f2fe>[0002] Network Boot Architecture for Home Lab</a></li></ul><div class=content><h2 id=architecture-decision-records-adrs>Architecture Decision Records (ADRs)</h2><p>This section contains architectural decision records that document the key design choices made. Each ADR follows the MADR 4.0.0 format and includes:</p><ul><li>Context and problem statement</li><li>Decision drivers and constraints</li><li>Considered options with pros and cons</li><li>Decision outcome and rationale</li><li>Consequences (positive and negative)</li><li>Confirmation methods</li></ul><h3 id=adr-categories>ADR Categories</h3><p>ADRs are classified into three categories:</p><ul><li><strong>Strategic</strong> - High-level architectural decisions affecting the entire system (frameworks, authentication strategies, cross-cutting patterns). Use for foundational technology choices.</li><li><strong>User Journey</strong> - Decisions solving specific user journey problems. More tactical than strategic, but still architectural. Use when evaluating approaches to implement user-facing features.</li><li><strong>API Design</strong> - API endpoint implementation decisions (pagination, filtering, bulk operations). Use for significant API design trade-offs that warrant documentation.</li></ul><h3 id=status-values>Status Values</h3><p>Each ADR has a status that reflects its current state:</p><ul><li><code>proposed</code> - Decision is under consideration</li><li><code>accepted</code> - Decision has been approved and should be implemented</li><li><code>rejected</code> - Decision was considered but not approved</li><li><code>deprecated</code> - Decision is no longer relevant or has been superseded</li><li><code>superseded by ADR-XXXX</code> - Decision has been replaced by a newer ADR</li></ul><p>These records provide historical context for architectural decisions and help ensure consistency across the platform.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-be14bb13e79709979af80fa8e61452c5>1 - [0001] Use MADR for Architecture Decision Records</h1><div class=lead>Adopt Markdown Architectural Decision Records (MADR) as the standard format for documenting architectural decisions in the project.</div><h2 id=context-and-problem-statement>Context and Problem Statement</h2><p>As the project grows, architectural decisions are made that have long-term impacts on the system&rsquo;s design, maintainability, and scalability. Without a structured way to document these decisions, we risk losing the context and rationale behind important choices, making it difficult for current and future team members to understand why certain approaches were taken.</p><p>How should we document architectural decisions in a way that is accessible, maintainable, and provides sufficient context for future reference?</p><h2 id=decision-drivers>Decision Drivers</h2><ul><li>Need for clear documentation of architectural decisions and their rationale</li><li>Easy accessibility and searchability of past decisions</li><li>Low barrier to entry for creating and maintaining decision records</li><li>Integration with existing documentation workflow</li><li>Version control friendly format</li><li>Industry-standard approach that team members may already be familiar with</li></ul><h2 id=considered-options>Considered Options</h2><ul><li>MADR (Markdown Architectural Decision Records)</li><li>ADR using custom format</li><li>Wiki-based documentation</li><li>No formal ADR process</li></ul><h2 id=decision-outcome>Decision Outcome</h2><p>Chosen option: &ldquo;MADR (Markdown Architectural Decision Records)&rdquo;, because it provides a well-established, standardized format that is lightweight, version-controlled, and integrates seamlessly with our existing documentation structure. MADR 4.0.0 offers a clear template that captures all necessary information while remaining flexible enough for different types of decisions.</p><h3 id=consequences>Consequences</h3><ul><li>Good, because MADR is a widely adopted standard with clear documentation and examples</li><li>Good, because markdown files are easy to create, edit, and review through pull requests</li><li>Good, because ADRs will be version-controlled alongside code, maintaining historical context</li><li>Good, because the format is flexible enough to accommodate strategic, user-journey, and API design decisions</li><li>Good, because team members can easily search and reference past decisions</li><li>Neutral, because requires discipline to maintain and update ADR status as decisions evolve</li><li>Bad, because team members need to learn and follow the MADR format conventions</li></ul><h3 id=confirmation>Confirmation</h3><p>Compliance will be confirmed through:</p><ul><li>Code reviews ensuring new architectural decisions are documented as ADRs</li><li>ADRs are stored in <code>docs/content/r&amp;d/adrs/</code> following the naming convention <code>NNNN-title-with-dashes.md</code></li><li>Regular reviews during architecture discussions to reference and update existing ADRs</li></ul><h2 id=pros-and-cons-of-the-options>Pros and Cons of the Options</h2><h3 id=madr-markdown-architectural-decision-records>MADR (Markdown Architectural Decision Records)</h3><p>MADR 4.0.0 is a standardized format for documenting architectural decisions using markdown.</p><ul><li>Good, because it&rsquo;s a well-established standard with extensive documentation</li><li>Good, because markdown is simple, portable, and version-control friendly</li><li>Good, because it provides a clear structure while remaining flexible</li><li>Good, because it integrates with static site generators and documentation tools</li><li>Good, because it&rsquo;s lightweight and doesn&rsquo;t require special tools</li><li>Neutral, because it requires some initial learning of the format</li><li>Neutral, because maintaining consistency requires discipline</li></ul><h3 id=adr-using-custom-format>ADR using custom format</h3><p>Create our own custom format for architectural decision records.</p><ul><li>Good, because we can tailor it exactly to our needs</li><li>Bad, because it requires defining and maintaining our own standard</li><li>Bad, because new team members won&rsquo;t be familiar with the format</li><li>Bad, because we lose the benefits of community knowledge and tooling</li><li>Bad, because it may evolve inconsistently over time</li></ul><h3 id=wiki-based-documentation>Wiki-based documentation</h3><p>Use a wiki system (like Confluence, Notion, or GitHub Wiki) to document decisions.</p><ul><li>Good, because wikis provide easy editing and hyperlinking</li><li>Good, because some team members may be familiar with wiki tools</li><li>Neutral, because it may or may not integrate with version control</li><li>Bad, because content may not be version-controlled alongside code</li><li>Bad, because it creates a separate system to maintain</li><li>Bad, because it&rsquo;s harder to review changes through standard PR process</li><li>Bad, because portability and long-term accessibility may be concerns</li></ul><h3 id=no-formal-adr-process>No formal ADR process</h3><p>Continue without a structured approach to documenting architectural decisions.</p><ul><li>Good, because it requires no additional overhead</li><li>Bad, because context and rationale for decisions are lost over time</li><li>Bad, because new team members struggle to understand why decisions were made</li><li>Bad, because it leads to repeated discussions of previously settled questions</li><li>Bad, because it makes it difficult to track when decisions should be revisited</li></ul><h2 id=more-information>More Information</h2><ul><li>MADR 4.0.0 specification: <a href=https://adr.github.io/madr/>https://adr.github.io/madr/</a></li><li>ADRs will be categorized as: strategic, user-journey, or api-design</li><li>ADR status values: proposed | accepted | rejected | deprecated | superseded by ADR-XXXX</li><li>All ADRs are stored in <code>docs/content/r&amp;d/adrs/</code> directory</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-79e3b41ba15ba3a179ad4b5df5f3f2fe>2 - [0002] Network Boot Architecture for Home Lab</h1><div class=lead>Evaluate options for network booting servers in a home lab environment, considering local vs cloud-hosted boot servers.</div><h2 id=context-and-problem-statement>Context and Problem Statement</h2><p>When setting up a home lab infrastructure, servers need to be provisioned and booted over the network using PXE (Preboot Execution Environment). This requires a TFTP/HTTP server to serve boot files to requesting machines. The question is: where should this boot server be hosted to balance security, reliability, cost, and operational complexity?</p><h2 id=decision-drivers>Decision Drivers</h2><ul><li><strong>Security</strong>: Minimize attack surface and ensure only authorized servers receive boot files</li><li><strong>Reliability</strong>: Boot process should be resilient and not dependent on external network connectivity</li><li><strong>Cost</strong>: Minimize ongoing infrastructure costs</li><li><strong>Complexity</strong>: Keep the operational burden manageable</li><li><strong>Trust Model</strong>: Clear verification of requesting server identity</li></ul><h2 id=considered-options>Considered Options</h2><ul><li>Option 1: TFTP/HTTP server locally on home lab network</li><li>Option 2: TFTP/HTTP server on public cloud (without VPN)</li><li>Option 3: TFTP/HTTP server on public cloud (with VPN)</li></ul><h2 id=decision-outcome>Decision Outcome</h2><p>Chosen option: &ldquo;Option 3: TFTP/HTTP server on public cloud (with VPN)&rdquo;, because:</p><ol><li><strong>No local machine management</strong>: Unlike Option 1, this avoids the need to maintain dedicated local hardware for the boot server, reducing operational overhead</li><li><strong>Secure protocol support</strong>: The VPN tunnel encrypts all traffic, allowing unsecured protocols like TFTP to be used without risk of data exposure over public internet routes (unlike Option 2)</li><li><strong>Cost-effective VPN</strong>: The UDM Pro natively supports WireGuard, enabling a self-managed VPN solution that avoids expensive managed VPN services (~$180-300/year vs ~$540-900/year)</li></ol><h3 id=consequences>Consequences</h3><ul><li>Good, because all traffic is encrypted through WireGuard VPN tunnel</li><li>Good, because boot server is not exposed to public internet (no public attack surface)</li><li>Good, because trust model is simple - subnet validation similar to local option</li><li>Good, because centralized cloud management reduces local maintenance burden</li><li>Good, because boot server remains available even if home lab storage fails</li><li>Good, because UDM Pro&rsquo;s native WireGuard support keeps costs at ~$180-300/year</li><li>Bad, because boot process depends on both internet connectivity and VPN availability</li><li>Bad, because VPN adds latency to boot file transfers</li><li>Bad, because VPN gateway becomes an additional failure point</li><li>Bad, because higher ongoing cost compared to local-only option (~$180-300/year vs ~$10/year)</li></ul><h3 id=confirmation>Confirmation</h3><p>The implementation will be confirmed by:</p><ul><li>Successfully network booting a test server using the chosen architecture</li><li>Validating the trust model prevents unauthorized boot requests</li><li>Measuring actual costs against estimates</li></ul><h2 id=pros-and-cons-of-the-options>Pros and Cons of the Options</h2><h3 id=option-1-tftphttp-server-locally-on-home-lab-network>Option 1: TFTP/HTTP server locally on home lab network</h3><p>Run the boot server on local infrastructure (e.g., Raspberry Pi, dedicated VM, or container) within the home lab network.</p><h4 id=boot-flow-sequence>Boot Flow Sequence</h4><pre class=mermaid>sequenceDiagram
    participant Server as Home Lab Server
    participant DHCP as Local DHCP Server
    participant Boot as Local TFTP/HTTP Server

    Server-&gt;&gt;DHCP: PXE Boot Request (DHCP Discover)
    DHCP-&gt;&gt;Server: DHCP Offer with Boot Server IP
    Server-&gt;&gt;Boot: TFTP Request for Boot File
    Boot-&gt;&gt;Boot: Verify MAC/IP against allowlist
    Boot-&gt;&gt;Server: Send iPXE/Boot Loader
    Server-&gt;&gt;Boot: HTTP Request for Kernel/Initrd
    Boot-&gt;&gt;Server: Send Boot Files
    Server-&gt;&gt;Server: Boot into OS</pre><h4 id=trust-model>Trust Model</h4><ul><li><strong>MAC Address Allowlist</strong>: Maintain a list of known server MAC addresses</li><li><strong>Network Isolation</strong>: Boot server only accessible from home lab VLAN</li><li><strong>No external exposure</strong>: Traffic never leaves local network</li><li><strong>Physical security</strong>: Relies on physical access control to home lab</li></ul><h4 id=cost-estimate>Cost Estimate</h4><ul><li><strong>Hardware</strong>: ~$50-100 one-time (Raspberry Pi or repurposed hardware)</li><li><strong>Power</strong>: ~$5-10/year (low power consumption)</li><li><strong>Total</strong>: ~$55-110 initial + ~$10/year ongoing</li></ul><h4 id=pros-and-cons>Pros and Cons</h4><ul><li>Good, because no dependency on internet connectivity for booting</li><li>Good, because lowest latency for boot file transfers</li><li>Good, because all data stays within local network (maximum privacy)</li><li>Good, because lowest ongoing cost</li><li>Good, because simple trust model based on network isolation</li><li>Neutral, because requires dedicated local hardware or resources</li><li>Bad, because single point of failure if boot server goes down</li><li>Bad, because requires local maintenance and updates</li></ul><h3 id=option-2-tftphttp-server-on-public-cloud-without-vpn>Option 2: TFTP/HTTP server on public cloud (without VPN)</h3><p>Host the boot server on a cloud provider (AWS, GCP, Azure) and expose it directly to the internet.</p><h4 id=boot-flow-sequence-1>Boot Flow Sequence</h4><pre class=mermaid>sequenceDiagram
    participant Server as Home Lab Server
    participant DHCP as Local DHCP Server
    participant Router as Home Router/NAT
    participant Internet as Internet
    participant Boot as Cloud TFTP/HTTP Server

    Server-&gt;&gt;DHCP: PXE Boot Request (DHCP Discover)
    DHCP-&gt;&gt;Server: DHCP Offer with Cloud Boot Server IP
    Server-&gt;&gt;Router: TFTP Request
    Router-&gt;&gt;Internet: NAT Translation
    Internet-&gt;&gt;Boot: TFTP Request from Home IP
    Boot-&gt;&gt;Boot: Verify source IP &#43; token/certificate
    Boot-&gt;&gt;Internet: Send iPXE/Boot Loader
    Internet-&gt;&gt;Router: Response
    Router-&gt;&gt;Server: Boot Loader
    Server-&gt;&gt;Router: HTTP Request for Kernel/Initrd
    Router-&gt;&gt;Internet: NAT Translation
    Internet-&gt;&gt;Boot: HTTP Request with auth headers
    Boot-&gt;&gt;Boot: Validate request authenticity
    Boot-&gt;&gt;Internet: Send Boot Files
    Internet-&gt;&gt;Router: Response
    Router-&gt;&gt;Server: Boot Files
    Server-&gt;&gt;Server: Boot into OS</pre><h4 id=trust-model-1>Trust Model</h4><ul><li><strong>Source IP Validation</strong>: Restrict to home lab&rsquo;s public IP (dynamic IP is problematic)</li><li><strong>Certificate/Token Authentication</strong>: Embed certificates in initial bootloader</li><li><strong>TLS for HTTP</strong>: All HTTP traffic encrypted</li><li><strong>Challenge-Response</strong>: Boot server can challenge requesting server</li><li><strong>Risk</strong>: TFTP typically unencrypted, vulnerable to interception</li></ul><h4 id=cost-estimate-1>Cost Estimate</h4><ul><li><strong>Cloud VM (t3.micro or equivalent)</strong>: ~$10-15/month</li><li><strong>Data Transfer</strong>: ~$1-5/month (boot files are typically small)</li><li><strong>Static IP</strong>: ~$3-5/month</li><li><strong>Total</strong>: ~$170-300/year</li></ul><h4 id=pros-and-cons-1>Pros and Cons</h4><ul><li>Good, because boot server remains available even if home lab has issues</li><li>Good, because centralized management in cloud console</li><li>Good, because easy to scale or replicate</li><li>Neutral, because requires internet connectivity for every boot</li><li>Bad, because significantly higher ongoing cost</li><li>Bad, because TFTP protocol is inherently insecure over public internet</li><li>Bad, because complex trust model required (IP validation, certificates)</li><li>Bad, because boot process depends on internet availability</li><li>Bad, because higher latency for boot file transfers</li><li>Bad, because public exposure increases attack surface</li></ul><h3 id=option-3-tftphttp-server-on-public-cloud-with-vpn>Option 3: TFTP/HTTP server on public cloud (with VPN)</h3><p>Host the boot server in the cloud but connect the home lab to the cloud via a site-to-site VPN tunnel.</p><h4 id=boot-flow-sequence-2>Boot Flow Sequence</h4><pre class=mermaid>sequenceDiagram
    participant Server as Home Lab Server
    participant DHCP as Local DHCP Server
    participant VPN as VPN Gateway (Home)
    participant CloudVPN as VPN Gateway (Cloud)
    participant Boot as Cloud TFTP/HTTP Server

    Note over VPN,CloudVPN: Site-to-Site VPN Tunnel Established

    Server-&gt;&gt;DHCP: PXE Boot Request (DHCP Discover)
    DHCP-&gt;&gt;Server: DHCP Offer with Boot Server Private IP
    Server-&gt;&gt;VPN: TFTP Request to Private IP
    VPN-&gt;&gt;CloudVPN: Encrypted VPN Tunnel
    CloudVPN-&gt;&gt;Boot: TFTP Request (appears local)
    Boot-&gt;&gt;Boot: Verify source IP from home lab subnet
    Boot-&gt;&gt;CloudVPN: Send iPXE/Boot Loader
    CloudVPN-&gt;&gt;VPN: Encrypted Response
    VPN-&gt;&gt;Server: Boot Loader
    Server-&gt;&gt;VPN: HTTP Request for Kernel/Initrd
    VPN-&gt;&gt;CloudVPN: Encrypted VPN Tunnel
    CloudVPN-&gt;&gt;Boot: HTTP Request
    Boot-&gt;&gt;Boot: Validate subnet membership
    Boot-&gt;&gt;CloudVPN: Send Boot Files
    CloudVPN-&gt;&gt;VPN: Encrypted Response
    VPN-&gt;&gt;Server: Boot Files
    Server-&gt;&gt;Server: Boot into OS</pre><h4 id=trust-model-2>Trust Model</h4><ul><li><strong>VPN Tunnel Encryption</strong>: All traffic encrypted end-to-end</li><li><strong>Private IP Addressing</strong>: Boot server only accessible via VPN</li><li><strong>Subnet Validation</strong>: Verify requests come from trusted home lab subnet</li><li><strong>VPN Authentication</strong>: Strong auth at tunnel level (certificates, pre-shared keys)</li><li><strong>No public exposure</strong>: Boot server has no public IP</li></ul><h4 id=cost-estimate-2>Cost Estimate</h4><ul><li><strong>Cloud VM (t3.micro or equivalent)</strong>: ~$10-15/month</li><li><strong>Data Transfer (VPN)</strong>: ~$5-10/month</li><li><strong>VPN Gateway Service (if using managed)</strong>: ~$30-50/month OR</li><li><strong>Self-managed VPN (WireGuard/OpenVPN)</strong>: ~$0 additional</li><li><strong>Total (self-managed VPN)</strong>: ~$180-300/year</li><li><strong>Total (managed VPN)</strong>: ~$540-900/year</li></ul><h4 id=pros-and-cons-2>Pros and Cons</h4><ul><li>Good, because all traffic encrypted through VPN tunnel</li><li>Good, because boot server not exposed to public internet</li><li>Good, because trust model similar to local option (subnet validation)</li><li>Good, because centralized cloud management benefits</li><li>Good, because boot server available if home lab storage fails</li><li>Neutral, because moderate complexity (VPN setup and maintenance)</li><li>Bad, because higher cost than local option</li><li>Bad, because boot process still depends on internet + VPN availability</li><li>Bad, because VPN adds latency to boot process</li><li>Bad, because VPN gateway becomes additional failure point</li><li>Bad, because most expensive option if using managed VPN service</li></ul><h2 id=more-information>More Information</h2><h3 id=related-resources>Related Resources</h3><ul><li><a href=https://en.wikipedia.org/wiki/Preboot_Execution_Environment>PXE Boot Specification</a></li><li><a href=https://ipxe.org/>iPXE - Open Source Boot Firmware</a></li><li><a href=https://tools.ietf.org/html/rfc1350>TFTP Protocol (RFC 1350)</a></li></ul><h3 id=key-questions-for-decision>Key Questions for Decision</h3><ol><li>How critical is boot availability during internet outages?</li><li>Is the home lab public IP static or dynamic?</li><li>What is the acceptable boot time latency?</li><li>How many servers need to be supported?</li><li>Is there existing VPN infrastructure?</li></ol><h3 id=related-issues>Related Issues</h3><ul><li><a href=https://github.com/Zaba505/infra/issues/595>Issue #595</a> - story(docs): create adr for network boot architecture</li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/Zaba505/infra aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024&ndash;2025
<span class=td-footer__authors>Zaba505 | <a href=https://creativecommons.org/licenses/by/4.0>CC BY 4.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/infra/js/main.min.eb40505784d893e4b5c8dbd67b59c353e735d847f4ffbfe9d6921dec08dbacba.js integrity="sha256-60BQV4TYk+S1yNvWe1nDU+c12Ef0/7/p1pId7AjbrLo=" crossorigin=anonymous></script><script defer src=/infra/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/infra/js/tabpane-persist.js></script></body></html>